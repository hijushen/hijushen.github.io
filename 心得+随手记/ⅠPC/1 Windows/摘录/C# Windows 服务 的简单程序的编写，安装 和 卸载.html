<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>C# Windows 服务 的简单程序的编写，安装 和 卸载</title><?xml version="1.0" encoding="UTF-8"?>


<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="margin: 5px 0px; font-size: 20px; line-height: 30px; font-family: &#39;Microsoft YaHei&#39;; text-align: left; background-color: rgb(255, 255, 255);">&nbsp;
<h3 style="margin: 0px; padding: 0px; display: inline; font-weight: normal; font-size: 20px; vertical-align: middle;"><a href="http://blog.csdn.net/yanpingsoft/article/details/7818271" style="color: rgb(0, 0, 0); text-decoration: none;">C# Windows 服务 的简单程序的编写，安装 和 卸载</a></h3></div><div style="margin: 5px 0px; font-size: 20px; line-height: 30px; font-family: &#39;Microsoft YaHei&#39;; text-align: left; background-color: rgb(255, 255, 255);"><span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;">如图，我们需要先建立一个windows服务，给他命名，然后进入到项目设计页面，</span><span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px;">&nbsp;</span></div><div style="margin: 20px 0px 0px; font-size: 14px; line-height: 26px; font-family: Arial; color: rgb(51, 51, 51); text-align: left; background-color: rgb(255, 255, 255);"><p><img src="http://my.csdn.net/uploads/201208/01/1343810589_5178.jpg" style="cursor: default;"/></p><p>&nbsp;</p><p>然后我们可以看到解决方案，有一个默认的 Service1.cs ,这个是服务名，我们可以根据自己的需要去改，这里我把它改成了ServiceTest.cs</p><p><img src="http://my.csdn.net/uploads/201208/01/1343810511_4515.jpg" style="cursor: default;"/></p><p><img src="http://my.csdn.net/uploads/201208/01/1343810852_9052.jpg" style="cursor: default;"/></p><p>然后我们可以再 ServiceTest.cs里写下自己的逻辑代码，默认的是下面两个方法，我简单的写了个方法！</p><p>&nbsp;</p><p>如下</p><p>&nbsp;public partial class ServiceTest : ServiceBase<br/>
&nbsp;&nbsp;&nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public ServiceTest()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeComponent();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void OnStart(string[] args)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (System.IO.StreamWriter rs = new System.IO.StreamWriter(&quot;d;\\log.txt&quot;,true))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rs.WriteLine(DateTime.Now.ToString(&quot;yy-mm-dd HH:mm:ss&quot;)+&quot;Start.&quot;);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected override void OnStop()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (System.IO.StreamWriter rs = new System.IO.StreamWriter(&quot;d;\\log.txt&quot;, true))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rs.WriteLine(DateTime.Now.ToString(&quot;yy-mm-dd HH:mm:ss&quot;) + &quot;Stop.&quot;);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br/>
&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;</p><p>&nbsp; 写完逻辑代码后，我们到项目的设计页面去，右键--&gt;添加安装程序--&gt;然后会出现下面的两个组件！在这里我们需要修改一下 这两个组件的 三个属性！</p><p><img src="http://my.csdn.net/uploads/201208/01/1343810493_7329.jpg" style="cursor: default;"/></p><p>&nbsp;</p><p>&nbsp;</p><p>首先，我们可以去修改 serviceInstaller 的属性，右键---属性---如图</p><p>&nbsp;1,先把ServiceName 改成 服务名（跟前面我们的ServiceTest.cs 文件时一个名字）</p><p>&nbsp; 2,改一下他的StartTYpe 改成 Automatic</p><p>&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://my.csdn.net/uploads/201208/01/1343811408_2584.jpg" style="cursor: default;"/></p><p>&nbsp;</p><p>然后我们需要去改另一个组件的属性了！右键---属性 --如下图</p><p>&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://my.csdn.net/uploads/201208/01/1343810506_5277.jpg" style="cursor: default;"/></p><p>&nbsp; 这个我们只需要改他的一个属性！如图照改即可！</p><p>&nbsp; 然后我们就可以生成程序了！生成以后我们可以到 bin--debug 多了下图的文件</p><p><img src="http://my.csdn.net/uploads/201208/01/1343811744_2018.jpg" style="cursor: default;"/></p><p>然后就该安装windows 程序了！ 安装的话，我们需要一段代码！</p><p>cd C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727&nbsp;<br/>
InstallUtil.exe D:\练习\WindowsServiceTest\WindowsServiceTest\bin\Debug\WindowsServiceTest.exe&nbsp;&nbsp;&nbsp;<a href="file://d/" style="color: rgb(51, 102, 153); text-decoration: none;">\\D</a>：后面的是我们生成上图WindowsServiceTest.exe&nbsp;&nbsp;的路径<br/>
net start ServiceTest&nbsp;&nbsp; \\这个是我们的服务名</p><p>为了方便，我们可以把这段代码放到 .bat 文件里直接执行就可以了！</p><p>( 就是把这段代码考到.txt 文件中，改一下他的后缀变成 .bat 就可以双击鼠标左键直接执行了)</p><p>执行就安装和启动了我们刚才建立的 windows 服务了！双击执行后&nbsp; 如图</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://my.csdn.net/uploads/201208/01/1343810522_4246.jpg" style="cursor: default;"/></p><p>&nbsp;&nbsp;&nbsp;&nbsp; 等这个执行完后，我们就可以在我们的 程序服务 中看到我们刚才建立的 windows 服务了！如下图</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://my.csdn.net/uploads/201208/01/1343810534_5900.jpg" style="cursor: default;"/></p><p>&nbsp;</p><p>这样就 新建好了 一个 windows 服务了！</p><p>&nbsp;&nbsp; 如果我们想要删除，卸载这个服务的话，我们可以执行这段代码</p><p>&nbsp; cd C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727&nbsp;<br/>
InstallUtil.exe/u D:\练习\WindowsServiceTest\WindowsServiceTest\bin\Debug\WindowsServiceTest.exe</p><p><br/>
这样就可以了！&nbsp; 为了方便，也可以把这段代码放到 bat 文件里直接执行！方法跟上面的一样！</p><p>由于是刚学这个东西，在这里我就讲这么多，更深的东西，大家还是网上找教程吧！</p></div></div>