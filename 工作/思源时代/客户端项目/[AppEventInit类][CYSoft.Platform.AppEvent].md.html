<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>[AppEventInit类][CYSoft.Platform.AppEvent].md</title>
    <!--mark |wiz_custom_css| for wizeditor replace it-->


<style id="wiz_custom_css">        html, body {            font-size: 15px;        }        body {            font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;            line-height: 1.6;            margin: 0;            padding: 20px 36px;            padding: 1.33rem 2.4rem;        }        h1, h2, h3, h4, h5, h6 {            margin: 20px 0 10px;            margin: 1.33rem 0 0.667rem;            padding: 0;            font-weight: bold;        }        h1 {            font-size: 21px;            font-size: 1.4rem;        }        h2 {            font-size: 20px;            font-size: 1.33rem;        }        h3 {            font-size: 18px;            font-size: 1.2rem;        }        h4 {            font-size: 17px;            font-size: 1.13rem;        }        h5 {            font-size: 15px;            font-size: 1rem;        }        h6 {            font-size: 15px;            font-size: 1rem;            color: #777777;            margin: 1rem 0;        }        div, p, ul, ol, dl, li {            margin: 0;        }        blockquote, table, pre, code {            margin: 8px 0;        }        ul, ol {            padding-left: 32px;            padding-left: 2.13rem;        }        blockquote {            padding: 0 12px;            padding: 0 0.8rem;        }        blockquote > :first-child {            margin-top: 0;        }        blockquote > :last-child {            margin-bottom: 0;        }        img {            border: 0;            max-width: 100%;            height: auto !important;            margin: 2px 0;        }        table {            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        td {            padding: 4px 8px;            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        @media screen and (max-width: 660px) {            body {                padding: 20px 18px;                padding: 1.33rem 1.2rem;            }        }        @media only screen and (-webkit-max-device-width: 1024px), only screen and (-o-max-device-width: 1024px), only screen and (max-device-width: 1024px), only screen and (-webkit-min-device-pixel-ratio: 3), only screen and (-o-min-device-pixel-ratio: 3), only screen and (min-device-pixel-ratio: 3) {            html, body {                font-size: 17px;            }            body {                line-height: 1.7;                padding: 0.75rem 0.9375rem;                color: #353c47;            }            h1 {                font-size: 2.125rem;            }            h2 {                font-size: 1.875rem;            }            h3 {                font-size: 1.625rem;            }            h4 {                font-size: 1.375rem;            }            h5 {                font-size: 1.125rem;            }            h6 {                color: inherit;            }            ul, ol {                padding-left: 2.5rem;            }            blockquote {                padding: 0 0.9375rem;            }        }</style><style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style></head>

<body style="" ><div>[toc]</div><div><br></div><div>## 功能概述</div><div>- 作用:</div><div>&nbsp; &nbsp; - 通过反射加载dll 内命名控件, 完成相应事件方法的注册. 首先来看目标类的继承体系:<br></div><div>&nbsp; &nbsp; - 加载配置文件:&nbsp;"\CYSoft.Platform\Debug\Config\AppExpansion.xml" 路径: 内容:<br></div><div>```</div><div>&nbsp; &nbsp;&nbsp;<span style="font-size: 15px; line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span><span style="font-size: 15px; line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span><span style="font-size: 15px; line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span><span style="font-size: 15px; line-height: 1.6;">&lt;!--&lt;AppEvent&gt;</span></div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;Code&gt;SysParmr&lt;/Code&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span> &nbsp; &nbsp;&lt;Name&gt;系统变量&lt;/Name&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;AssemblyName&gt;CYSoft.A9&lt;/AssemblyName&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;ClassName&gt;CYSoft.A9.ParmInit&lt;/ClassName&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>&lt;/AppEvent&gt;--&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>&lt;AppEvent&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;Code&gt;SysParmr&lt;/Code&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;Name&gt;系统变量&lt;/Name&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;AssemblyName&gt;CYSoft.Platform.IC.dll&lt;/AssemblyName&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;ClassName&gt;CYSoft.Platform.IC.FuncLog&lt;/ClassName&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>&lt;/AppEvent&gt;</div><div><br></div><div><span class="Apple-tab-span" style="white-space:pre">		</span>&lt;AppEvent&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;Code&gt;HnadleClearCacheData&lt;/Code&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;Name&gt;手工清除缓存数据&lt;/Name&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;AssemblyName&gt;CYSoft.Platform.IC.dll&lt;/AssemblyName&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;ClassName&gt;CYSoft.Platform.IC.RefreshLocalData&lt;/ClassName&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>&lt;/AppEvent&gt;</div><div><br></div><div><span class="Apple-tab-span" style="white-space:pre">		</span>&lt;AppEvent&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;Code&gt;AppUnReadMsg&lt;/Code&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;Name&gt;刷新平台未读消息&lt;/Name&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;AssemblyName&gt;CYSoft.Platform.UI.Main.exe&lt;/AssemblyName&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>&lt;ClassName&gt;CYSoft.Platform.UI.Main.FrmMain&lt;/ClassName&gt;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>&lt;/AppEvent&gt;</div><div>```</div><div><br></div><div><img src="[AppEventInit类][CYSoft.Platform.AppEvent].md_files/03f42900-a6a5-4b27-9f4a-49633a5c41a7.png" border="0" alt="Class Diagram.png" name=""><br></div><div>[toc]</div>## 举例登录初始化时<div>&nbsp;- 设置相应 `UserLoginEventArgs`属性为登录类型, 登录后, 反射后如果 目标类型 存在于如图中的继承体系 中, 则**type**不为**null**, 这样, 就执行对应方法. 如果不是, 例如虽然配置文件中包含了**`<span style="font-size: 15px; line-height: 1.6;">CYSoft.Platform.UI.Main.FrmMain</span><span style="font-size: 15px; line-height: 1.6;">`**这样的类型, 但是没有实现任何接口, 所以导致不会有方法执行.&nbsp;</span></div><div><br></div><div>&gt; &nbsp;如上 更新于 &nbsp;2016年4月22日.</div><div><br></div><div><div>## 运行点击左侧树形节点</div></div><div>- `FrmFunctionExp`窗体在 `MainForm`窗体中左侧构成， 加载时窗体内控件已包点击事件响应方法： &nbsp;`treeList1_MouseDoubleClick`, &nbsp;通过类`Common.Funciton` 中 `InRow` 计算bool方法判断是否执行 `FunIn` 方法，其中 new `CYSoft.Platform.AppEvent　空间下　.AppFrameworkEventArgs` 类型，传入`<span style="background-color: white; font-family: 'Lucida Sans Unicode'; line-height: 1.6;">AppEvent.</span><span style="font-family: 'Lucida Sans Unicode'; line-height: 1.6; color: rgb(43, 145, 175);">AppEventInit</span><span style="background-color: white; font-family: 'Lucida Sans Unicode'; line-height: 1.6;">.InitEventListener()`完成事件注册, 如果自身暴露的事件 `</span><span style="line-height: 1.6;">FuncInEvent` 在 `MainForm`窗体中已经注册的话, 则执行 调用.</span><br style="font-family: 'Lucida Sans Unicode'; line-height: 1.6;"></div><div><span style="line-height: 1.6;"><br></span></div><div><span style="line-height: 1.6;">## 静态方法&nbsp;</span><span style="line-height: 1.6;">AppEventInit.</span><span style="line-height: 1.6;">InitEventListener() 执行过程.</span></div><div><span style="line-height: 1.6;">- 类静态变量&nbsp;</span><span style="line-height: 1.6;">mInstanceConfig 指明参数来源构造路径 `</span><span style="background-color: white; font-family: 'Lucida Sans Unicode'; line-height: 1.6;">ParmInfo.</span><span style="font-family: 'Lucida Sans Unicode'; line-height: 1.6; color: rgb(43, 145, 175);">ConfigInfo</span><span style="background-color: white; font-family: 'Lucida Sans Unicode'; line-height: 1.6;">.AppExpansionFile`内容为 `</span><span style="line-height: 1.6;">AppExpansion.xml`文件.</span><br style="font-family: 'Lucida Sans Unicode'; line-height: 1.6;"></div><div><span style="line-height: 1.6;">- 循环获取配置AppEvent 节点下所有指明dll及方法, 然后通过反射获取类型Type.&nbsp;</span></div><div><span style="line-height: 1.6;">- 通过判定传入的事件类型如, `</span><span style="line-height: 1.6;">UserLoginEventArgs`, `</span><span style="line-height: 1.6;">UserLogoutEventArgs`, `</span><span style="line-height: 1.6;">FunctionEnterEventArgs` 等, 本例子中为 `</span><span style="line-height: 1.6;">FunctionEnterEventArgs`类型来执行 `</span><span style="line-height: 1.6;">Activator.CreateInstance(type)`创造的Type里面的对应方法. 譬如, 我获得`ParmInit`类型, 现在是 `FunctionOnEventArgs`, 那么根据逻辑, 执行`</span><span style="line-height: 1.6;">UserLogined` 方法.</span></div><div><span style="line-height: 1.6;">- ***总结***: 接口`</span><span style="line-height: 1.6;">CYSoft.Platform.AppEvent.</span><span style="line-height: 1.6;">IAppEventListener` 接口定义了 App 事件接口类型. 而诸如 `</span><span style="line-height: 1.6;">CYSoft.CY02.Common.</span><span style="line-height: 1.6;">ParmInit` 等Type参数实现该接口后, 针对需要实现的方法, 譬如 `</span><span style="line-height: 1.6;">UserLogined`等, 完成具体的业务实现. 最终的效果解释外部dll, 如CY02等, 只需要在xml中配置好相应节点, 然后配置对应的类型实现相应的接口后, 系统会在需要的时候自动加载相应的方法.&nbsp;</span></div><div><span style="line-height: 1.6;"><br></span></div><div><span style="line-height: 1.6;"><br></span></div><div><span style="line-height: 1.6;"><br></span></div></body></html>