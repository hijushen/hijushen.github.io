<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>UI 界面公共代码Function解析及方法备注</title>
    <!--mark |wiz_custom_css| for wizeditor replace it-->


<link type="text/css" rel="stylesheet" id="wiz_code_highlight_link" href="UI 界面公共代码Function解析及方法备注_files/wiz_code_highlight_64.css"><style id="wiz_custom_css">        html, body {            font-size: 15px;        }        body {            font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;            line-height: 1.6;            margin: 0;            padding: 20px 36px;            padding: 1.33rem 2.4rem;        }        h1, h2, h3, h4, h5, h6 {            margin: 20px 0 10px;            margin: 1.33rem 0 0.667rem;            padding: 0;            font-weight: bold;        }        h1 {            font-size: 21px;            font-size: 1.4rem;        }        h2 {            font-size: 20px;            font-size: 1.33rem;        }        h3 {            font-size: 18px;            font-size: 1.2rem;        }        h4 {            font-size: 17px;            font-size: 1.13rem;        }        h5 {            font-size: 15px;            font-size: 1rem;        }        h6 {            font-size: 15px;            font-size: 1rem;            color: #777777;            margin: 1rem 0;        }        div, p, ul, ol, dl, li {            margin: 0;        }        blockquote, table, pre, code {            margin: 8px 0;        }        ul, ol {            padding-left: 32px;            padding-left: 2.13rem;        }        blockquote {            padding: 0 12px;            padding: 0 0.8rem;        }        blockquote > :first-child {            margin-top: 0;        }        blockquote > :last-child {            margin-bottom: 0;        }        img {            border: 0;            max-width: 100%;            height: auto !important;            margin: 2px 0;        }        table {            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        td {            padding: 4px 8px;            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        @media screen and (max-width: 660px) {            body {                padding: 20px 18px;                padding: 1.33rem 1.2rem;            }        }        @media only screen and (-webkit-max-device-width: 1024px), only screen and (-o-max-device-width: 1024px), only screen and (max-device-width: 1024px), only screen and (-webkit-min-device-pixel-ratio: 3), only screen and (-o-min-device-pixel-ratio: 3), only screen and (min-device-pixel-ratio: 3) {            html, body {                font-size: 17px;            }            body {                line-height: 1.7;                padding: 0.75rem 0.9375rem;                color: #353c47;            }            h1 {                font-size: 2.125rem;            }            h2 {                font-size: 1.875rem;            }            h3 {                font-size: 1.625rem;            }            h4 {                font-size: 1.375rem;            }            h5 {                font-size: 1.125rem;            }            h6 {                color: inherit;            }            ul, ol {                padding-left: 2.5rem;            }            blockquote {                padding: 0 0.9375rem;            }        }</style><style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style></head>

<body style="" ><span style="line-height: 1.6;">公共调用方法后,完成重复功能逻辑的封装. 静态方法直接调用.</span><div>1. 删除树的节点及其下层节点.</div><div>&nbsp; &nbsp; --dtSurc为dtDel的copy.(理解循环删除的方法)<br><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">DelChildNode</span><span class="pun">(</span><span class="typ">TreeList</span><span class="pln"> tree</span><span class="pun">,</span><span class="kwd">string</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> dtDel</span><span class="pun">){}</span></code></li><li class="L0"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">DelChildNodeData</span><span class="pun">(</span><span class="kwd">string</span><span class="pln"> pidField</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> idField</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> idValue</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> dtDel</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> dtSurc</span><span class="pun">){}</span><br></li></ol></pre></div><div>&nbsp; &nbsp; 删除后优先显示如下2中结点之一, 顺序从上往下.</div><div><span style="line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span>Dev控件属性TreeListNode.FocusedNode.<font color="#ff0000">ParentNode</font>. //ParentNode: "Gets the parent node of the current tree node If a tree node is at the root level, the ParentNode property returns null. " --就是当前空间父结点,如果本省是根结点,则返回null.&nbsp;</div><div><span style="line-height: 1.6;">&nbsp; &nbsp; 属性TreeListNode.FocusedNode.</span><span style="line-height: 1.6;"><font color="#ff0000">PrevVisibleNode</font>. //PrevVisableNode: "</span><span style="line-height: 1.6;">A node is hidden if its parent node is collapsed.&nbsp;</span><span style="line-height: 1.6;">A TreeListNode object which represents the visible node located prior to the current one. null &nbsp;if the current node is the first node in the Tree List's TreeList.Nodes collection." &nbsp;当前结点前面第一个可见结点, 如果本身是第一个结点, 那么为null.</span><span style="line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span></div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><span class="pun">&gt;</span><span class="pln"> pidField</span><span class="pun">和</span><span class="pln">idField </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">作为一个树结构,</span><span class="pln"> </span><span class="pun">最重要属性就包括</span><span class="pln">tree</span><span class="pun">.</span><span class="typ">ParentFieldName</span><span class="pun">,</span><span class="pln"> tree</span><span class="pun">.</span><span class="typ">KeyFieldName</span><span class="pun">.</span><span class="pln"> </span><span class="pun">前者表示当前结点的上一个父节点列名,</span><span class="pln"> </span><span class="pun">后者表示列名列.</span><span class="pln"> </span><span class="pun">存储在数据库中根据这</span><span class="lit">2</span><span class="pun">列就能生成树.</span><span class="pln"> </span><span class="pun">如果值为</span><span class="typ">RootValue</span><span class="pun">(默认为</span><span class="lit">0</span><span class="pun">),</span><span class="kwd">null</span><span class="pun">,</span><span class="typ">DBNull</span><span class="pun">.</span><span class="typ">Value</span><span class="pln">  corresponding</span><span class="pun">(相应地)</span><span class="pln"> </span><span class="pun">就是显示在树结构的根节点中.</span><br><code class="language-cs"></code></li></ol></pre></div><div><br></div><div>2.清除控件内的值.(目前尚未调用)</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">ClearControlsValue</span><span class="pun">(</span><span class="typ">Control</span><span class="pun">.</span><span class="typ">ControlCollection</span><span class="pln"> ctrls</span><span class="pun">)</span></code></li></ol></pre></div><div>&nbsp; &nbsp; 循环递归获取传入控件及子控件, 根据类型清除相应值.<br></div></div><div><br></div><div>3. 判断当前点击信息是否在行内.</div><div>&nbsp; &nbsp;--GirdView判断</div><div><span style="line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span><span style="line-height: 1.6;">广泛,MouseClick及相应单,双击事件均进行判断.&nbsp;</span></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> bool </span><span class="typ">InRow</span><span class="pun">(</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraGrid</span><span class="pun">.</span><span class="typ">Views</span><span class="pun">.</span><span class="typ">Grid</span><span class="pun">.</span><span class="typ">GridView</span><span class="pln"> gv</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Point</span><span class="pln"> p</span><span class="pun">)</span></code></li><li class="L1"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L2"><code class="language-cs"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> gv</span><span class="pun">.</span><span class="typ">CalcHitInfo</span><span class="pun">(</span><span class="pln">p</span><span class="pun">).</span><span class="typ">InRow</span><span class="pun">;</span></code></li><li class="L3"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li></ol></pre></div><div>&nbsp; &nbsp; --TreeList判断<br></div></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> bool </span><span class="typ">InRow</span><span class="pun">(</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraTreeList</span><span class="pun">.</span><span class="typ">TreeList</span><span class="pln"> tl</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Point</span><span class="pln"> p</span><span class="pun">)</span></code></li><li class="L1"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L2"><code class="language-cs"><span class="pln">            </span><span class="typ">HitInfoType</span><span class="pln"> hit </span><span class="pun">=</span><span class="pln"> tl</span><span class="pun">.</span><span class="typ">CalcHitInfo</span><span class="pun">(</span><span class="pln">p</span><span class="pun">).</span><span class="typ">HitInfoType</span><span class="pun">;</span></code></li><li class="L3"><code class="language-cs"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">hit </span><span class="pun">==</span><span class="pln"> </span><span class="typ">HitInfoType</span><span class="pun">.</span><span class="typ">Row</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> hit </span><span class="pun">==</span><span class="pln"> </span><span class="typ">HitInfoType</span><span class="pun">.</span><span class="typ">Cell</span><span class="pun">)</span></code></li><li class="L4"><code class="language-cs"><span class="pln">                </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L5"><code class="language-cs"></code></li><li class="L6"><code class="language-cs"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L7"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li></ol></pre></div><div><br></div></div><div>4. 初始化右键菜单.</div><div>&nbsp; &nbsp; 趋势. 用在用户授权 ('FrmUserOpAuth') 窗体中. 使用barManage1.items完成右键弹出窗口初始化. 减少hard code的编写.</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">InitPopMenu</span><span class="pun">(</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraBars</span><span class="pun">.</span><span class="typ">PopupMenu</span><span class="pln"> pm</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraBars</span><span class="pun">.</span><span class="typ">BarManager</span><span class="pln"> bm</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraBars</span><span class="pun">.</span><span class="typ">BarButtonItem</span><span class="pun">&gt;</span><span class="pln"> barBtns</span><span class="pun">)</span></code></li></ol></pre></div><div><br></div></div><div>5. 显示右键菜单.&nbsp;</div><div><span style="line-height: 1.6;">&nbsp; &nbsp; -- 重载一&nbsp;</span>使用在消息管理窗体中('FrmMsgManage')中,(注:该窗体使用界面设计破普票Menu及barManage,可以参考).&nbsp;</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">ShowPopMenu</span><span class="pun">(</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraBars</span><span class="pun">.</span><span class="typ">PopupMenu</span><span class="pln"> pm</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraBars</span><span class="pun">.</span><span class="typ">BarManager</span><span class="pln"> bm</span><span class="pun">,</span></code></li><li class="L1"><code class="language-cs"><span class="pln">            </span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MouseEventArgs</span><span class="pln"> e</span><span class="pun">)</span></code></li><li class="L2"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L3"><code class="language-cs"><span class="pln">            </span><span class="typ">Point</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="typ">Control</span><span class="pun">)</span><span class="pln">sender</span><span class="pun">).</span><span class="typ">PointToScreen</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="typ">Location</span><span class="pun">);</span></code></li><li class="L4"><code class="language-cs"><span class="pln">            pm</span><span class="pun">.</span><span class="typ">ShowPopup</span><span class="pun">(</span><span class="pln">bm</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">);</span></code></li><li class="L5"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li></ol></pre></div><div>&nbsp; &nbsp; --其他重载,略<br></div></div><div>&nbsp; &nbsp; --注意点: PointToSreen, 方法获得控件的相应位置如. PointToScreen(e.location)相应e.location相对父控件位置. CSDN有提到这事相对位置, 跟随时位置可能不对.所以可以改进:</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="pun">http://www.cnblogs.com/qkhh/p/3985091.html<br></span></code></li><li class="L0"><code class="language-cs"><span class="pun">今日写一段测试代码，实现的功能是，当一个输入框获得焦点时，某个帮助窗体跟随在其下方显示。代码很简单，本来没有什么值得一提的。但实验的时候发现，有些控件能较好地跟随，但有些不能，而且距离十分远。</span></code></li><li class="L2"><code class="language-cs"><span class="pun">主要代码如下(跟随窗体中)：</span></code></li><li class="L2"><code class="language-cs"><span class="pun"><br></span></code></li><li class="L4"><code class="language-cs"><span class="pln">            </span><span class="typ">Point</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> ctrl</span><span class="pun">.</span><span class="typ">PointToScreen</span><span class="pun">(</span><span class="pln">ctrl</span><span class="pun">.</span><span class="typ">Location</span><span class="pun">);</span></code></li><li class="L5"><code class="language-cs"><span class="pln">            p</span><span class="pun">.</span><span class="pln">X </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span></code></li><li class="L6"><code class="language-cs"><span class="pln">            p</span><span class="pun">.</span><span class="pln">Y </span><span class="pun">+=</span><span class="pln"> ctrl</span><span class="pun">.</span><span class="typ">Height</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L7"><code class="language-cs"></code></li><li class="L8"><code class="language-cs"><span class="pln">            lblDebugPoint</span><span class="pun">.</span><span class="typ">Text</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">.</span><span class="typ">Format</span><span class="pun">(</span><span class="str">"X: {0}, \r\nY: {1}"</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">X</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">Y</span><span class="pun">);</span></code></li><li class="L9"><code class="language-cs"><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="typ">Location</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">;</span></code></li><li class="L0"><code class="language-cs"><span class="pln">            txtSearch</span><span class="pun">.</span><span class="typ">Focus</span><span class="pun">();</span></code></li><li class="L1"><code class="language-cs"><span class="pln">            </span><span class="typ">Show</span><span class="pun">();</span></code></li><li class="L1"><code class="language-cs"><span class="pun"><br></span></code></li><li class="L3"><code class="language-cs"><span class="pun">问题出现在哪里呢？经过一翻思索，也翻阅了一些文章。发现原来问题出现在第</span><span class="lit">1</span><span class="pun">句。</span></code></li><li class="L5"><code class="language-cs"><span class="pln">ctrl</span><span class="pun">.</span><span class="typ">PointToScreen</span><span class="pun">(</span><span class="pln">ctrl</span><span class="pun">.</span><span class="typ">Location</span><span class="pun">);</span></code></li><li class="L7"><code class="language-cs"><span class="pln">ctrl</span><span class="pun">.</span><span class="typ">Location</span><span class="pun">是什么？它是此控件相对于其容器的位置，</span><span class="pln">ctrl</span><span class="pun">.</span><span class="typ">PointToScreen</span><span class="pun">又是基于本控件来计算的。标准不一致，这还不乱套吗？</span></code></li><li class="L9"><code class="language-cs"><span class="pun">修改起来也不难，只需要统一标准就行，有两种方式：</span></code></li><li class="L1"><code class="language-cs"><span class="typ">Point</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> ctrl</span><span class="pun">.</span><span class="typ">Parent</span><span class="pun">.</span><span class="typ">PointToScreen</span><span class="pun">(</span><span class="pln">ctrl</span><span class="pun">.</span><span class="typ">Location</span><span class="pun">);</span></code></li><li class="L2"><code class="language-cs"></code></li><li class="L3"><code class="language-cs"><span class="pun">或</span></code><span class="typ">Point</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> ctrl</span><span class="pun">.</span><span class="typ">PointToScreen</span><span class="pun">(</span><span class="pln">ctrl</span><span class="pun">.</span><span class="typ">ClientRectangle</span><span class="pun">.</span><span class="typ">Location</span><span class="pun">);</span></li><li class="L9"><code class="language-cs"><span class="pun">最简单的代码上出了问题</span></code></li></ol></pre></div><div><br></div></div><div>6. 初始化日期编辑器的格式及限制编辑内容.</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">        public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">FormatDateEdit</span><span class="pun">(</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraEditors</span><span class="pun">.</span><span class="typ">DateEdit</span><span class="pln"> de</span><span class="pun">)</span></code></li><li class="L1"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L2"><code class="language-cs"><span class="pln">            de</span><span class="pun">.</span><span class="typ">Properties</span><span class="pun">.</span><span class="typ">DisplayFormat</span><span class="pun">.</span><span class="typ">FormatString</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">DateFormatStr</span><span class="pun">;</span></code></li><li class="L3"><code class="language-cs"><span class="pln">            de</span><span class="pun">.</span><span class="typ">Properties</span><span class="pun">.</span><span class="typ">EditFormat</span><span class="pun">.</span><span class="typ">FormatString</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">DateFormatStr</span><span class="pun">;</span></code></li><li class="L4"><code class="language-cs"><span class="pln">            de</span><span class="pun">.</span><span class="typ">Properties</span><span class="pun">.</span><span class="typ">Mask</span><span class="pun">.</span><span class="typ">EditMask</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CYSoft</span><span class="pun">.</span><span class="typ">Platform</span><span class="pun">.</span><span class="typ">Common</span><span class="pun">.</span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">DateFormatStr</span><span class="pun">;</span></code></li><li class="L5"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li></ol></pre></div><div>&nbsp; &nbsp; 其中Mask属性包含自动完成等属性. 对应界面设置(摘录自机构管理FrmOrgnManage)<span style="line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span></div></div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">this</span><span class="pun">.</span><span class="pln">repositoryItemDateEdit1</span><span class="pun">.</span><span class="typ">EditFormat</span><span class="pun">.</span><span class="typ">FormatType</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">Utils</span><span class="pun">.</span><span class="typ">FormatType</span><span class="pun">.</span><span class="typ">DateTime</span><span class="pun">;</span></code></li><li class="L1"><code class="language-cs"><span class="kwd">this</span><span class="pun">.</span><span class="pln">repositoryItemDateEdit1</span><span class="pun">.</span><span class="typ">EditFormat</span><span class="pun">.</span><span class="typ">FormatString</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CYSoft</span><span class="pun">.</span><span class="typ">Platform</span><span class="pun">.</span><span class="typ">Common</span><span class="pun">.</span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">DateFormatStr</span><span class="pun">;</span></code></li><li class="L2"><code class="language-cs"><span class="kwd">this</span><span class="pun">.</span><span class="pln">repositoryItemDateEdit1</span><span class="pun">.</span><span class="typ">DisplayFormat</span><span class="pun">.</span><span class="typ">FormatType</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">Utils</span><span class="pun">.</span><span class="typ">FormatType</span><span class="pun">.</span><span class="typ">DateTime</span><span class="pun">;</span></code></li><li class="L3"><code class="language-cs"><span class="kwd">this</span><span class="pun">.</span><span class="pln">repositoryItemDateEdit1</span><span class="pun">.</span><span class="typ">DisplayFormat</span><span class="pun">.</span><span class="typ">FormatString</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CYSoft</span><span class="pun">.</span><span class="typ">Platform</span><span class="pun">.</span><span class="typ">Common</span><span class="pun">.</span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">DateFormatStr</span><span class="pun">;</span></code></li><li class="L4"><code class="language-cs"><span class="kwd">this</span><span class="pun">.</span><span class="pln">repositoryItemDateEdit1</span><span class="pun">.</span><span class="typ">Mask</span><span class="pun">.</span><span class="typ">MaskType</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraEditors</span><span class="pun">.</span><span class="typ">Mask</span><span class="pun">.</span><span class="typ">MaskType</span><span class="pun">.</span><span class="typ">DateTime</span><span class="pun">;</span></code></li><li class="L5"><code class="language-cs"><span class="kwd">this</span><span class="pun">.</span><span class="pln">repositoryItemDateEdit1</span><span class="pun">.</span><span class="typ">Mask</span><span class="pun">.</span><span class="typ">EditMask</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CYSoft</span><span class="pun">.</span><span class="typ">Platform</span><span class="pun">.</span><span class="typ">Common</span><span class="pun">.</span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">DateFormatStr</span><span class="pun">;</span></code></li><li class="L6"><code class="language-cs"><span class="kwd">this</span><span class="pun">.</span><span class="pln">repositoryItemDateEdit1</span><span class="pun">.</span><span class="typ">EditMask</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CYSoft</span><span class="pun">.</span><span class="typ">Platform</span><span class="pun">.</span><span class="typ">Common</span><span class="pun">.</span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">DateFormatStr</span><span class="pun">;</span></code></li></ol></pre></div><div><br></div><div>7. GridExportToXls及TreeExportToXls方法.</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">GridExportToXls</span><span class="pun">(</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraGrid</span><span class="pun">.</span><span class="typ">GridControl</span><span class="pln"> grid</span><span class="pun">)</span></code></li><li class="L1"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">TreeExportToXls</span><span class="pun">(</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraTreeList</span><span class="pun">.</span><span class="typ">TreeList</span><span class="pln"> tree</span><span class="pun">)</span></code></li></ol></pre></div><div><br></div></div><div>8, 设置相应控件readonly属性取反</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">SetControlReadOnly</span><span class="pun">(</span><span class="typ">Control</span><span class="pln"> ctrl</span><span class="pun">,</span><span class="pln"> bool readOnly</span><span class="pun">)//</span></code></li></ol></pre></div><div><br></div></div><div>9. 设置相应地编辑列. &nbsp;暂时未使用</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">static</span><span class="pln"> </span><span class="typ">RepositoryItemLookUpEdit</span><span class="pln"> </span><span class="typ">RepsItemLookUpEdit</span><span class="pun">(</span><span class="typ">DataTable</span><span class="pln"> dT</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> codeField</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> nameField</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> widthCode</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> widthName</span><span class="pun">)</span></code></li></ol></pre></div><div><br></div></div><div>10. 初始化RepositoryLookupEdit.&nbsp;</div><div>&nbsp; &nbsp; a. 方法<br></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">InitRepsLookUpEdit</span><span class="pun">(</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraEditors</span><span class="pun">.</span><span class="typ">Repository</span><span class="pun">.</span><span class="typ">RepositoryItemLookUpEdit</span><span class="pln"> lookUpEdit</span><span class="pun">,</span></code><span class="typ">DataTable</span><span class="pln"> dt</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> fields</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> captions</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pun">[]</span><span class="pln"> widths</span><span class="pun">,</span><span class="kwd">string</span><span class="pln"> valueMember</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> displayMember</span><span class="pun">)</span></li></ol></pre></div></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraEditors</span><span class="pun">.</span><span class="typ">Repository</span><span class="pun">.</span><span class="typ">RepositoryItemLookUpEdit</span><span class="pln"> ri1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraEditors</span><span class="pun">.</span><span class="typ">Repository</span><span class="pun">.</span><span class="typ">RepositoryItemLookUpEdit</span><span class="pun">();</span></code></li><li class="L1"><code class="language-cs"></code></li><li class="L2"><code class="language-cs"><span class="pln">            UI</span><span class="pun">.</span><span class="typ">Common</span><span class="pun">.</span><span class="typ">Function</span><span class="pun">.</span><span class="typ">InitRepsLookUpEdit</span><span class="pun">(</span><span class="pln">ri1</span><span class="pun">,</span></code></li><li class="L3"><code class="language-cs"><span class="pln">                <b><i><u><font color="#ff0000">IC</font></u></i></b></span><b><i><u><font color="#ff0000"><span class="pun">.</span><span class="typ">Common</span><span class="pun">.</span><span class="typ">Enumerate</span><span class="pun">.</span><span class="typ">DtEnumFuncSort</span><span class="pun">(),</span></font></u></i></b></code></li><li class="L4"><code class="language-cs"><span class="pln">               </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumHelp</span><span class="pun">.</span><span class="typ">Code</span><span class="pun">,</span></code></li><li class="L5"><code class="language-cs"><span class="pln">                   </span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumHelp</span><span class="pun">.</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">},</span></code></li><li class="L6"><code class="language-cs"><span class="pln">               </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"编码"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"名称"</span><span class="pln"> </span><span class="pun">},</span></code></li><li class="L7"><code class="language-cs"><span class="pln">               </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">int</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">80</span><span class="pln"> </span><span class="pun">},</span></code></li><li class="L8"><code class="language-cs"><span class="pln">               </span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumHelp</span><span class="pun">.</span><span class="typ">Code</span><span class="pun">,</span></code></li><li class="L9"><code class="language-cs"><span class="pln">               </span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumHelp</span><span class="pun">.</span><span class="typ">Name</span><span class="pun">);</span></code></li><li class="L0"><code class="language-cs"></code></li><li class="L1"><code class="language-cs"><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">treeFunc</span><span class="pun">.</span><span class="typ">Columns</span><span class="pun">[</span><span class="pln">A0Func</span><span class="pun">.</span><span class="typ">Fields</span><span class="pun">.</span><span class="typ">FuncSort</span><span class="pun">].</span><span class="typ">ColumnEdit</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> ri1</span><span class="pun">;</span></code></li></ol></pre></div><div>&nbsp; &nbsp; b. 相应的方法调用如上面展示. 使用CYConst.EnumHelp下常量完成值的初始化. Value列code,显示Name.<br></div></div><div>&nbsp; &nbsp; c. DtEnumFuncSort()方法返回DataTable. 相应列及值的赋值代码如下:<span style="line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span><span style="line-height: 1.6;">&nbsp; &nbsp; struct结构的好处是...</span></div><div>&nbsp; &nbsp; d. 对表列及表数值的赋值.<span style="line-height: 1.6;"><br></span></div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> </span><span class="typ">DtEnumFuncSort</span><span class="pun">()</span></code></li><li class="L1"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L2"><code class="language-cs"><span class="pln">            </span><span class="typ">DataTable</span><span class="pln"> dt </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CYSoft</span><span class="pun">.</span><span class="typ">Platform</span><span class="pun">.</span><span class="typ">Common</span><span class="pun">.</span><span class="typ">CYEnumerate</span><span class="pun">.</span><span class="typ">DTEnum</span><span class="pun">(</span><span class="typ">Type</span><span class="pun">.</span><span class="typ">GetType</span><span class="pun">(</span><span class="str">"System.Int32"</span><span class="pun">));</span><span class="com">//完成表结构生成</span></code></li><li class="L3"><code class="language-cs"></code></li><li class="L4"><code class="language-cs"><span class="pln">            </span><span class="kwd">foreach</span><span class="pln"> </span><span class="pun">(</span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumData</span><span class="pln"> ed </span><span class="kwd">in</span><span class="pln"> </span><span class="typ">EnumFuncSort</span><span class="pun">())</span></code></li><li class="L5"><code class="language-cs"><span class="pln">                dt</span><span class="pun">.</span><span class="typ">Rows</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="pln">ed</span><span class="pun">.</span><span class="typ">Code</span><span class="pun">,</span><span class="pln"> ed</span><span class="pun">.</span><span class="typ">Name</span><span class="pun">);</span></code></li><li class="L6"><code class="language-cs"></code></li><li class="L7"><code class="language-cs"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> dt</span><span class="pun">;</span></code></li><li class="L8"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li></ol></pre></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> </span><span class="typ">DTEnum</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="typ">Type</span><span class="pln"> type</span><span class="pun">)</span></code></li><li class="L1"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L2"><code class="language-cs"><span class="pln">            </span><span class="typ">DataTable</span><span class="pln"> dt </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pun">(</span><span class="str">"DTEnum"</span><span class="pun">);</span></code></li><li class="L3"><code class="language-cs"><span class="pln">            dt</span><span class="pun">.</span><span class="typ">Columns</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumHelp</span><span class="pun">.</span><span class="typ">Code</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">);</span></code></li><li class="L4"><code class="language-cs"><span class="pln">            dt</span><span class="pun">.</span><span class="typ">Columns</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumHelp</span><span class="pun">.</span><span class="typ">Name</span><span class="pun">);</span></code></li><li class="L5"><code class="language-cs"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> dt</span><span class="pun">;</span></code></li><li class="L6"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li></ol></pre></div><div><label class="wiz-todo-label wiz-todo-label-unchecked"><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumData</span><span class="pun">[]</span><span class="pln"> </span><span class="typ">EnumFuncSort</span><span class="pun">()</span></code></li><li class="L1"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L2"><code class="language-cs"><span class="pln">            </span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumData</span><span class="pun">[]</span><span class="pln"> ed </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CYConst</span><span class="pun">.</span><span class="typ">EnumData</span><span class="pun">[</span><span class="lit">6</span><span class="pun">];</span></code></li><li class="L3"><code class="language-cs"><span class="pln">            ed</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="typ">Code</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Convert</span><span class="pun">.</span><span class="typ">ToInt32</span><span class="pun">(</span><span class="typ">FuncSort</span><span class="pun">.</span><span class="typ">FuncGroup</span><span class="pun">).</span><span class="typ">ToString</span><span class="pun">();</span><span class="pln"> ed</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"功能组"</span><span class="pun">;</span></code></li><li class="L4"><code class="language-cs"><span class="pln">            ed</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="typ">Code</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Convert</span><span class="pun">.</span><span class="typ">ToInt32</span><span class="pun">(</span><span class="typ">FuncSort</span><span class="pun">.</span><span class="typ">FuncItem</span><span class="pun">).</span><span class="typ">ToString</span><span class="pun">();</span><span class="pln"> ed</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"功能项"</span><span class="pun">;</span></code></li><li class="L5"><code class="language-cs"><span class="pln">            ed</span><span class="pun">[</span><span class="lit">2</span><span class="pun">].</span><span class="typ">Code</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Convert</span><span class="pun">.</span><span class="typ">ToInt32</span><span class="pun">(</span><span class="typ">FuncSort</span><span class="pun">.</span><span class="typ">Html</span><span class="pun">).</span><span class="typ">ToString</span><span class="pun">();</span><span class="pln"> ed</span><span class="pun">[</span><span class="lit">2</span><span class="pun">].</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"网页"</span><span class="pun">;</span></code></li><li class="L6"><code class="language-cs"><span class="pln">            ed</span><span class="pun">[</span><span class="lit">3</span><span class="pun">].</span><span class="typ">Code</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Convert</span><span class="pun">.</span><span class="typ">ToInt32</span><span class="pun">(</span><span class="typ">FuncSort</span><span class="pun">.</span><span class="typ">Exe</span><span class="pun">).</span><span class="typ">ToString</span><span class="pun">();</span><span class="pln"> ed</span><span class="pun">[</span><span class="lit">3</span><span class="pun">].</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"外部程序"</span><span class="pun">;</span><span class="pln"> </span></code></li><li class="L7"><code class="language-cs"><span class="pln">            ed</span><span class="pun">[</span><span class="lit">4</span><span class="pun">].</span><span class="typ">Code</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Convert</span><span class="pun">.</span><span class="typ">ToInt32</span><span class="pun">(</span><span class="typ">FuncSort</span><span class="pun">.</span><span class="typ">MenuGroup</span><span class="pun">).</span><span class="typ">ToString</span><span class="pun">();</span><span class="pln"> ed</span><span class="pun">[</span><span class="lit">4</span><span class="pun">].</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"菜单组"</span><span class="pun">;</span></code></li><li class="L8"><code class="language-cs"><span class="pln">            ed</span><span class="pun">[</span><span class="lit">5</span><span class="pun">].</span><span class="typ">Code</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Convert</span><span class="pun">.</span><span class="typ">ToInt32</span><span class="pun">(</span><span class="typ">FuncSort</span><span class="pun">.</span><span class="typ">MenuItem</span><span class="pun">).</span><span class="typ">ToString</span><span class="pun">();</span><span class="pln"> ed</span><span class="pun">[</span><span class="lit">5</span><span class="pun">].</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"菜单项"</span><span class="pun">;</span></code></li><li class="L9"><code class="language-cs"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> ed</span><span class="pun">;</span></code></li><li class="L0"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li></ol></pre></div><div><br></div><div>11. 统一消息提示. \</div><div>&nbsp; &nbsp; &nbsp;ShowChangeSave(), ShowSaveOk(), ShowOfflineSaveOK(), ShowMsg()等.</div><div><br></div><div>12. `InitGridStyle`及`InitTreeStyle`完成样式的设置, 都已经在各自的init中完成.&nbsp;InitGrid及InitTree.</div><div><br></div><div>13. &nbsp;设置EnumHelp相应内容.</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">InitEnumHelp</span><span class="pun">(</span><span class="typ">DevExpress</span><span class="pun">.</span><span class="typ">XtraEditors</span><span class="pun">.</span><span class="typ">LookUpEdit</span><span class="pln"> lokUpEd</span><span class="pun">,</span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> fields</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> captions</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pun">[]</span><span class="pln"> widths</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> dt</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> valueMember</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> displayMember</span><span class="pun">)</span></code></li></ol></pre></div><div><br></div></div><div>14.&nbsp;TreeCollapseAll方法.&nbsp;MergeDT 合并DataTable到DataSet中.</div><div><br></div><div><br></div></label></div></div><div><br></div><div>&nbsp;</div></div></div></body></html>