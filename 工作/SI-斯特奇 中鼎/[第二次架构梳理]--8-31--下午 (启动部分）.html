<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--defaultCSS-->
<title>[第二次架构梳理]--8/31--下午 (启动部分）</title>



<style type="text/css" id="wiz_custom_css">
body
{
    font-family: Microsoft YaHei UI,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>

<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style><link type="text/css" rel="stylesheet" id="wiz_code_highlight_link" href="[第二次架构梳理]--8-31--下午 (启动部分）_files/wiz_code_highlight_23.css"></head>

<body  style="">1. MainWindow启动。 主要布局，ViewBox自动缩放功能；托盘；最大化，最小化，关闭按钮。（为什么设计视图里面我看不了）<div>2. 初始化init资源，全局加载，XMPP消息加载。 【mainWindow.xaml】。</div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="typ">Global</span><span class="pun">.</span><span class="typ">Init</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="typ">Global</span><span class="pun">.</span><span class="typ">XMPPClient</span><span class="pun">.</span><span class="typ">Init</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pun"><pre style="font-family:Lucida Sans Unicode;font-size:13;color:black;background:white;"><span style="color:green;">//初始化头像数据库</span><span style="color:#2b91af;">Global</span>.SQLiteClient.InitAvater();</pre><pre style="font-family:Lucida Sans Unicode;font-size:13;color:black;background:white;"><pre style="font-family: 'Lucida Sans Unicode'; background-position: initial initial; background-repeat: initial initial;"><span style="color:#2b91af;">Task</span>.Factory.StartNew(()&nbsp;=&gt;&nbsp;{&nbsp;CheckUpdate(<span style="color:blue;">true</span>);&nbsp;}); //异步检查更新
pageFrame.Navigate(<span style="color:#2b91af;">Global</span>.LoginPage); //导航至登陆界面</pre></pre></span></code></li></ol></pre></div><div>3. 登陆界面。</div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp; 1.根据user_name获得&nbsp;</font><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 1.5; color: rgb(43, 145, 175);">Global</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; background-color: white; line-height: 1.5;">.Ywtoken。--异常出现，网络。</span><br style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 1.5;"></div><div><font face="Consolas">&nbsp; 2.根据user_name和 获得的Ywtoken 获得</font><span style="font-size: 10.5pt; line-height: 1.5;">Global.Ywstaffroles.Roleid。--无权限等问题。</span><span style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; background-color: white; line-height: 1.5;"><br></span></div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp; 3. 验证用户名，密码等。</font><br></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="typ">Global</span><span class="pun">.</span><span class="typ">HttpClient</span><span class="pun">.</span><span class="typ">RequestLoginEvent</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyHttpClient</span><span class="pun">.</span><span class="typ">RequestLoginEventHandler</span><span class="pun">(</span><span class="typ">RequestLogin</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="typ">Global</span><span class="pun">.</span><span class="typ">HttpClient</span><span class="pun">.</span><span class="typ">RequestLogin</span><span class="pun">(</span><span class="pln">user_name</span><span class="pun">,</span><span class="pln"> user_pass</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><span style="color: rgb(43, 145, 175);">Global</span><span style="background-color: white; color: black;">.SetIsRemmemberPwd(user_name,&nbsp;remPwd.IsChecked.Value); //看不懂，待定</span></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><span style="color: rgb(43, 145, 175);">Global</span><span style="background-color: white; color: black;">.SetIsAutoLogin(user_name,&nbsp;autologin.IsChecked.Value);</span></li></ol></pre></div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp; &nbsp;登陆事件？ &nbsp; &nbsp;&nbsp;</font><span style="font-size: 10.5pt; line-height: 1.5;">XMPPLoginEvent XMPP登陆事件</span></div><div><font face="Microsoft YaHei UI">4. a) 初始化个人数据库。登陆事件&nbsp;</font><span style="font-size: 10.5pt; line-height: 1.5;">RequestLoginEvent</span><font face="Microsoft YaHei UI" style="font-size: 10.5pt; line-height: 1.5;">&nbsp;--&gt; b)根据电脑端和电脑网卡信息获得Resource。--&gt;</font><span style="font-size: 10.5pt; line-height: 1.5;">c)根据IMAccount和资源Resource和IMPassword完成XMMP事件&nbsp;</span><span style="font-size: 10.5pt; line-height: 1.5;">XMPPLoginEvent</span><span style="font-size: 10.5pt; line-height: 1.5;">。</span></div></div><div>--&gt;d)减少登陆和XMMP 如上两个时间后，完成MainWindow.load(). 【Login.xaml】</div><div>5）设置完MainWindow后，Navigate至MainPage。--》设置样式，托盘可用【MainWindow.xaml】.&nbsp;</div><div>6）更新通讯录，导航至global首页，服务Page页面等。【MainPage.xaml】</div><div>7) 至此， 进入【YwShouye.xmal】和【YwFuwuPage.xmal】.init_page_data</div><div><br></div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp;&nbsp;</font><font face="Microsoft YaHei UI"><br></font></div></body></html>