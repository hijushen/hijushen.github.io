<!DOCTYPE html>
<html>
    <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        
        


        
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />

<link rel="dns-prefetch" href="http://res.wx.qq.com/">
<link rel="dns-prefetch" href="http://mmbiz.qpic.cn/">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">


        <title>利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离的开发环境</title>
        
<link rel="stylesheet" type="text/css" href="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/page_mp_article_improve2a7a3f.css">
<style>
     
    </style>
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_pc2a7a3f.css">
<![endif]-->


    </head>
    <body id="activity-detail" class="zh_CN mm_appmsg" ontouchstart="">
        
    
    
    <div id="js_cmt_mine" class="discuss_container editing access" style="display:none;">
        <div class="discuss_container_inner">
            <h2 class="rich_media_title">利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离的开发环境</h2>
            <span id="log"></span>
            <div class="frm_textarea_box_wrp">
                <span class="frm_textarea_box">
                    <textarea id="js_cmt_input" class="frm_textarea" placeholder="留言将由公众号筛选后显示，对所有人可见。"></textarea>
                    <div class="emotion_tool">
                        <span class="emotion_switch" style="display:none;"></span>
                        <span id="js_emotion_switch" class="pic_emotion_switch_wrp">
                            <img class="pic_default" src="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/icon_emotion_switch.2x278965.png" alt="">
                            <img class="pic_active" src="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/icon_emotion_switch_active.2x278965.png" alt="">
                        </span>
                        <div class="emotion_panel" id="js_emotion_panel">
                            <span class="emotion_panel_arrow_wrp" id="js_emotion_panel_arrow_wrp">
                                <i class="emotion_panel_arrow arrow_out"></i>
                                <i class="emotion_panel_arrow arrow_in"></i>
                            </span>
                            <div class="emotion_list_wrp" id="js_slide_wrapper">
                                
                                
                            </div>
                            <ul class="emotion_navs" id="js_navbar">
                                
                            </ul>
                        </div>
                    </div>
                </span>
            </div>
            <div class="discuss_btn_wrp"><a id="js_cmt_submit" class="btn btn_primary btn_discuss btn_disabled" href="">提交</a></div>
            <div class="discuss_list_wrp" style="display:none">
                <div class="rich_tips with_line title_tips discuss_title_line">
                    <span class="tips">我的留言</span>
                </div>
                <ul class="discuss_list" id="js_cmt_mylist"></ul>
            </div>
            <div class="rich_tips tips_global loading_tips" id="js_mycmt_loading">
                <img src="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/icon_loading_white2805ea.gif" class="rich_icon icon_loading_white" alt="">
                <span class="tips">加载中</span>
            </div>
            <div class="wx_poptips" id="js_cmt_toast" style="display:none;">
                <img alt="" class="icon_toast" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAABqCAYAAABUIcSXAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3NpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyMTUxMzkxZS1jYWVhLTRmZTMtYTY2NS0xNTRkNDJiOGQyMWIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTA3QzM2RTg3N0UwMTFFNEIzQURGMTQzNzQzMDAxQTUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTA3QzM2RTc3N0UwMTFFNEIzQURGMTQzNzQzMDAxQTUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NWMyOGVjZTMtNzllZS00ODlhLWIxZTYtYzNmM2RjNzg2YjI2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjIxNTEzOTFlLWNhZWEtNGZlMy1hNjY1LTE1NGQ0MmI4ZDIxYiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pmvxj1gAAAVrSURBVHja7J15rF1TFMbXk74q1ZKHGlMkJVIhIgg1FH+YEpEQJCKmGBpThRoSs5jVVNrSQUvEEENIhGiiNf9BiERICCFIRbUiDa2qvudbOetF3Tzv7XWGffa55/uS7593977n3vO7e5+199p7v56BgQGh0tcmvAUERREUQVEERREUQVEERREUQVEERREUQVEERREUQVEERREUQVEERVAUQVEERVAUQbVYk+HdvZVG8b5F0xj4RvhouB+eCy8KrdzDJc1RtAX8ILxvx98V1GyCSkN98Cx4z/95/Wn4fj6j6tUEeN4wkFSnw1MJqj5NhBfAuwaUHREUg4lqNMmePVsHll/HFhVfe1t3FwpJI8DXCCquDrCWNN4B6Tb4M3Z98aTPmTvh0YHl18PXw29yZiKejoPvcUD6E74yFBJbVDk6Bb7K8aP/Hb4c/tRzEYIqprPhSxzlf4Uvhb/0Xoig8qnHAJ3lqPMzfDH8XZ4LEpRf2sVdA5/sqPO9Qfop70UJyn+/boaPddT5yrq7VUUvTIVJI7q74MMddXR8NB1eXcYvhBpZm0s2w72/o86HFoKvLau/pYaXzjLMdUJ6y0LwtWV9CIIaXtvA8+G9HHV03u5q+K+yH47U0NoRngPv7KjzHDwTLj0bS1BDazfJJlcnOOostC6ysnCT+q80G/sIvFVgeW09D8FPVT0uoP7VfvAD8NjA8pqmuAN+OcYAjso0RbIZ8DGB5TVNcRO8JMaHY9SXSdfa3eeANJimWBLrA7JFiZwIXye+NMUV8CcxP2SRFjXefok7NRjSGZJlWUPvw2/wtNiQirSoXWyMsR28wR7AzzYM0oXw+Y7yK+CLJGeaoqjyrJSdZJD6Ov4+z5y6NJc0Az7NUecHydIUy+v60KNyQHoM3nKI1y7YCFiq0i7uBvgER52vDdKqWn9djhY1Dn4G3n6Ecqm2rF74dvgoR53S0hQxW9RJAZAGW5bSn58QJA27dQ7uIEedjywEX5NKVxCqsY6y+qA+LxFI4+yZ6oH0trWkNan80jygtIUsc5SflgAsDXgehfdx1KkkTRE76tN+Xue2jnTU0Ru1oIbvpt30bBtKhOp5yaaRkts0lic8V1i6dPcIRx2d/l8Y8XtNNEg7OOo8bl1kmmOKnDsO88CaYzejau0hWZqiL7C83oCH4SeTHvwV2BqqsHRVztSEYOmWF80NeXZT6Hd4KflResE9vCnBOlCyGfDNAstHTVPUDWoQ1t3iW+9WNizvlhfd4aerXd+ThqiMfNR6+9LvOOro5OY5JX2H4+F7HZD+kGzlamMgldWiirQsjcwWFbjmqZJteekJLK9pisvgL6RhKvuciZiwzrWWGapfrPy30kBVcSBIrw0aD3PU0XB6cehntq7rTMf7/2iQlktDVdXJLXlg6VjmiYBn6rWSTRCH6hvJ0hQrpcGq8oidsmHpTP8t8DGO9/vcWt9qabiqPgup1yKyQwvC2tSefZ73SSpNkUJ4PlLorlHZ+446nc8f3fIyywlJhwrTuwVSjBa1ccvSxN0hjjoK5xVrYZMd9V6XbFfgBukixTwGLg8sDam3dZR/wZ6L/dJlin1en8LS+bgpFbz3Ygvzu1J1HKxYNqxGpCmaCEo12rrBorD6LRp8UbpcdR5VWhTW35KlKd6QFqjuM2XzwlpnMxTvSkuUwuG/Xlg6NtPjbT6WFimF/VG6LEvXgn8QGDjMbBukVECFwhpoS+CQatfX2Q1q6H7wENHdrfCr0lKleEB9JyxNneus+VJpsVL9TwI6W65LovWIGl3KtVJaLv7LBwYTFEERFEVQFEERFEVQFEERFEVQFEERFEVQFEERFEVQFEERFFWq/hFgADUMN4RzT6/OAAAAAElFTkSuQmCC">
                <p class="toast_content">已留言</p>
            </div>
        </div>
    </div>

    <div id="js_article" class="rich_media">
        
        <div id="js_top_ad_area" class="top_banner">
 
        </div>
                

        <div class="rich_media_inner">
            <div id="page-content">
                <div id="img-content" class="rich_media_area_primary">
                    <h2 class="rich_media_title" id="activity-name">
                        利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离的开发环境 
                    </h2>
                    <div class="rich_media_meta_list">
                        						                        <em id="post-date" class="rich_media_meta rich_media_meta_text">2016-03-04</em>

                                                <a class="rich_media_meta rich_media_meta_link rich_media_meta_nickname" href="" id="post-user">前端大全</a>
                        <span class="rich_media_meta rich_media_meta_text rich_media_meta_nickname">前端大全</span>

                        <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                            <div class="profile_inner">
                                <strong class="profile_nickname">前端大全</strong>
                                <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                                <p class="profile_meta">
                                <label class="profile_meta_label">微信号</label>
                                <span class="profile_meta_value">FrontDev</span>
                                </p>

                                <p class="profile_meta">
                                <label class="profile_meta_label">功能介绍</label>
                                <span class="profile_meta_value">分享&nbsp;Web&nbsp;前端相关的技术文章、工具资源、精选课程、热点资讯</span>
                                </p>
                                
                            </div>
                            <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                                <i class="profile_arrow arrow_out"></i>
                                <i class="profile_arrow arrow_in"></i>
                            </span>
                        </div>
                    </div>
                    
                    
                    
                    
                                                            
                                                            
                    
                    <div class="rich_media_content " id="js_content">
                        
                        <p style="line-height: 25.6px; white-space: normal; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); text-align: center; box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><strong style="line-height: 25.6px; color: rgb(255, 0, 0);"><span style="color: rgb(192, 0, 0);"><strong style="color: rgb(0, 176, 80); border: 0px;"><span style="color: rgb(0, 176, 240);"><span style="color: rgb(255, 0, 0); font-size: 14px; max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">(点击</span><span style="font-size: 14px; max-width: 100%; color: rgb(0, 112, 192); box-sizing: border-box !important; word-wrap: break-word !important;">上方<span style="max-width: 100%;">公<span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">众</span>号</span></span></span></strong></span></strong><strong style="line-height: 25.6px;"><span style="color: rgb(255, 0, 0); font-size: 14px; max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">，可快速关注)</span></strong><br  /></p><p style="line-height: 25.6px; white-space: normal; text-align: center;"><span style="color: rgb(255, 0, 0);"></span></p><p style="line-height: 25.6px; white-space: normal;"><span style="color: rgb(0, 176, 80); font-size: 14px;"><br  /></span></p><blockquote style="line-height: 25.6px; white-space: normal;"><p><span style="font-size: 14px; color: rgb(0, 176, 80);">作者：流云诸葛</span><br  /></p><p><span style="color: rgb(0, 176, 80); font-size: 14px;">网址：http://www.cnblogs.com/lyzg/p/5224063.html</span></p></blockquote><p style="line-height: 25.6px; white-space: normal;"><br  /></p><p>前后端分离这个词一点都不新鲜，完全的前后端分离在岗位协作方面，前端不写任何后台，后台不写任何页面，双方通过接口传递数据完成软件的各个功能实现。此种情况下，前后端的项目都独立开发和独立部署，在开发期间有2个问题不可避免：第一是前端调用后台接口时的跨域问题（因为前后端分开部署）；第二是前端脱离后台服务后无法独立运行。本文总结最近一个项目的工作经验，介绍利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离的开发环境的实践过程，希望能对你有所帮助。</p><p><br  /></p><p>注：</p><p><br  /></p><p>（1）本文的相关内容需对前端构建工具grunt有所了解：http://www.gruntjs.net/getting-started，这个工具可以完成前端所有的工程化工作，包括代码和图片压缩，文件合并，静态资源替换，js混淆，less和sass编译成css等等，推荐没有用过类似工具的前端开发人员去了解。</p><p><br  /></p><p>（2）grunt-contrib-connect和grunt-connect-proxy是grunt提供的两个插件，前者可以启动一个基于nodejs的静态服务器，这样前端就能脱离后端通过web服务的方式来访问自己开发的东西；后者可以把前端项目里面某些特殊的请求代理到其它服务器，哪些请求能够通过代理转发到别的服务器，这个规则都是可配置的，这样就能把一些跟后台交互的请求通过代理的方式，在开发期间，转发到后端的服务来处理，从而避免跨域问题。</p><p><br  /></p><p>代码下载（http://files.cnblogs.com/files/lyzg/proxy_demo.zip）</p><p><span style="color: rgb(255, 0, 0);"><strong><br  /></strong></span></p><p><span style="color: rgb(255, 0, 0);"><strong>1.效果演示</strong></span></p><p><br  /></p><p>在前面提供的代码中，里面有两个文件夹：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.3582887700534759" data-w="374"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0.png" /></p><p><br  /></p><p>分别代表前后端独立运行的两个项目，client表示前端，server表示服务端。在实际运行client和server里面的服务之前，请确保已经安装好了grunt-cli，如果没有安装，请按照grunt的文档先安装好grunt-cli这个npm的包。如果你已经安装好了grunt-cli，那么进入到client或者server文件夹下，就能直接使用grunt的命令来启动服务了，不需要再运行npm install 来安装依赖了，因为client和server文件夹下已经包含进了下载好的依赖。在实际的前后端项目中，server端可以是任何架构类型的项目，java web ,php, asp.net等等都可以，demo里面为了简单模拟一个后台服务，于是就利用grunt启动一个静态服务来充当server端，不过它实际上的作用跟java web等传统后端项目是一样的。</p><p><br  /></p><p>为了看到请求被代理转发的效果，请先在server文件夹下启动服务，命令是：grunt staticServer：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.4174397031539889" data-w="539"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_2.png" /></p><p><br  /></p><p>只要看到跟截图运行类似的结果，就表示server端的服务启动成功。从截图中还能看到server端的服务的访问地址是：http://localhost:9002/。</p><p><br  /></p><p>然后在client文件夹下启动配置了代理的服务，命令是：grunt proxyServer：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.5845323741007195" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_3.png" /></p><p><br  /></p><p>只要看到跟截图运行类似的结果，就表示client端的服务启动成功。从截图中能看到client端服务的访问地址是：http://localhost:9001/，同时还可以看到服务代理的配置：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.5625" data-w="64"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_4.png" /></p><p><br  /></p><p>这段运行结果说明，client端里面以/provider开头的请求都会被代理转发，并且会被代理到http://localhost:9002/provider 来处理。举例来说，假如在client端里面发起一个请求，这个请求的URL是：http://localhost:9001/provider/query/json/language/list，那么最终处理这个请求的服务地址实际上是：http://localhost:9002/provider/query/json/language/list。</p><p><br  /></p><p>client端启动之后，应该会自动打开浏览器，访问http://localhost:9001/，显示的是client端的首页。打开首页之后，按F12打开开发者工具，如果在控制台看到如下类似的消息，就说明首页里的请求正确地通过代理请求到了服务端的数据：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.5557553956834532" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_5.png" /></p><p><br  /></p><p>在client的首页里面，我发起了一个ajax请求，请求地址为http://localhost:9001/provider/query/json/language/list，在client文件夹下根本不存在provider文件夹，所以如果没有代理的话，这个请求肯定会报404的错误；它之所以能够正确的加载，完全是因为通过代理，请求到了server文件夹下相应的文件：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.18525179856115107" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_6.png" /></p><p><br  /></p><p>如果不通过代理，在localhost:9001/的服务里，请求localhost:9002/的数据是肯定会有跨域问题的，而代理可以完美的解决这个问题。</p><p><br  /></p><p>前面这一小部分演示了demo里面如何通过代理来解决跨域问题，下面一部分演示如何在脱离后端服务的情况下如何正常运行前端项目，首先请关闭之前打开的client服务和server端服务以及浏览器打开的client页面，然后打开client/Gruntfile.js文件，找到以下部分：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.5323741007194245" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_7.png" /></p><p><br  /></p><p>把provider改成api，把false改成true；</p><p><br  /></p><p>接着在client文件夹，运行非代理的静态服务，这个服务不会配置代理，启动命令是：grunt staticServer：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.4748201438848921" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_8.png" /></p><p><br  /></p><p>打开浏览器的开发者工具，在控制台应该可以看到如下消息：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.44064748201438847" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_9.png" /></p><p><br  /></p><p>这个过程是：原来通过代理请求地址是：http://localhost:9001/provider/query/json/language/list，在没有代理的时候，我会把http://localhost:9001/provider/query/json/language/list这个请求改成请求http://localhost:9001/api/query/json/language/list.json ，而在我client文件夹下存在这个json文件：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.329136690647482" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_10.png" /></p><p><br  /></p><p>也就是说我会把跟服务端所有接口的返回的数据都按相同的路径，在本地以json文件的形式存在api文件夹下，在没有代理的时候，只要请求这些json文件，就能保证我所有的操作都能正确请求到数据，前端的项目也就能脱离代理运行起来了，当然这个模式下的数据都是静态的了。</p><p><br  /></p><p>接下来我会介绍如何前面这些内容的实现细节，只介绍client里面的要点，server里面的内容很简单，只要搞清楚了client，server一看就懂：）</p><p><br  /></p><p><span style="color: rgb(255, 0, 0);"><strong>2. Grunt配置</strong></span></p><p><br  /></p><p>在了解配置之前，先要熟悉项目的文件夹结构：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.8544600938967136" data-w="426"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_11.png" /></p><p><br  /></p><p>仅仅是为了完成demo，所以项目的文件夹结构和Grunt配置都做了最大程度的简化，目的就是为了方便理解，本文提供的不是一个解决方案，而是一个思路，在你有需要的时候可以参考改进应用到自己的项目当中，在前端工程化这一块，要用到的插件比demo里面要用到的多的多，你得按需配置。就demo而言，最核心的插件当然是grunt-contrib-connect和grunt-connect-proxy，但是要完成demo，也离不开一些其它的插件：</p><p><br  /></p><p>load-grunt-tasks：我用它一次性加载package.json里面的所有插件：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.13513513513513514" data-w="444"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_12.png" /></p><p><br  /></p><p>grunt-contrib-copy：我用它来复制src里面的内容，粘贴到dist目录下：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.4892086330935252" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_13.png" /></p><p><br  /></p><p>只要运行grunt copy任务，就会看到项目结构了多了一个dist文件夹：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.9282178217821783" data-w="404"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_14.png" /></p><p><br  /></p><p>grunt-contrib-watch： 我用它监听文件的改变，并自动执行定义的grunt任务，同时还可以通过livereload自动刷新浏览器页面：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.5161870503597122" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_15.png" /></p><p><br  /></p><p>grunt-replace：我用它来替换文件中某些特殊字符串，这样就能够在不手动更改源代码的情况下改变代码。非代理模式之所以能请求到本地的静态json数据，并不是因为我手动改变了请求地址，而是改变了请求地址处理函数中的处理规则，这个规则的改变实际上就是通过grunt-replace来做的：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.5584158415841585" data-w="505"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_16.png" /></p><p><br  /></p><p>替换的规则通过getReplaceOptions这个函数来配置：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="1" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_17.jpg" /></p><p><br  /></p><p>注意注释部分的说明，所谓的本地模式，其实就是运行grunt staticServer的时候，代理模式就是运行grunt proxyServer的时候，这段注释要求在运行grunt staticServer之前必须先把API_NAME改成api，把DEVELOP_MODE改成true，只有这样那些需要代理的请求才会请求本地的json文件，在运行grunt proxyServer之前必须先把API_NAME改成provider，把DEVELOP_MODE改成false，只有这样才能正确地将需要代理的请求进行转发。</p><p><br  /></p><p><span style="color: rgb(255, 0, 0);"><strong>3. 重点：grunt-contrib-connect和grunt-connect-proxy的配置</strong></span></p><p><br  /></p><p>在grunt任务配置中，通常每个插件都会配置成一个任务，但是grunt-connect-proxy不是这样，它是与grunt-contrib-connect一起配置的：</p><p><br  /></p><blockquote><p><span style="font-size: 12px;">connect: {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; options: {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; port: &#39;9001&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; hostname: &#39;localhost&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; protocol: &#39;http&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; open: true,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; base: {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; path: &#39;./&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options: {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; index: &#39;html/index.html&#39;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; livereload: true</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; },</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; proxies: [</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; context: &#39;/&#39; + API_NAME,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; host: &#39;localhost&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port: &#39;9002&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; https: false,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; changeOrigin: true,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rewrite: proxyRewrite</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; ],</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; default: {},</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; proxy: {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; options: {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; middleware: function (connect, options) {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!Array.isArray(options.base)) {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.base = [options.base];</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Setup the proxy</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var middlewares = [require(&#39;grunt-connect-proxy/lib/utils&#39;).proxyRequest];</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Serve static files.</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.base.forEach(function (base) {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; middlewares.push(serveStatic(base.path, base.options));</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Make directory browse-able.</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*var directory = options.directory || options.base[options.base.length - 1];</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;middlewares.push(connect.directory(directory));</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return middlewares;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">}</span></p></blockquote><p><br  /></p><p>在以上配置中：</p><p><br  /></p><p>options节是通用的配置，用来配置要启动的静态服务器信息，port表示端口，hostname表示主机地址，protocol表示协议比如http,https，open表示静态服务启动之后是否以默认浏览器打开首页base.options.index指定的页面，base.path用来配置站点的根目录，demo中把根目录配置成了当前的项目文件夹（./）；</p><p><br  /></p><p>以上配置都在配置grunt-contrib-connect任务里面，但是上面配置中的proxies节其实是grunt-connect-proxy需要的，用来配置代理信息：context配置需要被代理的请求前缀，通常配置成/开头的一段字符串，比如/provider，这样相对站点根目录的并以provider开头的请求都会被代理到；host,port,https用来配置要代理到的服务地址，端口以及所使用的协议；changeOrigin配置成true即可；rewrite用来配置代理规则，proxyRewrite这个变量在配置文件的前面有定义：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.23618090452261306" data-w="398"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_18.png" /></p><p><br  /></p><p>意思就是把client端里provider开头的部分，替换成代理服务的/provider/目录来处理，注意/provider/这个字符串最后的斜杠不能省略！比如client里有一个请求http://localhost:9001/provider/query/json/language/list，就会被代理到http://localhost:9002/provider/query/json/language/list来处理；</p><p><br  /></p><p>default是一个connect任务的目标，用它启动静态服务；</p><p><br  /></p><p>proxy也是一个connect任务的目标，用它启动代理服务，由于在demo里，watch任务和connect任务都启用了livereload，所以要在proxy任务里加上一个middleware中间件的配置，才能保证正确启动代理，这段代码是官网的提供的，直接使用即可。里面有一个serveStatic模块，在配置文件的前面已经引入过：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.06679389312977099" data-w="524"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_19.png" /></p><p><br  /></p><p>这个是grunt启动静态服务必须的，照着用就行了。</p><p><br  /></p><p>最后看下静态服务和代理服务的相关任务定义：</p><p><br  /></p><blockquote><p><span style="font-size: 12px;">grunt.registerTask(&#39;staticServer&#39;, &#39;启动静态服务......&#39;, function () {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; grunt.task.run([</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &#39;copy&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &#39;replace&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &#39;connect:default&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &#39;watch&#39;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; ]);</span></p><p><span style="font-size: 12px;">});</span></p><p><br  /></p><p><span style="font-size: 12px;">grunt.registerTask(&#39;proxyServer&#39;, &#39;启动代理服务......&#39;, function () {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; grunt.task.run([</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &#39;copy&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &#39;replace&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &#39;configureProxies:proxy&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &#39;connect:proxy&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &#39;watch&#39;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; ]);</span></p><p><span style="font-size: 12px;">});</span></p></blockquote><p><br  /></p><p>在配置代理服务的时候，&#39;configureProxies:proxy&#39;一定要加，而且要加在connect:proxy之前，否则代理配置还没有注册成功，静态服务就启动完毕了，configureProxies这个任务并不是在配置文件中配置的，而是grunt-connect-proxy插件里面定义的，只要grunt-connect-proxy被加载进来，这个任务就能用。</p><p><br  /></p><p><span style="color: rgb(255, 0, 0);"><strong>4. 如何发送请求</strong></span></p><p><br  /></p><p>这部分看看如何发送请求，打开首页，会看到底部引用了4个js文件：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.37050359712230213" data-w=""   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_20.png" /></p><p><br  /></p><p>其中util.js封装了处理请求地址的功能：</p><p><br  /></p><blockquote><p><span style="font-size: 12px;">var DEVELOP_MODE = &#39;@@DEVELOP_MODE&#39;;</span></p><p><br  /></p><p><span style="font-size: 12px;">var Util = (function(){</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; var BASE_URL = location.protocol + &#39;//&#39; + location.hostname +</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; (location.port == &#39;&#39; ? &#39;&#39; : (&#39;:&#39; + location.port)) + &#39;/&#39; + &#39;@@CONTEXT_PATH&#39;;</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; return {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; api: function (requestPath) {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var pathParts = requestPath.split(&#39;?&#39;);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pathParts[0] = pathParts[0] + (DEVELOP_MODE == &#39;true&#39; ? &#39;.json&#39; : &#39;&#39;);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return BASE_URL + &#39;@@API_NAME/&#39; + pathParts.join(&#39;?&#39;);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">})();</span></p></blockquote><p><br  /></p><p>这是源代码，还记得那个replace的任务吗，它的替换规则是</p><p style="text-align: center;"><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="1.2087155963302751" data-w="436"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_21.jpg" /></p><p><br  /></p><p>replace任务会把文件中以@@开头，按照patterns里面的配置，将匹配到的字符串替换成对应的串。在本地模式下，API_NAME是api,DEVELOP_MODE是true，CONTEXT_PATH始终是空，经过replace任务处理之后，util.js的代码会变成：</p><p><br  /></p><blockquote><p><span style="font-size: 12px;">var DEVELOP_MODE = &#39;true&#39;;</span></p><p><br  /></p><p><span style="font-size: 12px;">var Util = (function(){</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; var BASE_URL = location.protocol + &#39;//&#39; + location.hostname +</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; (location.port == &#39;&#39; ? &#39;&#39; : (&#39;:&#39; + location.port)) + &#39;/&#39; + &#39;&#39;;</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; return {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; api: function (requestPath) {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var pathParts = requestPath.split(&#39;?&#39;);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pathParts[0] = pathParts[0] + (DEVELOP_MODE == &#39;true&#39; ? &#39;.json&#39; : &#39;&#39;);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return BASE_URL + &#39;api/&#39; + pathParts.join(&#39;?&#39;);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">})();</span></p></blockquote><p><br  /></p><p>在代理模式下，API_NAME是provider,DEVELOP_MODE是false，util.js经过replace之后就会变成：</p><p><br  /></p><blockquote><p><span style="font-size: 12px;">var DEVELOP_MODE = &#39;false&#39;;</span></p><p><br  /></p><p><span style="font-size: 12px;">var Util = (function(){</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; var BASE_URL = location.protocol + &#39;//&#39; + location.hostname +</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; (location.port == &#39;&#39; ? &#39;&#39; : (&#39;:&#39; + location.port)) + &#39;/&#39; + &#39;&#39;;</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; return {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; api: function (requestPath) {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var pathParts = requestPath.split(&#39;?&#39;);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pathParts[0] = pathParts[0] + (DEVELOP_MODE == &#39;true&#39; ? &#39;.json&#39; : &#39;&#39;);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return BASE_URL + &#39;provider/&#39; + pathParts.join(&#39;?&#39;);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">})();</span></p></blockquote><p><br  /></p><p>这样同一个请求地址，比如query/json/language/list，经过Util.api处理之后：</p><p><br  /></p><p>Util.api(&#39;query/json/language/list&#39;)</p><p><br  /></p><p>在本地模式下就会返回：http://localhost:9001/api/query/json/language/list.json</p><p><br  /></p><p>在代理模式下返回：http://localhost:9001/provider/query/json/language/list</p><p><br  /></p><p>ajax.js对jquery的ajax进行了一下包装：</p><p><br  /></p><blockquote><p><span style="font-size: 12px;">var Ajax = (function(){</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; function create(_url, _method, _data, _async, _dataType) {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; //添加随机数</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; if (_url.indexOf(&#39;?&#39;) &gt; -1) {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _url = _url + &#39;&amp;rnd=&#39; + Math.random();</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _url = _url + &#39;?rnd=&#39; + Math.random();</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; //为请求添加ajax标识，方便后台区分ajax和非ajax请求</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; _url += &#39;&amp;_ajax=true&#39;;</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; return $.ajax({</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; url: _url,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dataType: _dataType,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; async: _async,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: (DEVELOP_MODE == &#39;true&#39; ? &#39;get&#39; : _method),</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data: _data</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; }</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; var ajax = {},</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; methods = [</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: &#39;html&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: &#39;get&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; async: true,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dataType: &#39;html&#39;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: &#39;get&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: &#39;get&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; async: true,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dataType: &#39;json&#39;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: &#39;post&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: &#39;post&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; async: true,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dataType: &#39;json&#39;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: &#39;syncGet&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: &#39;get&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; async: false,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dataType: &#39;json&#39;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: &#39;syncPost&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: &#39;post&#39;,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; async: false,</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dataType: &#39;json&#39;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; ];</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; for(var i = 0, l = methods.length; i &lt; l; i++) {</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; ajax[methods[i].name] = (function(i){</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return function(){</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var _url = arguments[0],</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _data = arguments[1],</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _dataType = arguments[2] || methods[i].dataType;</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return create(_url, methods[i].method, _data, methods[i].async, _dataType);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; &nbsp; &nbsp; })(i);</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; }</span></p><p><br  /></p><p><span style="font-size: 12px;">&nbsp; &nbsp; //window.Ajax = ajax;</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; return ajax;</span></p><p><span style="font-size: 12px;">})();</span></p></blockquote><p><br  /></p><p>提供了Ajax.get,Ajax.post,Ajax.syncGet,Ajax.syncPost以及Ajax.html这五个方法，之所以要封装成这样原因有2个：</p><p><br  /></p><p>第一是，统一加上随机数和ajax请求的标识：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.3314447592067989" data-w="353"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_22.png" /></p><p><br  /></p><p>第二是，grunt-contrib-connect所启动的静态服务，只能发送get请求，不能发送post请求，所以如果在代码中有写$.post的调用就无法脱离后端服务运行起来，会报405 Method not Allowed的错误，而这个封装可以把Ajax.post这样的请求，在本地模式的时候全部替换成get方式来处理：</p><p><br  /></p><p style="text-align: center;"><img  class="" data-type="png" data-ratio="0.3227176220806794" data-w="471"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_23.png" /></p><p><br  /></p><p>这其实还是replace任务的功劳！</p><p><br  /></p><p>index.js就是首页发请求的js了，可以看看：</p><p><br  /></p><blockquote><p><span style="font-size: 12px;">Ajax.get(Util.api(&#39;query/json/language/list&#39;)).done(function(response){</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; console.log(response.data);</span></p><p><span style="font-size: 12px;">}).fail(function(){</span></p><p><span style="font-size: 12px;">&nbsp; &nbsp; console.log(&#39;请求失败&#39;);</span></p><p><span style="font-size: 12px;">});</span></p></blockquote><p><br  /></p><p>结合util.js和ajax.js，相信你很快就能明白这个过程了。</p><p><br  /></p><p><span style="color: rgb(255, 0, 0);"><strong>5. 线上如何部署前后端的服务</strong></span></p><p><br  /></p><p>答案还是代理。开发期间，前端通过grunt-connect-proxy把某个命名空间下的请求全部代理到了后端服务来处理，线上部署的时候后端把项目部署到tomcat这种web服务器里，前端把项目部署到Nginx服务器，然后请运维人员按照开发期间的代理规则，在Nginx服务器上加反向代理的配置，把浏览器请求前端的那些需要后端支持的请求，全部代理到tomcat服务器下的后端服务来处理。也就是说线上部署跟开发期间的交互原理是一样的，只不过代理的提供者变成Nginx而已。</p><p><br  /></p><p><strong><span style="color: rgb(255, 0, 0);">6. 小结</span></strong></p><p><br  /></p><p>本文总结自己这段时间做一个前后端分离的项目的一些环境准备方面的经验，文中提到的方法帮助我们解决了跨域和前端独立运行的两大问题，现在项目开发的情况非常顺利，所以从我自身的实践来说，本文的内容是比较有参考价值的，希望能够帮助到有需要的人，谢谢阅读：）</p><p><br  /></p><p style="line-height: 25.6px; white-space: normal; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); text-align: center; box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><br  /></p><p style="line-height: 25.6px; white-space: normal;"><br  /></p><p style="line-height: 25.6px; max-width: 100%; min-height: 1em; white-space: pre-wrap; color: rgb(62, 62, 62); text-align: center; box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><span style="max-width: 100%; color: rgb(136, 136, 136); line-height: 28.4444px; box-sizing: border-box !important; word-wrap: break-word !important;">【今日微信公号推荐↓】</span></p><p style="line-height: 25.6px; max-width: 100%; min-height: 1em; white-space: pre-wrap; color: rgb(62, 62, 62); text-align: center; box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><img  data-type="png" data-ratio="0.6258992805755396" data-w="" style="line-height: 25.6px; white-space: normal;"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/640.jpg" /></p><p style="line-height: 25.6px; max-width: 100%; min-height: 1em; white-space: pre-wrap; color: rgb(62, 62, 62); text-align: center; box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">更多推荐请看</span><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">《</span></strong><a href="http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&mid=402186355&idx=1&sn=72be66e2caaaebb3cc436b2f5fb6ee0c&scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&amp;mid=402186355&amp;idx=1&amp;sn=72be66e2caaaebb3cc436b2f5fb6ee0c&amp;scene=21#wechat_redirect"><span style="max-width: 100%; color: rgb(255, 169, 0); box-sizing: border-box !important; word-wrap: break-word !important;">值得关注的技术和设计公众号</span></a><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 16px; box-sizing: border-box !important; word-wrap: break-word !important;">》</span></strong></span></p><p style="line-height: 25.6px; max-width: 100%; min-height: 1em; white-space: pre-wrap; color: rgb(62, 62, 62); box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><span style="max-width: 100%; font-size: 14px; color: rgb(136, 136, 136); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></span></p><p style="line-height: 25.6px; max-width: 100%; min-height: 1em; white-space: pre-wrap; color: rgb(62, 62, 62); box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><span style="max-width: 100%; font-size: 14px; color: rgb(136, 136, 136); box-sizing: border-box !important; word-wrap: break-word !important;">其中推荐了包括<strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">技术</strong>、<strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">设计</strong>、<strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">极客&nbsp;</strong>和&nbsp;<strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">IT相亲</strong>相关的热门公众号。技术涵盖：Python、Web前端、Java、安卓、iOS、PHP、C/C++、.NET、Linux、数据库、运维、大数据、算法、IT职场等。点击《</span><a href="http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&mid=402186355&idx=1&sn=72be66e2caaaebb3cc436b2f5fb6ee0c&scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&amp;mid=402186355&amp;idx=1&amp;sn=72be66e2caaaebb3cc436b2f5fb6ee0c&amp;scene=21#wechat_redirect"><span style="max-width: 100%; font-size: 14px; color: rgb(255, 169, 0); box-sizing: border-box !important; word-wrap: break-word !important;">值得关注的技术和设计公众号</span></a><span style="max-width: 100%; font-size: 14px; color: rgb(136, 136, 136); box-sizing: border-box !important; word-wrap: break-word !important;">》，发现精彩！</span></p><p style="line-height: 25.6px; max-width: 100%; min-height: 1em; white-space: pre-wrap; color: rgb(62, 62, 62); text-align: center; box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><span style="max-width: 100%; font-size: 14px; color: rgb(136, 136, 136); box-sizing: border-box !important; word-wrap: break-word !important;"><img data-s="300,640" data-type="jpeg"  data-ratio="0.8129496402877698" data-w="" style="line-height: 25.6px; white-space: normal;"   SRC="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/0_24.jpg" /></span></p>
                    </div>
                    
                    <link rel="stylesheet" type="text/css" href="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/page_mp_article_improve_combo2a7a3f.css">
                    
                    
                                        
                                        
                                        <div class="rich_media_tool" id="js_toobar3">
                                                                    <a class="media_tool_meta meta_primary" id="js_view_source" href="">阅读原文</a>
                                                <div id="js_read_area3" class="media_tool_meta tips_global meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                        <span style="display:none;" class="media_tool_meta meta_primary tips_global meta_praise" id="like3">
                            <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                        </span>

                        <a id="js_report_article3" style="display:none;" class="media_tool_meta tips_global meta_extra" href="">投诉</a>

                    </div>
                </div>

                <div class="rich_media_area_extra">

                    
                                        <div class="mpda_bottom_container" id="js_bottom_ad_area">
                        
                    </div>
                                        
                    <div id="js_iframetest" style="display:none;"></div>

                    
                                        <div class="rich_media_extra" id="js_cmt_area" style="display:none">

                        <div class="discuss_container" id="js_cmt_main" style="display:none">
                            <div class="rich_tips with_line title_tips discuss_title_line">
                                <span class="tips">精选留言</span>
                            </div>
                            <p class="tips_global tc title_bottom_tips" id="js_cmt_nofans1" style="display:none;">关注该公众号可参与留言</p>
                            <p class="discuss_icon_tips title_bottom_tips tr" id="js_cmt_addbtn1" style="display:none">
                                
                                                                <a href="#comment">写留言<img class="icon_edit" src="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/icon_edit25ded2.png" alt=""></a>
                                                            </p>
                            <ul class="discuss_list" id="js_cmt_list"></ul>
                        </div>


                        <div class="tips_global rich_split_tips tc" id="js_cmt_nofans2" style="display:none;">
                            关注该公众号可参与留言
                        </div>

                        <p class="discuss_icon_tips rich_split_tips tr" id="js_cmt_addbtn2" style="display:none">
                            
                                                        <a href="#comment">写留言<img class="icon_edit" src="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/icon_edit25ded2.png" alt=""></a>
                                                    </p>

                        <p class="rich_split_tips tc tips_global" id="js_cmt_tips" style="display:none;"></p>


                        <div class="rich_tips tips_global loading_tips" id="js_cmt_loading">
                            <img src="利用grunt-contrib-connect和grunt-connect-proxy搭建前后端分离_files/icon_loading_white2805ea.gif" class="rich_icon icon_loading_white" alt="">
                            <span class="tips">加载中</span>
                        </div>

                        <div class="rich_tips with_line tips_global" id="js_cmt_statement" style="display:none">
                            <span class="tips">以上留言由公众号筛选后显示</span>
                        </div>

                        <p class="rich_split_tips tc" id="js_cmt_qa" style="display:none;">
                            <a href="http://kf.qq.com/touch/sappfaq/150211YfyMVj150313qmMbyi.html?scene_id=kf264">
                                了解留言功能详情
                            </a>
                        </p>

                    </div>
                                    </div>
               
            </div>
            <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
                <div class="qr_code_pc_inner">
                    <div class="qr_code_pc">
                        <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                        <p>微信扫一扫<br>关注该公众号</p>
                    </div>
                </div>
            </div>

        </div>
    </div>


        
        
        
    

    
  

  


    </body>
</html>

 
