<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--defaultCSS-->
<title>[基础知识] session的存储方式和配置--[50/100][8/15][55/135][C#](10/30)</title>



<style type="text/css" id="wiz_custom_css">
body
{
    font-family: Microsoft YaHei UI,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>

<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style></head>

<body  style=""><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">Session又称为会话状态，是Web系统中最常用的状态，用于维护和当前浏览器实例相关的一些信息。我们控制用户去权限中经常用到Session来存储用户状态，这篇文章会讲下Session的存储方式、在web.config中如何配置Session、Session的生命周期等内容。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　<strong style="margin: 0px; padding: 0px;">1、Session的存储方式。</strong></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　session其实分为客户端Session和服务器端Session。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　当用户首次与Web<span style="margin: 0px; padding: 0px;">服务器</span>建立连接的时候，服务器会给用户分发一个 SessionID作为标识。SessionID是一个由24个字符组成的随机字符串。用户每次提交页面，浏览器都会把这个SessionID包含在 HTTP头中提交给Web服务器，这样Web服务器就能区分当前请求页面的是哪一个客户端。这个SessionID就是保存在客户端的，属于客户端Session。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　其实客户端Session默认是以cookie的形式来存储的，所以当用户禁用了cookie的话，服务器端就得不到SessionID。这时我们可以使用url的方式来存储客户端Session。也就是将SessionID直接写在了url中，当然这种方法不常用。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　我们大多数提到的Session都是指服务器端Session。他有三种存储方式(自定义存储在这里不做讨论)：</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　<span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">1.1保存在IIS进程中：</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px;">　　保存在IIS进程中是指把Session数据保存在IIS的运行的进程中，也就是inetinfo.exe这个进程中，这也是默认的Session的存方式，也是最常用的。</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px;">　　这种方式的优点是简单，性能最高。但是当重启IIS服务器时Session丢失。</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">　　1.2.保存在StateServer上</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　这种存储模式是指将Session数据存储在一个称为Asp.Net状态服务进程中，该进程独立于Asp.Net辅助进程或IIS应用程序池的单独进程，使用此模式可以确保在重新启动Web应用程序时保留会话状态，并使会话状态可以用于网络中的多个Web服务器。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">　　1.3.保存在SQL Server数据库中</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　可以配置把Session数据存储到SQL Server数据库中，为了进行这样的配置，程序员首先需要准备SQL Server数据服务器，然后在运行.NET自带安装工具安装状态数据库。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　这种方式在服务器挂掉重启后都还在，因为他存储在内存和磁盘中。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　下面是这三种方式的比较：</p><table border="1" cellspacing="0" cellpadding="0" style="margin: 0px; padding: 0px; border-spacing: 0px; border-color: silver; word-break: break-word; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><tbody style="margin: 0px; padding: 0px;"><tr style="margin: 0px; padding: 0px;"><td valign="top" width="107" style="margin: 0px; padding: 3px; border-color: silver;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></td><td valign="top" width="156" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">InProc</span></p></td><td valign="top" width="174" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">StateServer</span></p></td><td valign="top" width="181" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">SQLServer</span></p></td></tr><tr style="margin: 0px; padding: 0px;"><td valign="top" width="107" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">存储物理位置</span></p></td><td valign="top" width="156" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">IIS进程（内存）</span></p></td><td valign="top" width="174" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">Windows服务进程（内存）</span></p></td><td valign="top" width="181" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">SQLServer数据库（磁盘）</span></p></td></tr><tr style="margin: 0px; padding: 0px;"><td valign="top" width="107" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">存储类型限制</span></p></td><td valign="top" width="156" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">无限制</span></p></td><td valign="top" width="174" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">可以序列化的类型</span></p></td><td valign="top" width="181" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">可以序列化的类型</span></p></td></tr><tr style="margin: 0px; padding: 0px;"><td valign="top" width="107" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">存储大小限制</span></p></td><td colspan="3" valign="top" width="511" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">无限制</span></p></td></tr><tr style="margin: 0px; padding: 0px;"><td valign="top" width="107" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">使用范围</span></p></td><td colspan="3" valign="top" width="511" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">当前请求上下文，对于每个用户独立</span></p></td></tr><tr style="margin: 0px; padding: 0px;"><td valign="top" width="107" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">生命周期</span></p></td><td colspan="3" valign="top" width="511" style="margin: 0px; padding: 3px; border-color: silver;"><p align="center" style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">第一次访问网站的时候创建Session超时后销毁</span></p></td></tr><tr style="margin: 0px; padding: 0px;"><td valign="top" width="107" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">优点</span></p></td><td valign="top" width="156" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">性能比较高</span></p></td><td colspan="2" valign="top" width="355" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">Session不依赖Web服务器，不容易丢失</span></p></td></tr><tr style="margin: 0px; padding: 0px;"><td width="107" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">缺点</span></p></td><td width="156" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">容易丢失</span></p></td><td valign="top" width="174" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">序列化与反序列化消耗CPU资源</span></p></td><td valign="top" width="181" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">序列化与反序列化消耗CPU资源，从磁盘读取Session比较慢</span></p></td></tr><tr style="margin: 0px; padding: 0px;"><td valign="top" width="107" style="margin: 0px; padding: 3px; border-color: silver;"><p style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">使用原则</span></p></td><td colspan="3" valign="top" width="511" style="margin: 0px; padding: 3px; border-color: silver;"><p align="center" style="margin: 10px auto; padding: 0px;"><span style="margin: 0px; padding: 0px;">不要存放大量数据</span></p><div style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px;">&nbsp;</span></div></td></tr></tbody></table><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px;">&nbsp;</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><strong style="margin: 0px; padding: 0px;">　　2、在web.config中配置Session</strong></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　Web.config文件中的Session配置信息：</p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid rgb(204, 204, 204); overflow: auto; widows: 1; background-color: rgb(245, 245, 245); font-family: 'Courier New' !important; font-size: 12px !important;"><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px;"><span class="cnblogs_code_copy" style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.5 !important;"><a href="" title="复制代码" style="margin: 0px; padding: 1px 3px; color: green; text-decoration: none; border: none !important;"><img src="[基础知识] session的存储方式和配置--[50-100][8-15][55-135][C#]_files/1a5950e5-6a20-4c94-aefd-17989c329638.gif" alt="复制代码" style="margin: 0px; padding: 0px; border-style: none !important;"></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important;">&lt;sessionState mode=<span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">Off|InProc|StateServer|SQLServer</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><br style="margin: 0px; padding: 0px;"><br style="margin: 0px; padding: 0px;">cookieless=<span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">true|false</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><br style="margin: 0px; padding: 0px;"><br style="margin: 0px; padding: 0px;">timeout=<span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">number of minutes</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><br style="margin: 0px; padding: 0px;"><br style="margin: 0px; padding: 0px;">stateConnectionString=<span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">tcpip=server:port</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><br style="margin: 0px; padding: 0px;"><br style="margin: 0px; padding: 0px;">sqlConnectionString=<span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">sql connection string</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><br style="margin: 0px; padding: 0px;"><br style="margin: 0px; padding: 0px;">stateNetworkTimeout=<span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">number of seconds</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><br style="margin: 0px; padding: 0px;"><br style="margin: 0px; padding: 0px;">/&gt;</pre><div class="cnblogs_code_toolbar" style="margin: 5px 0px 0px; padding: 0px;"><span class="cnblogs_code_copy" style="margin: 0px; padding: 0px 5px 0px 0px; line-height: 1.5 !important;"><a href="" title="复制代码" style="margin: 0px; padding: 1px 3px; color: green; text-decoration: none; border: none !important;"><img src="[基础知识] session的存储方式和配置--[50-100][8-15][55-135][C#]_files/1a5950e5-6a20-4c94-aefd-17989c329638.gif" alt="复制代码" style="margin: 0px; padding: 0px; border-style: none !important;"></a></span></div></div><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　mode 设置将Session信息存储到哪里：</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　　　—&nbsp;Off 设置为不使用Session功能；</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　　　—&nbsp;InProc 设置为将Session存储在进程内，就是ASP中的存储方式，这是默认值；</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　　　—&nbsp;StateServer 设置为将Session存储在独立的状态服务中；</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　　　—&nbsp;SQLServer 设置将Session存储在SQL Server中。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　cookieless 设置客户端的Session信息存储到哪里：</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　　　—&nbsp;ture 使用Cookieless模式；这时客户端的Session信息就不再使用Cookie存储了，而是将其通过URL存储。比如网址为http://localhost/MyTestApplication/(ulqsek45heu3ic2a5zgdl245)/default.aspx</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　　　—&nbsp;false 使用Cookie模式，这是默认值。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　timeout 设置经过多少分钟后服务器自动放弃Session信息。默认为20分钟。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　stateConnectionString 设置将Session信息存储在状态服务中时使用的服务器名称和端口号，例如："tcpip=127.0.0.1:42424”。当mode的值是StateServer是，这个属性是必需的。（42424是默认端口）。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　sqlConnectionString 设置与SQL Server连接时的连接字符串。例如"data source=localhost;Integrated Security=SSPI;Initial Catalog=northwind"。当mode的值是SQLServer时，这个属性是必需的。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　stateNetworkTimeout 设置当使用StateServer模式存储Session状态时，经过多少秒空闲后，断开Web服务器与存储状态信息的服务器的TCP/IP连接的。默认值是10秒钟。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><strong style="margin: 0px; padding: 0px;">&nbsp;</strong></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">　　下面来说下用StateServer和SqlServer来存储Session的方法</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">　　2.1&nbsp;StateServer</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px;">　　第1步是打开状态服务。依次打开“控制面板”→“管理工具”→“服务”命令，找到ASP.NET状态服务一项，右键单击服务选择启动。</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px;">　　如果你正式决定使用状态服务存储Session前，别忘记修改服务为自启动（在操作系统重启后服务能自己启动）以免忘记启动服务而造成网站Session不能使用</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px;">　　</span>第2步，在system.web节点中加入：stateNetworkTimeout="20"&gt;&nbsp;&nbsp;stateConnectionString表示状态服务器的通信地址（IP：服务端口号）。由于我们现在在本机进行测试，这里设置成本机地址127.0.0.1。状态服务默认的监听端口为42422。当然，您也可以通过修改注册表来修改状态服务的端口号。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　(修改注册表来修改状态服务的端口号的方法：在运行中输入regedit启动注册表编辑器—依次打开HKEY_LOCAL_MACHINESYSTEMCurrentControlSetServicesaspnet_stateParameters节点，双击Port选项—选择基数为十进制，然后输入一个端口号即可。)</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">　　2.2&nbsp;SqlServer</span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　在SQL Server中执行一个叫做InstallSqlState.sql的脚本文件。这个脚本文件将在SQL Server中创建一个用来专门存储Session信息的数据库，及一个维护Session信息数据库的SQL Server代理作业。我们可以在以下路径中找到那个文件：</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">[system drive]\winnt\Microsoft.NET\Framework\[version]\&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">然后打开查询分析器，连接到SQL Server服务器，打开刚才的那个文件并且执行。稍等片刻，数据库及作业就建立好了。这时，你可以打开企业管理器，看到新增了一个叫ASPState的数据库。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　修改mode的值改为SQLServer。注意，还要同时修改sqlConnectionString的值，格式为：sqlConnectionString="data source=localhost; Integrated Security=SSPI;"(这种是通过windows集成身份验证)</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);"><strong style="margin: 0px; padding: 0px;">　　3、Session的生命周期</strong></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　Session的生命周期其实在第一节已经讲过了，和不同的存储过程有关。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　<strong style="margin: 0px; padding: 0px;">　4、遍历以及销毁Session</strong></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　<span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">　4.1遍历：</span></p><div class="cnblogs_code" style="margin: 5px 0px; padding: 5px; border: 1px solid rgb(204, 204, 204); overflow: auto; widows: 1; background-color: rgb(245, 245, 245); font-family: 'Courier New' !important; font-size: 12px !important;"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important;">System.Collections.IEnumerator SessionEnum = Session.Keys.GetEnumerator();<br style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255); line-height: 1.5 !important;">while</span> (SessionEnum.MoveNext())<br style="margin: 0px; padding: 0px;">{<br style="margin: 0px; padding: 0px;">    Response.Write(Session[SessionEnum.Current.ToString()].ToString() + <span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span> <span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span>);<br style="margin: 0px; padding: 0px;">}</pre></div><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.9200000762939px; line-height: 16.7040004730225px; widows: 1; background-color: rgb(255, 255, 255);">　　<span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">4.2 销毁：Session.Abandon()。</span></p><br><div style="color:gray"><small>来源：&nbsp;&lt;<a href="http://www.cnblogs.com/zhangkai2237/archive/2012/03/22/2410890.html">http://www.cnblogs.com/zhangkai2237/archive/2012/03/22/2410890.html</a><small>&gt;</small></small></div><small><small>&nbsp;</small></small></body></html>