<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>多线程调用Web Service的注意事项</title><?xml version="1.0" encoding="UTF-8"?>


<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="font-family: Consolas; line-height: 20px; font-size: 15px;">多线程调用Web Service的注意事项</div><div style="font-family: Consolas; line-height: 20px; font-size: 15px;">2010-08-29 18:22:17 &nbsp;&nbsp;来源:源码之家 站长整理 &nbsp;&nbsp; 【<a>大</a>&nbsp;<a>中</a>&nbsp;<a>小</a>】 &nbsp;&nbsp;浏览:<font>1608&nbsp;</font>次</div><table align="center" cellpadding="0" cellspacing="0" style="color: rgb(51, 51, 51); font-family: Consolas; line-height: 20px; table-layout: fixed; word-wrap: break-word; font-size: 15px;" width="100%"><tbody><tr><td align="left"><p><font face="宋体">&nbsp;&nbsp;&nbsp; 一段在主线程下调试成功的代码，移植到多线程下就不一定完全可行（虽然编译通过）。</font></p><font face="宋体"><br/></font><p><font face="宋体">&nbsp;&nbsp;&nbsp; 比如刚刚写的一段调用远程WebService的代码，每次点击“开始”按钮，就报错“尚未调用coinitialize”，检查了一下代码，貌似没发现有啥不妥，没法子，只有百度去了。</font></p><font face="宋体"><br/></font><p><font face="宋体">&nbsp;&nbsp;&nbsp; 百度后才发现，原来多线程下使用WebService还有“秘密”：必须在使用前初始化COM环境，具体操作如下：</font></p><font face="宋体"><br/></font><p><font face="宋体">&nbsp;&nbsp;&nbsp; 1、uses&nbsp; ActiveX;</font></p><font face="宋体"><br/></font><p><font face="宋体">&nbsp;&nbsp;&nbsp; 2、使用前先CoInitialize(nil);</font></p><font face="宋体"><br/></font><p><font face="宋体">&nbsp;&nbsp;&nbsp; 3、使用完后CoUninitialize;</font></p><font face="宋体"><br/><br/></font><p><font face="宋体">&nbsp;&nbsp;&nbsp; 再次调试，搞定～～～特发此文。</font></p><font face="宋体"><br/></font><p><font face="宋体">&nbsp;&nbsp;&nbsp; 上述是delphi语法，C++等也需要如此操作，方法类似。</font></p></td></tr></tbody></table></div>