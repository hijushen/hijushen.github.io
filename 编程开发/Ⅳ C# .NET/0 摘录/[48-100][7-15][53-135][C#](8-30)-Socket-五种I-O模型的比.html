<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--defaultCSS-->
<title>[48/100][7/15][53/135][C#](8/30)--Socket,五种I/O模型的比较</title>



<style type="text/css" id="wiz_custom_css">
body
{
    font-family: Microsoft YaHei UI,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>

<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style></head>

<body  style=""><p align="center" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">五种</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">I/O</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">模型的比较</span></strong></p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">我会从以下几个方面来进行比较</span></p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">*</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">有无每线程</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">64</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">连接数限制</span></strong></p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">如果在选择模型中没有重新定义</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">FD_SETSIZE</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">宏，则每个</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">fd_set</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">默认可以装下</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">64</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">个</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">SOCKET</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">。同样的，受</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">MAXIMUM_WAIT_OBJECTS</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">宏的影响，事件选择、用事件通知实现的重叠</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">I/O</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">都有每线程最大</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">64</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">连接数限制。如果连接数成千上万，则必须对客户端套接字进行分组，这样，势必增加程序的复杂度。</span></p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">相反，异步选择、用完成例程实现的重叠</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">I/O</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">和完成端口不受此限制。</span></p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">*</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">线程数</span></strong></p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red; font-family: 宋体;">除了异步选择以外，其他模型至少需要</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red;">2</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red; font-family: 宋体;">个线程。一个主线程和一个辅助线程。同样的，如果连接数大于</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red;">64</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red; font-family: 宋体;">，则选择模型、事件选择和用事件通知实现的重叠</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red;">I/O</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red; font-family: 宋体;">的线程数还要增加。</span></p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">*</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">实现的复杂度</span></strong></p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">我的个人看法是，在实现难度上，<span style="margin: 0px; padding: 0px; line-height: 1.8; color: red;">异步选择</span></span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red;">&lt;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red; font-family: 宋体;">选择</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red;">&lt;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red; font-family: 宋体;">用完成例程实现的重叠</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red;">I/O&lt;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red; font-family: 宋体;">事件选择</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red;">&lt;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red; font-family: 宋体;">完成端口</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red;">&lt;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red; font-family: 宋体;">用事件通知实现的重叠</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; color: red;">I/O</span></p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p align="left" style="margin: 10px auto; padding: 0px; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; line-height: 20.1599998474121px; widows: 1; background-color: rgb(255, 255, 255);"><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt;">*</span></strong><strong style="margin: 0px; padding: 0px;"><span style="margin: 0px; padding: 0px; line-height: 1.8; font-size: 9pt; font-family: 宋体;">性能</span></strong></p><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); widows: 1; font-size: 9pt; font-family: 宋体; background-color: rgb(255, 255, 255);">由于选择模型中每次都要重设读集，在</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; widows: 1; font-size: 9pt; background-color: rgb(255, 255, 255);">select</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); widows: 1; font-size: 9pt; font-family: 宋体; background-color: rgb(255, 255, 255);">函数返回后还要针对所有套接字进行逐一测试，我的感觉是效率比较差；完成端口和用完成例程实现的重叠</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; widows: 1; font-size: 9pt; background-color: rgb(255, 255, 255);">I/O</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); widows: 1; font-size: 9pt; font-family: 宋体; background-color: rgb(255, 255, 255);">基本上不涉及全局数据，效率应该是最高的，而且在多处理器情形下完成端口还要高一些；事件选择和用事件通知实现的重叠</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; widows: 1; font-size: 9pt; background-color: rgb(255, 255, 255);">I/O</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); widows: 1; font-size: 9pt; font-family: 宋体; background-color: rgb(255, 255, 255);">在实现机制上都是采用</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; widows: 1; font-size: 9pt; background-color: rgb(255, 255, 255);">WSAWaitForMultipleEvents</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); widows: 1; font-size: 9pt; font-family: 宋体; background-color: rgb(255, 255, 255);">，感觉效率差不多；至于异步选择，不好比较。所以我的结论是</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); font-family: verdana, Arial, Helvetica, sans-serif; widows: 1; font-size: 9pt; background-color: rgb(255, 255, 255);">:</span><span style="margin: 0px; padding: 0px; line-height: 1.8; color: rgb(51, 51, 51); widows: 1; font-size: 9pt; font-family: 宋体; background-color: rgb(255, 255, 255);">选择</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-family: verdana, Arial, Helvetica, sans-serif; widows: 1; font-size: 9pt; color: red; background-color: rgb(255, 255, 255);">&lt;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; widows: 1; font-size: 9pt; color: red; font-family: 宋体; background-color: rgb(255, 255, 255);">用事件通知实现的重叠</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-family: verdana, Arial, Helvetica, sans-serif; widows: 1; font-size: 9pt; color: red; background-color: rgb(255, 255, 255);">I/O&lt;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; widows: 1; font-size: 9pt; color: red; font-family: 宋体; background-color: rgb(255, 255, 255);">事件选择</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-family: verdana, Arial, Helvetica, sans-serif; widows: 1; font-size: 9pt; color: red; background-color: rgb(255, 255, 255);">&lt;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; widows: 1; font-size: 9pt; color: red; font-family: 宋体; background-color: rgb(255, 255, 255);">用完成例程实现的重叠</span><span style="margin: 0px; padding: 0px; line-height: 1.8; font-family: verdana, Arial, Helvetica, sans-serif; widows: 1; font-size: 9pt; color: red; background-color: rgb(255, 255, 255);">I/O&lt;</span><span style="margin: 0px; padding: 0px; line-height: 1.8; widows: 1; font-size: 9pt; color: red; font-family: 宋体; background-color: rgb(255, 255, 255);">完成端口</span><br><div style="color:gray"><small>来源：&nbsp;&lt;<a href="http://www.cnblogs.com/nsnow/archive/2011/05/03/2036017.html">http://www.cnblogs.com/nsnow/archive/2011/05/03/2036017.html</a><small>&gt;</small></small></div><small><small>&nbsp;</small></small></body></html>