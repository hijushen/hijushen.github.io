
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>LINQ to DataSet</title><style type="text/css" id="wiz_custom_css">
body
{
    font-family: "Microsoft YaHei UI","Microsoft YaHei",SimSun,"Segoe UI",Tahoma,Helvetica,Sans-Serif,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>
<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.08">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 8px; padding-bottom: 8px; line-height: 1;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style><link type="text/css" rel="stylesheet" id="wiz_code_highlight_link" href="LINQ to DataSet_files/wiz_code_highlight.css"></head><body style="" ><h2><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font size="3"><span lang="ZH-CN" style="font-family: 宋体;"><br></span></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font size="3"><span lang="ZH-CN" style="font-family: 宋体;">相对而言，</span><font face="Calibri">LINQ TO DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">是</span><font face="Calibri">LINQ</font><span lang="ZH-CN" style="font-family: 宋体;">技术中最小的一块，虽然是</span><font face="Calibri">DB</font><span lang="ZH-CN" style="font-family: 宋体;">中抽取出来的一个离线的操作模型，但毕竟对象也是个内存里面的</span><font face="Calibri">object</font><span lang="ZH-CN" style="font-family: 宋体;">而已。所以和</span><font face="Calibri">LINQ TO Object</font><span lang="ZH-CN" style="font-family: 宋体;">相比，大多数的操作都是一样的，不同只是要根据</span><font face="Calibri">DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">，</span><font face="Calibri">DataTable</font><span lang="ZH-CN" style="font-family: 宋体;">的结构标明字段而已。下面简单的列出</span><font face="Calibri">LINQ TO DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">相比</span><font face="Calibri">LINQ TO Object<font face="宋体">一些</font>要注意</font><span lang="ZH-CN" style="font-family: 宋体;">的特色。</span></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><strong><span style="font-size: 12pt;"><font face="Calibri">Query UnTyped DataSet</font></span></strong></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font size="3"><span lang="ZH-CN" style="font-family: 宋体;">和一般的</span><font face="Calibri">LINQ</font><span lang="ZH-CN" style="font-family: 宋体;">相比，</span><font face="Calibri">query</font><span lang="ZH-CN" style="font-family: 宋体;">对象是</span><font face="Calibri">untyped DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">的时候，使用</span><font face="Calibri">Field&lt;T&gt;</font><span lang="ZH-CN" style="font-family: 宋体;">和</span><font face="Calibri">SetField&lt;T&gt;</font><span lang="ZH-CN" style="font-family: 宋体;">来读写不同的</span><font face="Calibri">column</font><span lang="ZH-CN" style="font-family: 宋体;">字段，下面是一个简单的例子：</span></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"></p><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">&nbsp;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="typ">DataTable</span><span class="pln"> orders </span><span class="pun">=</span><span class="pln"> ds</span><span class="pun">.</span><span class="typ">Tables</span><span class="pun">[</span><span class="str">"Orders"</span><span class="pun">];</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="typ">DataTable</span><span class="pln"> orderDetails </span><span class="pun">=</span><span class="pln"> ds</span><span class="pun">.</span><span class="typ">Tables</span><span class="pun">[</span><span class="str">"OrderDetails"</span><span class="pun">];</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">&nbsp;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">var query </span><span class="pun">=</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&nbsp;&nbsp;&nbsp;o in orders</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">where</span><span class="pln">&nbsp;&nbsp;&nbsp;o</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">&lt;</span><span class="typ">DateTime</span><span class="pun">&gt;(</span><span class="pln"> </span><span class="str">"OrderDate"</span><span class="pln"> </span><span class="pun">).</span><span class="typ">Year</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1998</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;orderby o</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">&lt;</span><span class="typ">DateTime</span><span class="pun">&gt;(</span><span class="pln"> </span><span class="str">"OrderDate"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> descending</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;&nbsp;o</span><span class="pun">;</span></code></li></ol></pre></div><div><br></div><p></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><span lang="ZH-CN" style="font-family: 宋体;"><font size="3">在这里大致要注意三点</font></span></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; line-height: 19px;"><font size="3"><font face="Calibri" style="background-color: rgb(255, 255, 255); font-weight: normal;">1</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-weight: normal; font-family: 宋体;">．因为</span><font face="Calibri" style="background-color: rgb(255, 255, 255);">untyped DataSet</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-family: 宋体;">没有实现</span><font face="Calibri" style="background-color: rgb(255, 255, 255);">IEnumerable&lt;T&gt;&nbsp;</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-family: 宋体;">和</span><font face="Calibri" style="background-color: rgb(255, 255, 255);">&nbsp;IQueryable&lt;T&gt;</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-family: 宋体;">的</span><font face="Calibri" style="background-color: rgb(255, 255, 255);">interface</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-weight: normal; font-family: 宋体;">，所以如果想把它作为一个可以查询的对象的话，要先用</span><font face="Calibri" style="background-color: rgb(255, 255, 255); font-weight: normal;">AsEnumerable()&nbsp;</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-weight: normal; font-family: 宋体;">或者</span><font face="Calibri" style="background-color: rgb(255, 255, 255); font-weight: normal;">AsQueryable()</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-weight: normal; font-family: 宋体;">转换一下，将它转换成</span><font face="Calibri" style="background-color: rgb(255, 255, 255); font-weight: normal;">IEnumerable&lt;T&gt;</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-weight: normal; font-family: 宋体;">或者</span><font face="Calibri" style="background-color: rgb(255, 255, 255); font-weight: normal;">IQueryable&lt;T&gt;</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-weight: normal; font-family: 宋体;">对象才能用</span><font face="Calibri" style="background-color: rgb(255, 255, 255); font-weight: normal;">LINQ</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-weight: normal; font-family: 宋体;">去查询。如：</span><font face="Calibri" style="font-weight: normal;" color="#000080"><u style="background-color: rgb(152, 251, 152);">from o in orders.AsEnumerable()</u></font></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font size="3"><font face="Calibri">2</font><span lang="ZH-CN" style="font-family: 宋体;">．一般是使用使用</span><font face="Calibri">Field&lt;T&gt;(“Column A”)</font><span lang="ZH-CN" style="font-family: 宋体;">和</span><font face="Calibri">SetField&lt;T&gt;(“Column A”)</font><span lang="ZH-CN" style="font-family: 宋体;">来读写不同的</span><font face="Calibri">column</font><span lang="ZH-CN" style="font-family: 宋体;">字段对应的</span><font face="Calibri">element</font><span lang="ZH-CN" style="font-family: 宋体;">，用它来访问相对于以前我们用</span><font face="Calibri">ds.Tables["Orders"].Row[“RowA”][ “Column A”]</font><span lang="ZH-CN" style="font-family: 宋体;">的访问模式比起来，一个很大的好处就是可以避免</span><font face="Calibri">null</font><span lang="ZH-CN" style="font-family: 宋体;">类型产生的</span><font face="Calibri">exception</font><span lang="ZH-CN" style="font-family: 宋体;">。我们以前从</span><font face="Calibri">DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">里面取数据的时候，如果取的出来的是</span><font face="Calibri">null</font><span lang="ZH-CN" style="font-family: 宋体;">，就会抛出</span><font face="Calibri">exception</font><span lang="ZH-CN" style="font-family: 宋体;">，所以我们经常作类似</span><font face="Calibri">if(ds.Tables["Orders"].Row[“RowA”][ “Column A”]!=null)</font><span lang="ZH-CN" style="font-family: 宋体;">的判断来包装我们进一步的逻辑处理，但是用</span><font face="Calibri">Field&lt;T&gt;(“Column A”)</font><span lang="ZH-CN" style="font-family: 宋体;">就可以避免这种麻烦。因为</span><font face="Calibri">Field&lt;T&gt;(“Column A”)</font><span lang="ZH-CN" style="font-family: 宋体;">是</span><font face="Calibri">nullable</font><span lang="ZH-CN" style="font-family: 宋体;">的。这个特性的由来是</span><font face="Calibri">&lt;T&gt;</font><span lang="ZH-CN" style="font-family: 宋体;">这个泛型的使用，比如你取</span><font face="Calibri">int</font><span lang="ZH-CN" style="font-family: 宋体;">类型数据的时候，如果你觉得它可能是</span><font face="Calibri">null</font><span lang="ZH-CN" style="font-family: 宋体;">，那你就可以用</span><font face="Calibri">Field&lt;int?&gt;(“Column A”)</font><span lang="ZH-CN" style="font-family: 宋体;">去取，这样就可以避免了</span><font face="Calibri">exception</font><span lang="ZH-CN" style="font-family: 宋体;">的抛出。</span></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font size="3"><font face="Calibri">3 .Field&lt;T&gt;</font><span lang="ZH-CN" style="font-family: 宋体;">和</span><font face="Calibri">SetField&lt;T&gt;</font><span lang="ZH-CN" style="font-family: 宋体;">是使用并不局限在</span><font face="Calibri">LINQ&nbsp;</font><span lang="ZH-CN" style="font-family: 宋体;">的</span><font face="Calibri">query</font><span lang="ZH-CN" style="font-family: 宋体;">当中，在程序的其他地方也能使用，可以用它去替代以前的我们访问</span><font face="Calibri">DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">的方式，例如：</span></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">foreach</span><span class="pun">(</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> r in orderDetails</span><span class="pun">.</span><span class="typ">Rows</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">r</span><span class="pun">.</span><span class="typ">Field</span><span class="str">&lt;decimal&gt;</span><span class="pun">(</span><span class="pln"> </span><span class="str">"UnitPrice"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">){</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r</span><span class="pun">.</span><span class="typ">SetField</span><span class="str">&lt;decimal&gt;</span><span class="pun">(</span><span class="pln"> </span><span class="str">"UnitPrice"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pln">&nbsp;</span></code></li></ol></pre></div><div><br></div></pre><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><strong><span style="font-size: 12pt;"><font face="Calibri">Query Typed DataSet</font></span></strong></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><strong><span style="font-size: 12pt;"><font face="Calibri">&nbsp;</font></span></strong></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font size="3"><span lang="ZH-CN" style="font-family: 宋体;">这就更加简单了。对于定义了类型的</span><font face="Calibri">DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">，我们可以象查询内存中一般的</span><font face="Calibri">object</font><span lang="ZH-CN" style="font-family: 宋体;">那样去查询它。例如：</span></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">var query </span><span class="pun">=</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; from&nbsp;&nbsp;&nbsp; o in ds</span><span class="pun">.</span><span class="typ">Orders</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; </span><span class="kwd">where</span><span class="pln">&nbsp;&nbsp; o</span><span class="pun">.</span><span class="typ">OrderDate</span><span class="pun">.</span><span class="typ">Year</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1998</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; orderby o</span><span class="pun">.</span><span class="typ">OrderDate</span><span class="pln"> descending</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; select&nbsp; </span><span class="kwd">new</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> o</span><span class="pun">.</span><span class="typ">OrderID</span><span class="pun">,</span><span class="pln"> o</span><span class="pun">.</span><span class="typ">OrderDate</span><span class="pun">,</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="typ">Amount</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> o</span><span class="pun">.</span><span class="typ">GetOrder_DetailsRows</span><span class="pun">().</span><span class="typ">Sum</span><span class="pun">(</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; od </span><span class="pun">=&gt;</span><span class="pln"> od</span><span class="pun">.</span><span class="typ">UnitPrice</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> od</span><span class="pun">.</span><span class="typ">Quantity</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">};</span></code></li></ol></pre></div><div><br></div></pre><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px;"><font size="3"><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-family: 宋体;">还有一个与</span><font face="Calibri" style="background-color: rgb(255, 255, 255);">untyped DataSet</font><span lang="ZH-CN" style="font-family: 宋体;"><span style="background-color: rgb(255, 255, 255);">不同的地方是在查询它的时候</span><span style="background-color: rgb(152, 251, 152);">不需要使用</span></span><span style="background-color: rgb(152, 251, 152);"><font face="Calibri">AsEnumerable()&nbsp;</font><span lang="ZH-CN" style="font-family: 宋体;">或者</span><font face="Calibri">AsQueryable()</font></span><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-family: 宋体;">那样的转换方法了。因为所有</span><span style="background-color: rgb(152, 251, 152);"><span lang="ZH-CN" style="font-family: 宋体;">定义好的</span><font face="Calibri">DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">都是继承了</span><font face="Calibri">TypedTableBase&lt;T&gt;</font><span lang="ZH-CN" style="font-family: 宋体;">这个基类</span></span><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-family: 宋体;">，而这个基类已经实现了</span><font face="Calibri" style="background-color: rgb(255, 255, 255);">IEnumerable&lt;T&gt;</font><span lang="ZH-CN" style="background-color: rgb(255, 255, 255); font-family: 宋体;">的</span><font face="Calibri" style="background-color: rgb(255, 255, 255);">interface</font></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><strong><span style="font-size: 12pt;"><font face="Calibri">Query DataSet</font></span></strong><strong><span lang="ZH-CN" style="font-size: 12pt; font-family: 宋体;">中的</span></strong><strong><span style="font-size: 12pt;"><font face="Calibri">relation</font></span></strong></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><strong><span style="font-size: 12pt;"><font face="Calibri">&nbsp;</font></span></strong></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font size="3"><font face="Calibri">DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">当中有时候也是有</span><font face="Calibri">relation</font><span lang="ZH-CN" style="font-family: 宋体;">的，和</span><font face="Calibri">DB</font><span lang="ZH-CN" style="font-family: 宋体;">一样，例如在下面的</span><font face="Calibri">DataSet</font><span lang="ZH-CN" style="font-family: 宋体;">中加入</span><font face="Calibri">relation</font><span lang="ZH-CN" style="font-family: 宋体;">：</span></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="typ">DataTable</span><span class="pln"> orders </span><span class="pun">=</span><span class="pln"> ds</span><span class="pun">.</span><span class="typ">Tables</span><span class="pun">[</span><span class="str">"Orders"</span><span class="pun">];</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="typ">DataTable</span><span class="pln"> orderDetails </span><span class="pun">=</span><span class="pln"> ds</span><span class="pun">.</span><span class="typ">Tables</span><span class="pun">[</span><span class="str">"OrderDetails"</span><span class="pun">];</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">ds</span><span class="pun">.</span><span class="typ">Relations</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="pln"> </span><span class="str">"OrderDetails"</span><span class="pun">,</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orders</span><span class="pun">.</span><span class="typ">Columns</span><span class="pun">[</span><span class="str">"OrderID"</span><span class="pun">],</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; orderDetails</span><span class="pun">.</span><span class="typ">Columns</span><span class="pun">[</span><span class="str">"OrderID"</span><span class="pun">]);</span></code></li></ol></pre></div><div><br></div></pre><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font size="3"><span lang="ZH-CN" style="font-family: 宋体;">如果我们想像在</span><font face="Calibri">LINQ TO SQL</font><span lang="ZH-CN" style="font-family: 宋体;">里面一样通过</span><font face="Calibri">relation</font><span lang="ZH-CN" style="font-family: 宋体;">来访问与其有相关关系的table，可以使用</span><font face="Calibri">GetChildRows</font><span lang="ZH-CN" style="font-family: 宋体;">方法来取得与当前</span><font face="Calibri">table</font><span lang="ZH-CN" style="font-family: 宋体;">相关联的那个</span><font face="Calibri">table</font><span lang="ZH-CN" style="font-family: 宋体;">里面的</span><font face="Calibri">DataRows</font><span lang="ZH-CN" style="font-family: 宋体;">，并将其返回为可以查询的</span><font face="Calibri">IQueryable&lt;T&gt;</font><span lang="ZH-CN" style="font-family: 宋体;">对象。例如：</span></font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">var query </span><span class="pun">=</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; from&nbsp;&nbsp;&nbsp; o in orders</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; </span><span class="kwd">where</span><span class="pln">&nbsp;&nbsp; o</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">&lt;</span><span class="typ">DateTime</span><span class="pun">&gt;(</span><span class="pln"> </span><span class="str">"OrderDate"</span><span class="pln"> </span><span class="pun">).</span><span class="typ">Year</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1998</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; orderby o</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">&lt;</span><span class="typ">DateTime</span><span class="pun">&gt;(</span><span class="pln"> </span><span class="str">"OrderDate"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> descending</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp; select&nbsp; </span><span class="kwd">new</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">OrderID</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> o</span><span class="pun">.</span><span class="typ">Field</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln"> </span><span class="str">"OrderID"</span><span class="pln"> </span><span class="pun">),</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="typ">OrderDate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> o</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">&lt;</span><span class="typ">DateTime</span><span class="pun">&gt;(</span><span class="pln"> </span><span class="str">"OrderDate"</span><span class="pln"> </span><span class="pun">),</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="typ">Amount</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> o</span><span class="pun">.</span><span class="typ">GetChildRows</span><span class="pun">(</span><span class="pln"> </span><span class="str">"OrderDetails"</span><span class="pln"> </span><span class="pun">).</span><span class="typ">Sum</span><span class="pun">(</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="pln"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;od </span><span class="pun">=&gt;</span><span class="pln"> od</span><span class="pun">.</span><span class="typ">Field</span><span class="str">&lt;decimal&gt;</span><span class="pun">(</span><span class="pln"> </span><span class="str">"UnitPrice"</span><span class="pln"> </span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="pun">*</span><span class="pln"> od</span><span class="pun">.</span><span class="typ">Field</span><span class="str">&lt;short&gt;</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Quantity"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">};</span></code></li></ol></pre></div><div><br></div><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font face="Calibri" size="3">&nbsp;</font></p><p style="margin: 0in 0in 0pt; font-family: verdana, sans-serif; font-size: 13px; font-weight: normal; line-height: 19px; background-color: rgb(255, 255, 255);"><font size="3"><span lang="ZH-CN" style="font-family: 宋体;">这样我们就能通过</span><font face="Calibri">relation</font><span lang="ZH-CN" style="font-family: 宋体;">来访问对象</span><font face="Calibri">table</font><span lang="ZH-CN" style="font-family: 宋体;">了。</span></font></p><br><div style="color:gray"><small>来源：&nbsp;&lt;<a href="http://www.cnblogs.com/ruciffa/archive/2008/03/08/1096007.html">http://www.cnblogs.com/ruciffa/archive/2008/03/08/1096007.html</a><small>&gt;</small></small></div><small><small>&nbsp;</small></small></h2><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="border: 1px solid rgb(207, 207, 207); margin: 130px 10px 10px; padding: 10px 10px 20px; font-family: verdana, Arial, Helvetica; font-size: 14px; line-height: 25.200000762939453px;"><div></div></div></div></body></html>