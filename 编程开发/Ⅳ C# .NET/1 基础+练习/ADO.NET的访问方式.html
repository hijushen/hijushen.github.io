<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--defaultCSS-->
<title>ADO.NET的访问方式</title>



<style type="text/css" id="wiz_custom_css">
body
{
    font-family: Microsoft YaHei UI,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>

<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style><link type="text/css" rel="stylesheet" id="wiz_code_highlight_link" href="ADO.NET的访问方式_files/wiz_code_highlight_6.css">
</head>

<body style="" ><h2>ADO.NET的访问方式 connection command sqldataReader (2015/10/5 10:12:35)</h2>1. 数据库连接一般卸载配置文件中：<div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln"> </span><span class="str">&lt;connectionStrings&gt;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">add name</span><span class="pun">=</span><span class="str">"testString"</span><span class="pln"> connectionString</span><span class="pun">=</span><span class="str">"Data Source=.;Initial Catalog=bjhksj;Intefrated Security=True"</span><span class="pun">/&gt;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">  </span><span class="pun">&lt;/</span><span class="pln">connectionStrings</span><span class="pun">&gt;</span></code></li></ol></pre></div><div>&nbsp; &nbsp;也已使用SqlConnectionStringBuilder connStr = new SqlConnectionStringBuilder(); connStr.DataSource = @".";connStr.InteratedSecuritu= true;connStr.InitialCatalog = "db_myDemo"方式等.</div></div><div><img src="ADO.NET的访问方式_files/b2e736e2-2f23-4a80-9ab2-d69fbca9982e.jpg" border="0" alt="" name="" width="390" height="271"><br></div><div>2. 通过 command 的方式：</div><div>三种command方式及返回值处理方式：</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">            </span><span class="lit">1.</span><span class="pun">执行增删的方法，返回受影响的行数。</span><span class="pln">            </span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">            using </span><span class="pun">(</span><span class="typ">SqlConnection</span><span class="pln"> conn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlConnection</span><span class="pun">(</span><span class="pln">connStr</span><span class="pun">))</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">            </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">                conn</span><span class="pun">.</span><span class="typ">Open</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">                </span><span class="typ">SqlCommand</span><span class="pln"> command </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlCommand</span><span class="pun">(</span><span class="pln">sql</span><span class="pun">,</span><span class="pln"> conn</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">                command</span><span class="pun">.</span><span class="typ">Parameters</span><span class="pun">.</span><span class="typ">AddRange</span><span class="pun">(</span><span class="pln">ps</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">                </span><span class="kwd">return</span><span class="pln"> command</span><span class="pun">.</span><span class="typ">ExecuteNonQuery</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">            </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">            </span><span class="lit">2.</span><span class="pun">执行聚合函数，返回首行首列的值。</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">            using</span><span class="pun">(</span><span class="typ">SqlConnection</span><span class="pln"> conn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlConnection</span><span class="pun">(</span><span class="pln">connStr</span><span class="pun">))</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">            </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">                conn</span><span class="pun">.</span><span class="typ">Open</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">                </span><span class="typ">SqlCommand</span><span class="pln"> command </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlCommand</span><span class="pun">(</span><span class="pln">sql</span><span class="pun">,</span><span class="pln"> conn</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">                command</span><span class="pun">.</span><span class="typ">Parameters</span><span class="pun">.</span><span class="typ">AddRange</span><span class="pun">(</span><span class="pln">ps</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">                </span><span class="kwd">return</span><span class="pln"> command</span><span class="pun">.</span><span class="typ">ExecuteScalar</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">            </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">            </span><span class="lit">3.</span><span class="pun">返回</span><span class="pln">dataReader</span><span class="pun">对象</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">            using </span><span class="pun">(</span><span class="typ">SqlConnection</span><span class="pln"> conn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlConnection</span><span class="pun">(</span><span class="pln">connStr</span><span class="pun">))</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">            </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">                </span><span class="typ">SqlCommand</span><span class="pln"> command </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlCommand</span><span class="pun">(</span><span class="pln">sql</span><span class="pun">,</span><span class="pln"> conn</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">                conn</span><span class="pun">.</span><span class="typ">Open</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">                </span><span class="typ">SqlDataReader</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> command</span><span class="pun">.</span><span class="typ">ExecuteReader</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">                </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reader</span><span class="pun">.</span><span class="typ">Read</span><span class="pun">())</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">                </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">                    </span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">                        </span><span class="com">//每行读取的值</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">                </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">                reader</span><span class="pun">.</span><span class="typ">Close</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">            </span><span class="pun">}</span></code></li></ol></pre></div><div>&nbsp; &nbsp;另外如果执行存储过程，设定相应的commandType为存储过程即可.：</div></div><div>&nbsp;&nbsp;</div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">            using</span><span class="pun">(</span><span class="typ">SqlConnection</span><span class="pln"> conn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlConnection</span><span class="pun">(</span><span class="pln">connStr</span><span class="pun">))</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">            </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">                conn</span><span class="pun">.</span><span class="typ">Open</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">                </span><span class="typ">SqlCommand</span><span class="pln"> command </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlCommand</span><span class="pun">(</span><span class="pln">procName</span><span class="pun">,</span><span class="pln"> conn</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">                command</span><span class="pun">.</span><span class="typ">CommandType</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CommandType</span><span class="pun">.</span><span class="typ">StoredProcedure</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">                command</span><span class="pun">.</span><span class="typ">Parameters</span><span class="pun">.</span><span class="typ">AddRange</span><span class="pun">(</span><span class="pln">ps</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">                </span><span class="kwd">return</span><span class="pln"> command</span><span class="pun">.</span><span class="typ">ExecuteNonQuery</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">            </span><span class="pun">}</span></code></li></ol></pre></div><div>3. 两种增加参数的方式：</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">                </span><span class="typ">SqlParameter</span><span class="pln"> sp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlParameter</span><span class="pun">(</span><span class="str">"@name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Pudding"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">                command</span><span class="pun">.</span><span class="typ">Parameters</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="pln">sp</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">                sp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlParameter</span><span class="pun">(</span><span class="str">"@ID"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"1"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">                command</span><span class="pun">.</span><span class="typ">Parameters</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="pln">sp</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">                </span><span class="com">//第二种</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">                </span><span class="typ">SqlParameter</span><span class="pun">[]</span><span class="pln"> paras </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlParameter</span><span class="pun">[]{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">                    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlParameter</span><span class="pun">(</span><span class="str">"@name"</span><span class="pun">,</span><span class="str">"pudding"</span><span class="pun">),</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlParameter</span><span class="pun">(</span><span class="str">"@ID"</span><span class="pun">,</span><span class="str">"1"</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">                </span><span class="pun">};</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><span style="font-size: 13px; background-color: white; color: black; line-height: 18px;">                command.Parameters.AddRange(paras);</span></li></ol></pre></div><div>4.&nbsp;</div></div><hr /><h2>ADO.NET的访问方式（二） DataAdapter DataSet SqlCommandBuilder (2015/10/5 23:51:28)</h2><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">            </span><span class="typ">SqlConnection</span><span class="pln"> conn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlConnection</span><span class="pun">(</span><span class="pln">connStr</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">            </span><span class="typ">SqlDataAdapter</span><span class="pln"> da </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlDataAdapter</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">            </span><span class="kwd">string</span><span class="pln"> </span><span class="typ">SelectSql</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"select * from StudentInfo"</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">            da</span><span class="pun">.</span><span class="typ">SelectCommand</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlCommand</span><span class="pun">(</span><span class="typ">SelectSql</span><span class="pun">,</span><span class="pln"> conn</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">            </span><span class="typ">DataSet</span><span class="pln"> ds </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DataSet</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">            da</span><span class="pun">.</span><span class="typ">Fill</span><span class="pun">(</span><span class="pln">ds</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">            </span><span class="typ">GridView</span><span class="pln"> </span><span class="typ">GridView1</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GridView</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">            </span><span class="typ">GridView1</span><span class="pun">.</span><span class="typ">DataSource</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> ds</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">            </span><span class="typ">GridView1</span><span class="pun">.</span><span class="typ">DataBind</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">            </span><span class="com">//增加记录</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">            </span><span class="com">//自动生成表单，用于将DataSet所做的更改与关联的SQL Server数据更改想协调</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">            </span><span class="com">//自动生成删除，插入，更新命令。 只能映射到单表中或从单个数据表生成。 数据库中且必须需要逐渐。 “单表”命令</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">            </span><span class="typ">SqlCommandBuilder</span><span class="pln"> scb </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SqlCommandBuilder</span><span class="pun">(</span><span class="pln">da</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">            da</span><span class="pun">.</span><span class="typ">Update</span><span class="pun">(</span><span class="pln">ds</span><span class="pun">);</span></code></li></ol></pre></div><div><br></div></body></html>