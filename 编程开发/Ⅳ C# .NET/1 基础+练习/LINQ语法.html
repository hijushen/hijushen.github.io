
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><style type="text/css" id="wiz_custom_css">
body
{
    font-family: "Microsoft YaHei UI","Microsoft YaHei",SimSun,"Segoe UI",Tahoma,Helvetica,Sans-Serif,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>
<title>LINQ语法</title><!--?xml version="1.0" encoding="UTF-8"?-->


<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.08">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 8px; padding-bottom: 8px; line-height: 1;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style><link type="text/css" rel="stylesheet" id="wiz_code_highlight_link" href="LINQ语法_files/wiz_code_highlight_13.css"></head><body style="" ><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="text-align: left;"><font color="#0000FF" size="1" face="Yu Mincho Demibold"><span style="font-size: 9pt;">LINQ实现</span></font></div><div style="text-align: left;"><font color="#0000FF" size="1" face="Yu Mincho Demibold"><span style="font-size: 9pt;"><br></span></font></div><div style="text-align: left;"><font color="#0000ff" face="Yu Mincho Demibold"><span style="font-size: 12px; line-height: 18px;">自己实现的功能:</span></font></div><div style="text-align: left;"><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">var query1 </span><span class="pun">=</span><span class="pln"> from e2 in dtT</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; select e2</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">&lt;</span><span class="pln">string </span><span class="pun">&gt;(</span><span class="str">"RAW_PN"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; var query </span><span class="pun">=</span><span class="pln"> from e1 in dtF</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="kwd">where</span><span class="pln"> </span><span class="pun">!(</span><span class="pln">query1</span><span class="pun">).</span><span class="typ">Contains</span><span class="pun">(</span><span class="pln">e1</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">&lt;</span><span class="pln">string </span><span class="pun">&gt;(</span><span class="str">"RAW_PN"</span><span class="pun">))</span></code></li></ol></pre></div><div><br></div></div><div align="left" style="text-align: left;"><font color="#282828" size="1" face="Yu Mincho Demibold"><span style="font-size: 9pt;"><br></span></font></div><div align="left" style="text-align: left;"><p style="margin: 0px; padding: 0px 0px 10px; font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold"><font color="#333333">LINQ to DataSet主要是提供对离线数据的支持，只有在填充DataSet之后， 我们才能使用LINQ to DataSet来查询数据。其功能主要是通过 System.Data.DataRowExtions和System.Data.DataTableExtensions两个静态类 中的扩展方法来公开的。LINQ to DataSet是LINQ to ADO.Net中的一部分，但这 部分所占比重非常小，内容也比较少。下面就让我们首先来看看</font><font color="#000080"> DataTableExtensions中的扩展方法</font><font color="#333333">：</font></font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"></p><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">EnumerableRowCollection</span><span class="pln">&nbsp;</span><span class="typ">AsEnumerable</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> source</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pun">------------------------------------------------------------</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">DataView</span><span class="pln"> </span><span class="typ">AsDataView</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> table</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">DataView</span><span class="pln"> </span><span class="typ">AsDataView</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">EnumerableRowCollection</span><span class="pln">&nbsp;source</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">where</span><span class="pln"> T </span><span class="pun">:</span><span class="pln"> </span><span class="typ">DataRow</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pun">-------------------------------------------------------------</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> </span><span class="typ">CopyToDataTable</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">IEnumerable</span><span class="pln">&nbsp;source</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">where</span><span class="pln"> T </span><span class="pun">:</span><span class="pln"> </span><span class="typ">DataRow</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">CopyToDataTable</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">IEnumerable</span><span class="pln">&nbsp;source</span><span class="pun">,</span><span class="typ">DataTable</span><span class="pln"> table</span><span class="pun">,</span><span class="typ">LoadOption</span><span class="pln"> options</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">where</span><span class="pln"> T </span><span class="pun">:</span><span class="pln"> </span><span class="typ">DataRow</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">CopyToDataTable</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">IEnumerable</span><span class="pln">&nbsp;source</span><span class="pun">,</span><span class="typ">DataTable</span><span class="pln"> table</span><span class="pun">,</span><span class="typ">LoadOption</span><span class="pln"> options</span><span class="pun">,</span><span class="typ">FillErrorEventHandler</span><span class="pln"> errorHandler</span><span class="pun">)</span></code></li></ol></pre></div><div><br></div><p></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px;"><font face="Yu Mincho Demibold"><span style="background-color: rgb(255, 255, 255);">从定义中就可 以看出这</span><span style="background-color: rgb(152, 251, 152);">三类主要是提供DataTable、DataView和IEnumerable三者之间的转换</span><span style="background-color: rgb(255, 255, 255);">。 大家都知道LINQ to Object查询主要是对IEnumerable序列进行的操作，这样就 使得DataTable、DataView和LINQ之间建立了一个转换桥梁。</span></font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px;"><font face="Yu Mincho Demibold"><span style="background-color: rgb(255, 255, 255);">因此，在我 们需要将</span><span style="background-color: rgb(152, 251, 152);">DataTable应用于LINQ to DataSet查询是要先调用AsEnumerable完成 DataTable到LINQ的转换。如果我们需要将LINQ to DataSet的查询的结果进行数 据绑定时我们需要调用AsDataView的泛型版来完成LINQ到DataView的转换。当然 我们也可以使用CopyToDataTable来进行LINQ到DataTable的转换</span><span style="background-color: rgb(255, 255, 255);">。</span></font></p><p style="margin: 0px; padding: 0px 0px 10px; font-size: 15px; line-height: 25px;"><font face="Yu Mincho Demibold"><span style="color: rgb(51, 51, 51); background-color: rgb(255, 255, 255);">注意 ：如果在我们完成了DataTable到LINQ(IEnumerable)的转换之后（也就是调用 AsEnumerable扩展方法），需要进行两个DataRow序列的集合操作如 Distinct,Union,Except,Intersect,SequenceEqual,这些操作都</span><span style="color: rgb(51, 51, 51); background-color: rgb(152, 251, 152);">需要对数据源中 的元素进行相等比较，由于缺省情况下都是调用数据源中的元素的GetHashCode 和Equals操作来判断的，对于DataRow而言就是判断对象的引用是否相等</span><span style="color: rgb(51, 51, 51); background-color: rgb(255, 255, 255);">，这样 可能会导致我们不期望的结果（DataRow里面的数据内容是相同的，但不是同一 个对象），所以我们</span><span style="background-color: rgb(152, 251, 152);"><font color="#333333">要使用Distinct,Union,Except,Intersect,SequenceEqual 带</font><font color="#000080">IEqualityComparer</font><font color="#333333">的重载版本</font></span><span style="color: rgb(51, 51, 51); background-color: rgb(255, 255, 255);">,</span><span style="color: rgb(51, 51, 51); background-color: rgb(152, 251, 152);">使用System.Data.DataRowComparer.Default 作为参数</span><span style="color: rgb(51, 51, 51); background-color: rgb(255, 255, 255);">。这个比较器类是.Net3.5专门为LINQ to DataSet新增加的，用于比较 </span><span style="color: rgb(51, 51, 51); background-color: rgb(152, 251, 152);">DataRow的值</span><span style="color: rgb(51, 51, 51); background-color: rgb(255, 255, 255);">的，它是通过先比较DataColumn的数量，然后使用该列中类型的 Equals方法进行比较。</span></font></p><p style="margin: 0px; padding: 0px 0px 10px; font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold" color="#000080">不带LoadOptions参数的CopyToDataTable方法将 自动为每一行的每一个字段创建（更新）原始版本和当前版本，带有 LoadOptions参数的CopyToDataTable重载版本可以让你指定是创建（更新）原始 版本或是当前版本，或者两者都填充。LoadOptions选项有下面三个选项值可以 选择：</font></p><p style="margin: 0px; padding: 0px 0px 10px; font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold" color="#000080">OverwriteChanges: 创建（更新）每一列的当前值和原始值</font></p><p style="margin: 0px; padding: 0px 0px 10px; font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold" color="#000080">PreserveChanges: 创建（更新）每一列的原始值</font></p><p style="margin: 0px; padding: 0px 0px 10px; font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold" color="#000080">Upset: 创建（ 更新）每一列的当前值</font></p><p style="margin: 0px; padding: 0px 0px 10px; font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold"><font color="#333333">接下来，让我们来</font><font color="#000080">看看DataRowExtensions中的扩 展方法</font><font color="#333333">。在这个DataRowExtensions中的扩展方法主要是从数据行中获得字段的 值（泛型的Field方法）和设置数据行中字段的值（泛型的SetField方法）。</font></font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> T </span><span class="typ">Field</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> row</span><span class="pun">,</span><span class="typ">DataColumn</span><span class="pln"> column</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> T </span><span class="typ">Field</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> row</span><span class="pun">,</span><span class="typ">int</span><span class="pln"> columnIndex</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> T </span><span class="typ">Field</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> row</span><span class="pun">,</span><span class="pln">string columnName</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> T </span><span class="typ">Field</span><span class="pln">&nbsp;</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> row</span><span class="pun">,</span><span class="typ">DataColumn</span><span class="pln"> column</span><span class="pun">,</span><span class="typ">DataRowVersion</span><span class="pln"> version</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> T </span><span class="typ">Field</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> row</span><span class="pun">,</span><span class="typ">int</span><span class="pln"> columnIndex</span><span class="pun">,</span><span class="typ">DataRowVersion</span><span class="pln"> version</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> T </span><span class="typ">Field</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> row</span><span class="pun">,</span><span class="pln">string columnName</span><span class="pun">,</span><span class="typ">DataRowVersion</span><span class="pln"> version</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">SetField</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> row</span><span class="pun">,</span><span class="typ">DataColumn</span><span class="pln"> column</span><span class="pun">,</span><span class="pln">T value</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">SetField</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> row</span><span class="pun">,</span><span class="typ">int</span><span class="pln"> columnIndex</span><span class="pun">,</span><span class="pln"> T value</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">SetField</span><span class="pun">(</span><span class="kwd">this</span><span class="pln"> </span><span class="typ">DataRow</span><span class="pln"> row</span><span class="pun">,</span><span class="pln">string columnName</span><span class="pun">,</span><span class="pln">T value</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="pun">其中，</span><span class="pln">row</span><span class="pun">:</span><span class="pln"> </span><span class="pun">是我们要使用的数据行对象实例</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">column</span><span class="pun">:</span><span class="pln"> </span><span class="pun">指定要返回(设</span><span class="pln"> </span><span class="pun">置)其值的列</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">columnIndex</span><span class="pun">:</span><span class="pln"> </span><span class="pun">指定要返回(设置)其值的列的索引</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">columnName</span><span class="pun">:</span><span class="pln"> </span><span class="pun">指定要返回(设置)其值的列名</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">value</span><span class="pun">:</span><span class="pln"> </span><span class="pun">要设置的新</span><span class="pln"> </span><span class="pun">值，如果是</span><span class="pln">null</span><span class="pun">,将自动转换为</span><span class="typ">DBNull</span><span class="pun">.</span><span class="typ">Value</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">version</span><span class="pun">:</span><span class="pln"> </span><span class="pun">要获取的数据行</span><span class="pln"> </span><span class="pun">的版本</span></code></li></ol></pre></div><div><br></div></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold">下面，我们就来看看一个使用LINQ to DataSet的实例，这个例子 主要描述了一下上面扩展方法的用法，同时给出了部分注意的事项：</font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><code></code></p><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">LINQToDataSet</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code><code class="language-c"><span class="pun">{</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code><code class="language-c"><span class="pln">　　</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Student</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code><code class="language-c"><span class="pln">　　</span><span class="pun">{</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code><code class="language-c"><span class="pln">　　　　</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> </span><span class="typ">Id</span><span class="pun">;</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code><code class="language-c"><span class="pln">　　　　 </span><span class="kwd">public</span><span class="pln"> string </span><span class="typ">Name</span><span class="pun">;</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code><code class="language-c"><span class="pln">　　</span><span class="pun">}</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code><code class="language-c"><span class="pln">　　</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pln"> </span><span class="typ">GetDataTable</span><span class="pun">(</span><span class="typ">Student</span><span class="pun">[]</span><span class="pln"> students</span><span class="pun">)</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code><code class="language-c"><span class="pln">　　</span><span class="pun">{</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code><code class="language-c"><span class="pln">　　　　</span><span class="typ">DataTable</span><span class="pln"> table </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DataTable</span><span class="pun">();</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code><code class="language-c"><span class="pln">　　　　table</span><span class="pun">.</span><span class="typ">Columns</span><span class="pun">.</span><span class="typ">Add</span><span class="pln"> </span><span class="pun">(</span><span class="str">"Id"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">typeof</span><span class="pun">(</span><span class="typ">Int32</span><span class="pun">));</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code><code class="language-c"><span class="pln">　　　　table</span><span class="pun">.</span><span class="typ">Columns</span><span class="pun">.</span><span class="typ">Add</span><span class="pln"> </span><span class="pun">(</span><span class="str">"Name"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">typeof</span><span class="pun">(</span><span class="pln">string</span><span class="pun">));</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code><code class="language-c"><span class="pln">　　　　foreach </span><span class="pun">(</span><span class="typ">Student</span><span class="pln"> student in students</span><span class="pun">)</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code><code class="language-c"><span class="pln">　　　　</span><span class="pun">{</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code><code class="language-c"><span class="pln">　　　　　　table</span><span class="pun">.</span><span class="typ">Rows</span><span class="pun">.</span><span class="typ">Add</span><span class="pln"> </span><span class="pun">(</span><span class="pln">student</span><span class="pun">.</span><span class="typ">Id</span><span class="pun">,</span><span class="pln"> student</span><span class="pun">.</span><span class="typ">Name</span><span class="pun">);</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code><code class="language-c"><span class="pln">　　　　</span><span class="pun">}</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code><code class="language-c"><span class="pln">　　　　</span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">table</span><span class="pun">);</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code><code class="language-c"><span class="pln">　　</span><span class="pun">}</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code><code class="language-c"><span class="pln">　　</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">PrintStudentTable</span><span class="pln"> </span><span class="pun">(</span><span class="typ">DataTable</span><span class="pln"> dt</span><span class="pun">)</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code><code class="language-c"><span class="pln">　　</span><span class="pun">{</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code><code class="language-c"><span class="pln">　　　　</span><span class="typ">PrintStudentTable</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dt</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">());</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code><code class="language-c"><span class="pln">　　</span><span class="pun">}</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code><code class="language-c"><span class="pln">　　</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">PrintStudentTable</span><span class="pun">(</span><span class="typ">IEnumerable</span><span class="pln">&nbsp;dt</span><span class="pun">)</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code><code class="language-c"><span class="pln">　　</span><span class="pun">{</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code><code class="language-c"><span class="pln">　　 　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pln"> </span><span class="pun">(</span><span class="str">"=============================================================== ="</span><span class="pun">);</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code><code class="language-c"><span class="pln">　　　　</span><span class="kwd">try</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code><code class="language-c"><span class="pln">　　　　</span><span class="pun">{</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code><code class="language-c"><span class="pln">　　　　　　foreach </span><span class="pun">(</span><span class="typ">DataRow</span><span class="pln"> dataRow in dt</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">())</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code><code class="language-c"><span class="pln">　　　　　　</span><span class="pun">{</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code><code class="language-c"><span class="pln">　　　 　　　　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"Student Id = {0} :original {1}:current {2}"</span><span class="pun">,</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code><code class="language-c"><span class="pln">dataRow</span><span class="pun">.</span><span class="typ">Field</span><span class="pln">&nbsp;</span><span class="pun">(</span><span class="str">"Id"</span><span class="pun">),</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code><code class="language-c"><span class="pln">dataRow</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">(</span><span class="str">"Name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DataRowVersion</span><span class="pun">.</span><span class="typ">Original</span><span class="pun">),</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code><code class="language-c"><span class="pln">dataRow</span><span class="pun">.</span><span class="typ">Field</span><span class="pln">&nbsp;</span><span class="pun">(</span><span class="str">"Name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DataRowVersion</span><span class="pun">.</span><span class="typ">Current</span><span class="pun">));</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code><code class="language-c"><span class="pln">　　　　　　</span><span class="pun">}</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code><code class="language-c"><span class="pln">　　　　</span><span class="pun">}</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code><code class="language-c"><span class="pln">　　　　</span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Exception</span><span class="pln"> e</span><span class="pun">)</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code><code class="language-c"><span class="pln">　　　　</span><span class="pun">{</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code><code class="language-c"><span class="pln">　　　 　　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"Exception:"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="typ">Message</span><span class="pun">);</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code><code class="language-c"><span class="pln">　　 　　</span><span class="pun">}</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code><code class="language-c"><span class="pln">　　　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pln"> </span><span class="pun">(</span><span class="str">"=============================================================== ="</span><span class="pun">);</span></code></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code><code class="language-c"><span class="pln">　　</span><span class="pun">}</span></code></code></li></ol></pre></div><div><code><br></code></div><code><font face="Yu Mincho Demibold"><datarow><int><string><string>　　这个例子的步骤:</string></string></int></datarow></font></code></div><div align="left" style="text-align: left;"><font face="Yu Mincho Demibold">&nbsp; &nbsp;&nbsp;</font><font face="Yu Mincho Demibold">&nbsp; &nbsp; 1, 建立一个originalTable,直接输出,因为没有</font><span class="typ" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">DataRowVersion</span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">.</span><span class="typ" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">Original <font color="#000000">等值,所以抛出异常,导致.</font></span></div><div align="left" style="text-align: left;"><font face="Consolas">&nbsp; &nbsp;&nbsp;</font><font face="Consolas">&nbsp;2,通过newTable = orginalTable.AsEnumrable().CopyToDataTable 生成一个新DataTable.然后显示.这样,newTable再调用</font><span class="typ" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">DataRowVersion</span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">.</span><span class="typ" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">Original </span><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp;方法时没有问题.</span></div><div align="left" style="text-align: left;"><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; &nbsp;3,通过setField方法更新值,可以明显看到 Original 和Current值已经发生变化.说明DataTable会纪录变更发生过程.</span></div><div align="left" style="text-align: left;"><font face="Consolas">&nbsp; &nbsp;&nbsp;</font><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp;4,通过setField设置为null都可以,再通过Field显示为空,而不会造成异常.Field 泛型的好处!</span></div><div align="left" style="text-align: left;"><font face="Consolas">&nbsp; &nbsp;&nbsp;</font><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp;5,调用originalTable.AcceptChanges()完成表格可变更,否则异常.,然后newTable.copyToDataTable(Original,LoadOptions.OverwriteChanges)只会简单添加到后面.</span></div><div align="left" style="text-align: left;"><font face="Consolas">&nbsp; &nbsp;&nbsp;</font><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;6,通过original.AsEnumable().Distinct()方法,因为不带比较器参数,会得不到想要的结果.</span></div><div align="left" style="text-align: left;"><font face="Consolas">&nbsp; &nbsp;&nbsp;</font><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;7,增加比较器</span><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">original.AsEnumable().Distinct(DataRowComparer.Defalut) 去掉两列值都不同的情况. 因为此时时<span style="background-color: rgb(152, 251, 152);">值比较</span>.</span></div><div align="left" style="text-align: left;"><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; &nbsp;8,回到copy的主题,如果copy之前设置originalTable的主键. 那么我们将得到完全不重复的值. 如上,copy时不同值会保留.有逐渐就不会.</span></div><div align="left" style="text-align: left;"><font face="Consolas">&nbsp; &nbsp;&nbsp;</font><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp; 注意.originalTable之前已经设置AcceptChanges. 所以之后我们只需要o</span><span class="pln" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">riginalTable</span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">.</span><span class="typ" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">PrimaryKey</span><span class="pln" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);"> </span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">=</span><span class="pln" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);"> </span><span class="kwd" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">new</span><span class="pln" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);"> </span><span class="typ" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">DataColumn</span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">[]</span><span class="pln" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);"> </span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">{</span><span class="pln" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);"> originalTable</span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">.</span><span class="typ" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">Columns</span><span class="pln" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);"> </span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">[</span><span class="str" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">"Id"</span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">]</span><span class="pln" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);"> </span><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);">};</span></div><div align="left" style="text-align: left;"><span class="pun" style="font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; line-height: 18px; white-space: pre; background-color: rgb(247, 247, 249);"><font face="Consolas">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><span style="font-family: Consolas; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; 之后,newTable.asEnumable().copyToTable(originalTable,LoadOptions.OverwriteChanges) 就可以完成保留唯一键记录的信息</span></div><div align="left" style="text-align: left;"><p></p><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Test</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">　　</span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">　　　　</span><span class="typ">Student</span><span class="pun">[]</span><span class="pln"> students </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Student</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Lazy Bee"</span><span class="pln"> </span><span class="pun">},</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">　　　　　　　　　　　　　　　 </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Student</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Flying Wind"</span><span class="pln"> </span><span class="pun">},</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">　　　　　　 　　　　　　　　　 </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Student</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PiPi Zhu"</span><span class="pln"> </span><span class="pun">},</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pln">　　　　　　　　　　　　　　　 </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Student</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Chong Chong"</span><span class="pln"> </span><span class="pun">}};</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pln">　　　　</span><span class="typ">DataTable</span><span class="pln"> originalTable </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GetDataTable</span><span class="pun">(</span><span class="pln">students</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="pln">　　　　</span><span class="com">//我们试图访问DataTable中数据行的 Orginal版本，由于此时还没有建立原始版本，</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="pln">　　　　</span><span class="com">//所以将导致异常</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="pln">　　　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"We try to get access to original version, so we will get the exception.:"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">　　　　 </span><span class="typ">PrintStudentTable</span><span class="pun">(</span><span class="pln">originalTable</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">　　　　</span><span class="com">//我们使用 CopyToDataTable来建立DataTable中数据行的Orginal版本</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">　　　　 </span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"We will use CopyToDataTable to build original version."</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">　　　　</span><span class="typ">DataTable</span><span class="pln"> newTable </span><span class="pun">=</span><span class="pln"> originalTable</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">().</span><span class="typ">CopyToDataTable</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">　　　　 </span><span class="typ">PrintStudentTable</span><span class="pun">(</span><span class="pln">newTable</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pln">　　　　</span><span class="com">//使用SetField来更新---www.bianceng.cn</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pln">　 　　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"After call SetField to change name."</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="pln">　　　　</span><span class="pun">(</span><span class="pln">from s in newTable</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="pln">　 　　　 </span><span class="kwd">where</span><span class="pln"> s</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">(</span><span class="str">"Name"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"PiPi Zhu"</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="pln">　　　　 select s</span><span class="pun">).</span><span class="typ">Single</span><span class="pun">().</span><span class="typ">SetField</span><span class="pln"> </span><span class="pun">(</span><span class="str">"Name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"George Oscar Bluth"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">　　　　 </span><span class="typ">PrintStudentTable</span><span class="pun">(</span><span class="pln">newTable</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">　　　　</span><span class="com">//使用SetField来设置null</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">　　　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"After call SetField to change name to null."</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">　　　　</span><span class="pun">(</span><span class="pln">from s in newTable</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">　　　　 </span><span class="kwd">where</span><span class="pln"> s</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">(</span><span class="str">"Id"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">13</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pln">　　　　 select s</span><span class="pun">).</span><span class="typ">Single</span><span class="pun">().</span><span class="typ">SetField</span><span class="pln">&nbsp;</span><span class="pun">(</span><span class="str">"Name"</span><span class="pun">,</span><span class="pln"> null</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pln">　　　　</span><span class="typ">PrintStudentTable</span><span class="pun">(</span><span class="pln">newTable</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="pln">　　　　</span><span class="com">//使用CopyToDataTable来合并，由于我们没有指定表的主键，</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="pln">　　　　</span><span class="com">//所以只会简单的追加在目标数据表的最后</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="pln">　　　　 </span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"After call CopyToDataTable.We will not get our expected result because we have not set primary key."</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">　　 　　</span><span class="com">//首先，我们调用AcceptChanges来建立Original版本，否则，避免显示时 抛出异常</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">　　　　originalTable</span><span class="pun">.</span><span class="typ">AcceptChanges</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">　　　 newTable</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">().</span><span class="typ">CopyToDataTable</span><span class="pun">(</span><span class="pln">originalTable</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LoadOption</span><span class="pun">.</span><span class="typ">OverwriteChanges</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">　　　　</span><span class="typ">PrintStudentTable</span><span class="pln"> </span><span class="pun">(</span><span class="pln">originalTable</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">　　　　</span><span class="com">//我们使用Distinct来去掉刚才重复的记录， 由于此时我们没有使用DatarowComparer.Default</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pln">　　　　</span><span class="com">//所以我们将 得不到我们想要的结果</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pln">　　　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"After call Distinct.We will not get our expected result because we have not used DatarowComparer.Default comparer."</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="pln">　　　　 </span><span class="typ">IEnumerable</span><span class="pln">&nbsp;distinctTable</span><span class="pun">=</span><span class="pln">originalTable</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pln"> </span><span class="pun">().</span><span class="typ">Distinct</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="pln">　　　　</span><span class="typ">PrintStudentTable</span><span class="pun">(</span><span class="pln">distinctTable</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="pln">　 　　　</span><span class="com">//我们使用Distinct来去掉刚才重复的记录，使用 DatarowComparer.Default比较器</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">　　　　</span><span class="com">//所以我们将得到我们想要的 结果</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pln">　　　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"After call Distinct.this is what we want."</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pln">　　　 distinctTable</span><span class="pun">=</span><span class="pln">originalTable</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pun">().</span><span class="typ">Distinct</span><span class="pln"> </span><span class="pun">(</span><span class="typ">DataRowComparer</span><span class="pun">.</span><span class="typ">Default</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pln">　　　　</span><span class="typ">PrintStudentTable</span><span class="pln"> </span><span class="pun">(</span><span class="pln">distinctTable</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pln">　　　　</span><span class="com">//我们先设置主键，然后再使用 CopyToDataTable来合并</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pln">　　　　</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"After call CopyToDataTable.this is what we want."</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pln">　　　　 originalTable </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GetDataTable</span><span class="pun">(</span><span class="pln">students</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="pln">　　　　 originalTable</span><span class="pun">.</span><span class="typ">PrimaryKey</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DataColumn</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> originalTable</span><span class="pun">.</span><span class="typ">Columns</span><span class="pln"> </span><span class="pun">[</span><span class="str">"Id"</span><span class="pun">]</span><span class="pln"> </span><span class="pun">};</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="pln">　　　　newTable</span><span class="pun">.</span><span class="typ">AsEnumerable</span><span class="pln"> </span><span class="pun">().</span><span class="typ">CopyToDataTable</span><span class="pun">(</span><span class="pln">originalTable</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LoadOption</span><span class="pun">.</span><span class="typ">OverwriteChanges</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="pln">　　　　</span><span class="typ">PrintStudentTable</span><span class="pun">(</span><span class="pln">originalTable</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pln">　　</span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pun">}</span></code></li></ol></pre></div><div><br></div><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold">例子中有比较详尽的注释，相信大家看应该没有什么问题。</font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold">这个例子 的输出结果为：</font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"></p><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="typ">We</span><span class="pln"> </span><span class="kwd">try</span><span class="pln"> to get access to original version</span><span class="pun">,</span><span class="pln"> so we will get the exception</span><span class="pun">.:</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="typ">Exception</span><span class="pun">:</span><span class="typ">There</span><span class="pln"> is no </span><span class="typ">Original</span><span class="pln"> data to access</span><span class="pun">.</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="typ">We</span><span class="pln"> will use </span><span class="typ">CopyToDataTable</span><span class="pln"> to build original version</span><span class="pun">.</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span><span class="pun">:</span><span class="pln">current </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="typ">After</span><span class="pln"> call </span><span class="typ">SetField</span><span class="pln"> to change name</span><span class="pun">.</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span><span class="pun">:</span><span class="pln">current </span><span class="typ">George</span><span class="pln"> </span><span class="typ">Oscar</span><span class="pln"> </span><span class="typ">Bluth</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="typ">After</span><span class="pln"> call </span><span class="typ">SetField</span><span class="pln"> to change name to null</span><span class="pun">.</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span><span class="pun">:</span><span class="pln">current</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="typ">After</span><span class="pln"> call </span><span class="typ">CopyToDataTable</span><span class="pun">.</span><span class="typ">We</span><span class="pln"> will not get our expected result because we have not </span><span class="typ">set</span><span class="pln"> primary key</span><span class="pun">.</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span><span class="pun">:</span><span class="pln">current </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="pun">:</span><span class="pln">current</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="typ">After</span><span class="pln"> call </span><span class="typ">Distinct</span><span class="pun">.</span><span class="typ">We</span><span class="pln"> will not get our expected result because we have not used </span><span class="typ">DatarowComparer</span><span class="pun">.</span><span class="typ">Default</span><span class="pln"> comparer</span><span class="pun">.</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span><span class="pun">:</span><span class="pln">current </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="pun">:</span><span class="pln">current</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="typ">After</span><span class="pln"> call </span><span class="typ">Distinct</span><span class="pun">.</span><span class="kwd">this</span><span class="pln"> is what we want</span><span class="pun">.</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span><span class="pun">:</span><span class="pln">current </span><span class="typ">PiPi</span><span class="pln"> </span><span class="typ">Zhu</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="pun">:</span><span class="pln">current</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-c"><span class="typ">After</span><span class="pln"> call </span><span class="typ">CopyToDataTable</span><span class="pun">.</span><span class="kwd">this</span><span class="pln"> is what we want</span><span class="pun">.</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-c"><span class="pun">================================================================</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Lazy</span><span class="pln"> </span><span class="typ">Bee</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Flying</span><span class="pln"> </span><span class="typ">Wind</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">13</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="pun">:</span><span class="pln">current</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-c"><span class="typ">Student</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">72</span><span class="pln"> </span><span class="pun">:</span><span class="pln">original </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span><span class="pun">:</span><span class="pln">current </span><span class="typ">Chong</span><span class="pln"> </span><span class="typ">Chong</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-c"><span class="pun">================================================================</span></code></li></ol></pre></div><div><br></div><p></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold">总结，在使用LINQ to DataSet的时候需要注意以下几个方面：</font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold">1、在对IEnumeralbe进行数据行的集合操作如Distinct, Except, Union, Intersect, SequenceEqual时，需要使用 System.Data.DatarowComparer.Default作为比较器作为输入参数,以保证对 DataRow是进行值比较，而不是引用比较。当然，如果GroupBy或者其他操作的 key的类型是DataRow时，也需要使用此比较器，以使我们得到我们期望的行为。</font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold">2 、SetField可以将字段值设置为null,并且SetField方法将自动将其转 换为DBNull.Value.</font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold">3 、Field可以完成从DBNull.Value到null的转换。 也就是说，如果该字段的值是DBNull.Value 时，Field方法将自动将其转为null 并返回。这个方法是强类型的，不需要象通过列名或者列索引返回字段值一样将 Object类型进行造型成需要的类型（值类型进行拆箱操作），（如果字段的值是 DBNull.Value时进行造型还将导致抛出异常）Field扩展方法自动做了这些处理 ，省去了开发人员手动进行这些处理的麻烦。</font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold">4 、缺省情况下，数据行 的Original版本中是没有值的，试图访问时将导致异常发生。当然，可以在访问 之前使用DataRow.HasVersion来进行判断，以防止异常的发生。也可以通过调用 DataRow.AcceptChanges方法来建立Original版本来避免异常的发生。不带 LoadOptions参数的CopyToDataTable扩展方法也会为返回的DataTable自动建立 DataRow的Original和Current版本.</font></p><p style="margin: 0px; padding: 0px 0px 10px; color: rgb(51, 51, 51); font-size: 15px; line-height: 25px; background-color: rgb(255, 255, 255);"><font face="Yu Mincho Demibold">5 当使用带LoadOptions输入参数的 CopyToDataTable扩展方法时，必须为目标DataTable指定主键列，否则，该函数 只是将源DataTable追加到目标DataTable的最后面。可能达不到期望更新的结果</font></p><font face="Yu Mincho Demibold"><br></font><div style="color:gray"><small><font face="Yu Mincho Demibold">来源：&nbsp;&lt;<a href="http://www.shangxueba.com/jingyan/100410.html">http://www.shangxueba.com/jingyan/100410.html</a><small>&gt;</small></font></small></div><small><small><font face="Yu Mincho Demibold">&nbsp;</font></small></small></div></div></body></html>