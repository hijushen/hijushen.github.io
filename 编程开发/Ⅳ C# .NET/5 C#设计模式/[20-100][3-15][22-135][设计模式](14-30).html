<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--defaultCSS-->
<title>[20/100][3/15][22/135][设计模式](14/30)</title>





<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style>
<style type="text/css" id="wiz_custom_css">
body
{
    font-family: Microsoft YaHei UI,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>

<link type="text/css" rel="stylesheet" id="wiz_code_highlight_link" href="[20-100][3-15][22-135][设计模式](14-30)_files/wiz_code_highlight_43.css"></head>

<body style="" >享元模式<div>string 类的驻留机制.</div><div>详细介绍地址1:&nbsp;<a href="http://www.cnblogs.com/zhili/p/FlyweightPattern.html">http://www.cnblogs.com/zhili/p/FlyweightPattern.html</a>&nbsp;( 跟我学C#设计模式)(<a href="http://weibo.com/2856079624/profile?s=6cm7D0" target="_blank" alt="天平Learning" title="天平Learning" style="font-size: 10.5pt; text-decoration: none; color: rgb(0, 120, 182); border-color: rgb(210, 210, 210); line-height: 16px; font-family: Arial, Helvetica, sans-serif; widows: 1;">天平Learning</a><span style="font-size: 10.5pt; line-height: 1.5;">)&nbsp;</span></div><div><br></div><div><div>涉及的角色如下几种角色：</div><div>&nbsp;</div><div>抽象享元角色（Flyweight）:此角色是所有的具体享元类的基类，为这些类规定出需要实现的公共接口。那些需要外部状态的操作可以通过调用方法以参数形式传入。</div><div>&nbsp;</div><div>具体享元角色（ConcreteFlyweight）：实现抽象享元角色所规定的接口。如果有内部状态的话，可以在类内部定义。</div><div>&nbsp;</div><div>享元工厂角色（FlyweightFactory）：本角色复杂创建和管理享元角色。本角色必须保证享元对象可以被系统适当地共享，当一个客户端对象调用一个享元对象的时候，享元工厂角色检查系统中是否已经有一个符合要求的享元对象，如果已经存在，享元工厂角色就提供已存在的享元对象，如果系统中没有一个符合的享元对象的话，享元工厂角色就应当创建一个合适的享元对象。</div><div>&nbsp;</div><div>客户端角色（Client）：本角色需要存储所有享元对象的外部状态。</div><div>&nbsp;</div><div>注：上面的实现只是单纯的享元模式，同时还有复合的享元模式，由于复合享元模式较复杂，这里就不给出实现了。</div><div>&nbsp;</div><div>三、享元模式的优缺点</div><div>分析完享元模式的实现之后，让我们继续分析下享元模式的优缺点：</div><div>&nbsp;</div><div>优点：</div><div>&nbsp;</div><div>降低了系统中对象的数量，从而降低了系统中细粒度对象给内存带来的压力。</div><div>缺点：</div><div>&nbsp;</div><div>为了使对象可以共享，需要将一些状态外部化，这使得程序的逻辑更复杂，使系统复杂化。</div><div>享元模式将享元对象的状态外部化，而读取外部状态使得运行时间稍微变长。</div><div>四、使用场景</div><div>在下面所有条件都满足时，可以考虑使用享元模式：</div><div>&nbsp;</div><div>一个系统中有大量的对象；</div><div>这些对象耗费大量的内存；</div><div>这些对象中的状态大部分都可以被外部化</div><div>这些对象可以按照内部状态分成很多的组，当把外部对象从对象中剔除时，每一个组都可以仅用一个对象代替</div><div>软件系统不依赖这些对象的身份，</div><div>满足上面的条件的系统可以使用享元模式。但是使用享元模式需要额外维护一个记录子系统已有的所有享元的表，而这也需要耗费资源，所以，应当在有足够多的享元实例可共享时才值得使用享元模式。</div></div><div><br></div><div>代码:&nbsp;</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Program</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">        </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Main</span><span class="pun">(</span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">            </span><span class="typ">WebSiteFactory</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WebSiteFactory</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">            </span><span class="typ">Website</span><span class="pln"> fx </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">.</span><span class="typ">GetWebSiteCategory</span><span class="pun">(</span><span class="str">"产品展示"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">            fx</span><span class="pun">.</span><span class="typ">Use</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="str">"小菜"</span><span class="pun">));</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">            </span><span class="typ">Website</span><span class="pln"> fy </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">.</span><span class="typ">GetWebSiteCategory</span><span class="pun">(</span><span class="str">"产品展示"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">            fy</span><span class="pun">.</span><span class="typ">Use</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="str">"大鸟"</span><span class="pun">));</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">            </span><span class="typ">Website</span><span class="pln"> fz </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">.</span><span class="typ">GetWebSiteCategory</span><span class="pun">(</span><span class="str">"产品展示"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">            fz</span><span class="pun">.</span><span class="typ">Use</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="str">"葛礼玉"</span><span class="pun">));</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">            </span><span class="typ">Website</span><span class="pln"> fl </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">.</span><span class="typ">GetWebSiteCategory</span><span class="pun">(</span><span class="str">"博客"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">            fl</span><span class="pun">.</span><span class="typ">Use</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="str">"熊大"</span><span class="pun">));</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">            </span><span class="typ">Website</span><span class="pln"> fm </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">.</span><span class="typ">GetWebSiteCategory</span><span class="pun">(</span><span class="str">"博客"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">            fm</span><span class="pun">.</span><span class="typ">Use</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="str">"熊二"</span><span class="pun">));</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">            </span><span class="typ">Website</span><span class="pln"> fn </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">.</span><span class="typ">GetWebSiteCategory</span><span class="pun">(</span><span class="str">"博客"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">            fn</span><span class="pun">.</span><span class="typ">Use</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="str">"熊三"</span><span class="pun">));</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">            </span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"得到网站总数: {0}"</span><span class="pun">,</span><span class="pln"> f</span><span class="pun">.</span><span class="typ">GetWebSiteCount</span><span class="pun">());</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">            </span><span class="typ">Console</span><span class="pun">.</span><span class="typ">ReadKey</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="com">//作为外部状态, 需传入</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> name</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="kwd">string</span><span class="pln"> name</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="typ">Name</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">            get </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> name</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre></div><div>&nbsp;Flyweight 享元及工厂类:</div></div><div><br></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Website</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Use</span><span class="pun">(</span><span class="typ">User</span><span class="pln"> user</span><span class="pun">);</span><span class="pln"> </span><span class="com">//方法 传递用户对象, 外部状态</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ConcreteWebSite</span><span class="pun">:</span><span class="typ">Website</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">ConcreteWebSite</span><span class="pun">(</span><span class="kwd">string</span><span class="pln"> name</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">override</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Use</span><span class="pun">(</span><span class="typ">User</span><span class="pln"> user</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">            </span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"网站分类: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> name </span><span class="pun">+</span><span class="pln"> </span><span class="str">" 用户: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> user</span><span class="pun">.</span><span class="typ">Name</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">WebSiteFactory</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Hashtable</span><span class="pln"> flyweights </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Hashtable</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Website</span><span class="pln"> </span><span class="typ">GetWebSiteCategory</span><span class="pun">(</span><span class="kwd">string</span><span class="pln"> key</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">flyweights</span><span class="pun">.</span><span class="typ">Contains</span><span class="pun">(</span><span class="pln">key</span><span class="pun">))</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">            </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">                flyweights</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="pln">key</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConcreteWebSite</span><span class="pun">(</span><span class="pln">key</span><span class="pun">));</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">            </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">((</span><span class="typ">Website</span><span class="pun">)</span><span class="pln">flyweights</span><span class="pun">[</span><span class="pln">key</span><span class="pun">]);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> </span><span class="typ">GetWebSiteCount</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> flyweights</span><span class="pun">.</span><span class="typ">Count</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre></div><div><br></div></div></body></html>