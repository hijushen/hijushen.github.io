<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=8" />

<!--defaultCSS-->
<title>策略模式--[31/100][5/15][33/135][设计模式](25/30)</title>



<style type="text/css" id="wiz_custom_css">
body
{
    font-family: Microsoft YaHei UI,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>

<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style><link type="text/css" rel="stylesheet" id="wiz_code_highlight_link" href="策略模式--[31-100][5-15][33-135][设计模式](25-30)_files/wiz_code_highlight_3.css"></head>

<body  style=""><h2>[31/100][5/15][33/135][设计模式](25/30)--策略模式 (2015/7/13 星期一 16:50:37)</h2>定义了算法家族, 分别封装起来, 让他们之间可以互相替换&nbsp;<div>工厂促销, 可以通过简单工厂实现, 但是不同打折方式, 需要修改工厂.</div><div><br></div><div>简单工厂模式, 让客户端认识2个类: CashSuper和CashFactory.</div><div>而策略模式和简单工厂 结合(判定语句移动到Context内容中), 客户端只需要认识 context即可.</div><div>算法与客户端分离, 连算法的父类 都不需要客户端认识.</div><div><br></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Strategy</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">AlgorithmInterface</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ConcreteStrategyA</span><span class="pun">:</span><span class="typ">Strategy</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">override</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">AlgorithmInterface</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">            </span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"算法A 实现"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ConcreteStrategyB</span><span class="pun">:</span><span class="typ">Strategy</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">override</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">AlgorithmInterface</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">            </span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"算法B 实现"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ConcreteStrategyC</span><span class="pun">:</span><span class="typ">Strategy</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span><span class="pln">   </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">override</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">AlgorithmInterface</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">            </span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="str">"算法C 实现"</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Context</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">        </span><span class="typ">Strategy</span><span class="pln"> strategy</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln">  </span><span class="typ">Context</span><span class="pun">(</span><span class="typ">Strategy</span><span class="pln"> strategy</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> strategy</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">ContextInterface</span><span class="pun">()</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">            strategy</span><span class="pun">.</span><span class="typ">AlgorithmInterface</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre></div><div>调用代码:</div></div><div><br></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Program</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">    </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">        </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Main</span><span class="pun">(</span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">        </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">            </span><span class="typ">Context</span><span class="pln"> context</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">            context </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Context</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConcreteStrategyA</span><span class="pun">());</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">            context</span><span class="pun">.</span><span class="typ">ContextInterface</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">            context </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Context</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConcreteStrategyB</span><span class="pun">());</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">            context</span><span class="pun">.</span><span class="typ">ContextInterface</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">            context </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Context</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConcreteStrategyC</span><span class="pun">());</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">            context</span><span class="pun">.</span><span class="typ">ContextInterface</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="pln">            </span><span class="typ">Console</span><span class="pun">.</span><span class="typ">Read</span><span class="pun">();</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">        </span><span class="pun">}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre></div><div><br></div></div><div><br></div><hr /><h2>改进的策略模式-反射 (2012/11/7 星期三 16:39:56)</h2>
<style type="text/css" id="wiz_custom_css">
body
{
    font-family: Microsoft YaHei UI,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>
<meta http-equiv="X-UA-Compatible" content="IE=8" />
<title>改进的策略模式-反射</title><?xml version="1.0" encoding="UTF-8"?>


<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
对于简单工厂模式和策略模式而言，都无法去掉switch 语句来实例化具体的哪一个子类对象。编程方式：Dependency Injection 依赖注入。依赖注入需要专门的Ioc容器，比如spring.net，我们只需要一个简单的.net技术”反射“就可以了。Animal animal = new Cat();正常的多态新建。根据依赖注入的方式：Animial animal = (Animal)Assembly.Load(&quot;AnimalSystem&quot;).CreateInstance(&quot;AnimalSystem.Cat&quot;);
<div><b>Assembly.Load(&quot;程序集名称&quot;).CreateInstance(&quot;名称空间.类名称&quot;)</b>；</div><div>在商场收银系统中，cc.setBehavior(new CashNormal());可以变换为cc.setBehavior((CashSuper)Assembly.Load(&quot;商场收银系统&quot;).CreateInstance(&quot;商场收银系统.CashNormal&quot;))。最大的转变是字符串是可以载入的，可以根据变量来完成实例化。</div><div><br/></div><div><br/></div><div>理论基础：反射，Reflection，通过它我们可以在运行时获得各种信息，如程序集、模块、类型、字段、属性、方法和事件&nbsp;通过对类型动态实例化后，还可以对其执行操作。一般用于插件式框架程序和设计模式的实现，当然反射是一种手段可以充分发挥其能量来完成你想做的任何事情（前面好象见过一位高人用反射调用一个官方类库中未说明的函数。。。） Case：</div><div>using System;<br/>
using System.Collections.Generic;<br/>
using System.Text;<br/><br/>
namespace Example25Lib<br/>
{<br/>
public class Class1<br/>
{<br/>
private string name;<br/>
private int age;<br/><br/>
//如果显式的声明了无参数构造函数，客户端只需要用程序集的CreateInstance即可实例化该类<br/>
//在此特意不实现，以便在客户调用端体现构造函数的反射实现<br/>
//public Class1()<br/>
//{<br/>
//}<br/>
public Class1(string Name, int Age)<br/>
{<br/>
name = Name;<br/>
age = Age;<br/>
}<br/>
public void ChangeName(string NewName)<br/>
{<br/>
name = NewName;<br/>
}<br/>
public void ChangeAge(int NewAge)<br/>
{<br/>
age = NewAge;<br/>
}<br/>
public override string ToString()<br/>
{<br/>
return string.Format(&quot;Name: {0}, Age: {1}&quot;, name, age);<br/>
}<br/>
}<br/>
}<br/>
反射实例化对象并调用其方法，属性和事件的反射调用略去<br/><br/>
using System;<br/>
using System.Collections.Generic;<br/>
using System.Text;<br/><br/>
//注意添加该反射的命名空间<br/>
using System.Reflection;<br/><br/>
namespace Example25<br/>
{<br/>
class Program<br/>
{<br/>
static void Main(string[] args)<br/>
{<br/>
//加载程序集<br/>
Assembly tmpAss = Assembly.LoadFile(AppDomain.CurrentDomain.BaseDirectory + &quot;Example25Lib.dll&quot;);<br/><br/>
//遍历程序集内所有的类型，并实例化<br/>
Type[] tmpTypes = tmpAss.GetTypes();<br/>
foreach (Type tmpType in tmpTypes)<br/>
{<br/>
//获取第一个类型的构造函数信息<br/>
ConstructorInfo[] tmpConsInfos = tmpType.GetConstructors();<br/>
foreach (ConstructorInfo tmpConsInfo in tmpConsInfos)<br/>
{<br/>
//为构造函数生成调用的参数集合<br/>
ParameterInfo[] tmpParamInfos = tmpConsInfo.GetParameters();&nbsp;<br/>
object[] tmpParams = new object[tmpParamInfos.Length];<br/>
for (int i = 0; i &lt; tmpParamInfos.Length; i++)<br/>
{<br/>
tmpParams[i] = tmpAss.CreateInstance(tmpParamInfos[i].ParameterType.FullName);<br/>
if (tmpParamInfos[i].ParameterType.FullName == &quot;System.String&quot;)<br/>
&nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp; tmpParams[i] = &quot;Clark&quot;;<br/>
}<br/>
}<br/><br/>
//实例化对象<br/>
object tmpObj = tmpConsInfo.Invoke(tmpParams);<br/>
Console.WriteLine(tmpObj);<br/><br/>
//获取所有方法并执行<br/>
foreach (MethodInfo tmpMethod in tmpType.GetMethods())<br/>
{<br/>
//为方法的调用创建参数集合<br/>
tmpParamInfos = tmpMethod.GetParameters();<br/>
tmpParams = new object[tmpParamInfos.Length];<br/>
for (int i = 0; i &lt; tmpParamInfos.Length; i++)<br/>
&nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp; tmpParams[i] = tmpAss.CreateInstance(tmpParamInfos[i].ParameterType.FullName);<br/>
&nbsp;&nbsp;&nbsp;&nbsp; if (tmpParamInfos[i].ParameterType.FullName == &quot;System.String&quot;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmpParams[i] = &quot;Clark Zheng&quot;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp; }<br/>
&nbsp;&nbsp;&nbsp;&nbsp; if (tmpParamInfos[i].ParameterType.FullName == &quot;System.Int32&quot;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmpParams[i] = 27;<br/>
&nbsp;&nbsp;&nbsp;&nbsp; }<br/>
}<br/>
tmpMethod.Invoke(tmpObj, tmpParams);<br/>
}<br/><br/>
//调用完方法后再次打印对象，比较结果<br/>
Console.WriteLine(tmpObj);<br/>
}<br/>
}<br/><br/>
Console.ReadLine();<br/>
}<br/>
}<br/>
}<br/>
结果：<br/>
Name: Clark, Age: 0<br/>
Name: Clark Zheng, Age: 27 &nbsp;<br/></div></div></body></html>