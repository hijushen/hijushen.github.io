<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--defaultCSS-->
<title>9/1 日部分 WPF更新异步更新界面 /b后台启动线程/c自定义事件的加载顺序</title>



<style type="text/css" id="wiz_custom_css">
body
{
    font-family: Microsoft YaHei UI,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>

<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style><link type="text/css" rel="stylesheet" id="wiz_code_highlight_link" href="9-1 日部分 WPF更新异步更新界面 -b后台启动线程-c自定义事件的加载顺序_files/wiz_code_highlight_41.css"></head>

<body  style="">1.<font face="Microsoft YaHei UI">&nbsp; &nbsp; 后台更新界面等标准代码</font><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">          <span style="background-color: rgb(255, 215, 0);"> </span></span><font color="#ff0000" style="background-color: rgb(255, 215, 0);"><span class="kwd">this</span><span class="pun">.</span><span class="typ">Dispatcher</span><span class="pun">.</span><span class="typ">BeginInvoke</span></font><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ThreadDelegate</span><span class="pun">(</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="pln">                async </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="pln">                </span><span class="pun">{</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="pln">                    remove_question_from_request</span><span class="pun">(</span><span class="pln">arg</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="pln">                    add_new_question_from_request</span><span class="pun">(</span><span class="pln">arg</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pln">                    </span><span class="com">//Global.MainPage.UpdateJNumNotify(MessageCenterList.Count());</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="pln">                    </span><span class="typ">Global</span><span class="pun">.</span><span class="typ">MainPage</span><span class="pun">.</span><span class="typ">UpdateJList</span><span class="pun">(</span><span class="typ">MessageCenterList</span><span class="pun">.</span><span class="typ">Count</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="pln">                </span><span class="pun">}));</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">            </span><span class="pun">}</span></code></li></ol></pre></div><div>2.<span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; 启动线程相应方法.</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-size: 10.5pt; line-height: 1.5;">Task.Run会自动执行Unwrap操作，但是Task.Factory.StartNew不会，Task.Run就是Task.Factory.StartNew的更人性化封装，而Task.Factory.StartNew则是原始的执行。对嵌套的Unwrap() 动作可以返回实际的值。</span></div></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="lit">1.Task</span><span class="pun">.</span><span class="typ">Factory</span><span class="pun">.</span><span class="typ">StartNew</span><span class="pun">(())；;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="lit">2.Task</span><span class="pun">.</span><span class="typ">Run</span><span class="pun">(</span><span class="pln">async </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">BeginToLoad</span><span class="pun">();</span><span class="pln"> </span><span class="pun">});</span></code></li></ol></pre></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="com">//int数据</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="kwd">var</span><span class="pln"> ints </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Enumerable</span><span class="pun">.</span><span class="typ">Range</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="com">//Select调用异步方法</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="typ">IEnumerable</span><span class="str">&lt;string&gt;</span><span class="pln"> strs </span><span class="pun">=</span><span class="pln"> ints</span><span class="pun">.</span><span class="typ">Select</span><span class="pun">(</span><span class="pln">i </span><span class="pun">=&gt;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="typ">Task</span><span class="pun">.</span><span class="typ">Factory</span><span class="pun">.</span><span class="typ">StartNew</span><span class="pun">(</span><span class="pln">async </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> await </span><span class="typ">Int2StringAsync</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)).</span><span class="typ" style="background-color: rgb(255, 215, 0);">Unwrap</span><span class="pun"><span style="background-color: rgb(255, 215, 0);">()</span>.</span><span class="typ">Result</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="pun">------</span><span class="typ">Task</span><span class="pun">方法的</span><span class="typ">Unwrap</span><span class="pun">操作</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="typ">IEnumerable</span><span class="str">&lt;string&gt;</span><span class="pln"> strs </span><span class="pun">=</span><span class="pln"> ints</span><span class="pun">.</span><span class="typ">Select</span><span class="pun">(</span><span class="pln">i </span><span class="pun">=&gt;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="typ">Task</span><span class="pun">.</span><span class="typ">Run</span><span class="pun">(</span><span class="pln">async </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> await </span><span class="typ">Int2StringAsync</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)).</span><span class="typ">Result</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs" style="background-color: rgb(255, 215, 0);"><span class="pln">http</span><span class="pun">:</span><span class="com">//www.mgenware.com/blog/?p=338 //后续验证</span></code></li></ol></pre></div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp;&nbsp;</font><br></div></div><div>3.<span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; 事件的相应 模范作业。事件加载</span></div></div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="lit">1.EventArgs</span><span class="pun">的使用。</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MessageEventArgs</span><span class="pun">{}</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-cs"><span class="lit">2.</span><span class="pun">委托声明</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">OnReceiveMessageEventHandler</span><span class="pun">(</span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MessageEventArgs</span><span class="pln"> e</span><span class="pun">);</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-cs"><span class="lit">3.</span><span class="pun">事件的声明</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-cs"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="typ">OnReceiveMessageEventHandler</span><span class="pln"> </span><span class="typ">OnReceiveMessageEvent</span><span class="pun">;</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-cs"><span class="lit">4.</span><span class="pun">事件的注册</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-cs"><span class="typ">Global</span><span class="pun">.</span><span class="typ">XMPPClient</span><span class="pun">.</span><span class="typ">OnReceiveMessageEvent</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MPPClinet</span><span class="pun">.</span><span class="typ">OnReceiveMessageEventHandler</span><span class="pun">(</span><span class="typ">OnReceiveMessage</span><span class="pun">);</span><span class="pln"> </span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-cs"><span class="lit">5.</span><span class="pun">事件的触发</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-cs"><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">OnReceiveMessageEvent</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-cs"><span class="pln">     </span><span class="pun">{</span><span class="typ">OnReceiveMessageEvent</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">)};</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-cs"></code></li></ol></pre></div><div><br></div></div></body></html>