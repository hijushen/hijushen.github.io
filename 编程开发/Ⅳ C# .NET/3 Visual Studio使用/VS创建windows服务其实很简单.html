<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>VS创建windows服务其实很简单</title><?xml version="1.0" encoding="UTF-8"?>


<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><h1 style="margin: 108px 0px 24px; padding: 0px; font-size: 30px; word-break: break-all; font-weight: normal; font-family: 微软雅黑, Tahoma; background-color: rgb(243, 241, 240);">VS创建windows服务其实很简单</h1><div style="margin: 0px; padding: 0px; border: 0px; font-size: 16px; line-height: 1.6em; font-family: 微软雅黑, Tahoma; background-color: rgb(243, 241, 240);"><div style="margin: 32px 0px 0px; padding: 0px; border: 0px;"><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">用VS做一个windows服务其实很简单。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">下面是一个用VS2010做windows服务的简单例子和一些注意事项。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"><strong>1.新建一个windows服务</strong></p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"/><div style="margin: 0px 0px 16px; padding: 0px; border: 0px;"><img hash="4b2d68689af4b3c42b0f1ee1bdfae4c8" style="cursor: default;" type="image/jpeg" src="VS创建windows服务其实很简单_files/4b2d68689af4b3c42b0f1ee1bdfae4c8.jpg" /></div><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"/><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"><strong>2.添加代码</strong></p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">vs会自动生成一些代码</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在Service1.cs中会看到如下代码</p><div style="margin: 0px 0px 16px; padding: 0px; border: 0px;"><en-media hash="1c53668bcee393edac0d7b3b3daff1ae" style="cursor: default;" type="image/gif"/><en-media hash="405b18b4b6584ae338e0f6ecaf736533" style="cursor: default;" type="image/gif"/>View Code</div><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">&nbsp;其中OnStart为启动服务时调用的方法；OnStop为停止服务时调用的方法。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">每个服务都还有其他方法，比如暂停、恢复等，可以重载基类的方法来实现，如暂停：</p><div style="margin: 0px 0px 16px; padding: 0px; border: 0px;"><en-media hash="1c53668bcee393edac0d7b3b3daff1ae" style="cursor: default;" type="image/gif"/><en-media hash="405b18b4b6584ae338e0f6ecaf736533" style="cursor: default;" type="image/gif"/>View Code</div><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">自己的业务逻辑就可以在这些方法中调用实现。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">ps：在做windows服务时常常是要弄一个循环还处理某些业务逻辑，常见的方法是用一个Timer控件，值得注意的是Toolbox中的Timer控件默认是System.Windows.Forms.Timer，显然在这里是不会起作用的，这里可用System.Timers.Timer，可以直接在Toolbox中右键添加。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"/><div style="margin: 0px 0px 16px; padding: 0px; border: 0px;"><img hash="c59ded6f9f2696b3720f94ce956a74e3" style="cursor: default;" type="image/jpeg" src="VS创建windows服务其实很简单_files/c59ded6f9f2696b3720f94ce956a74e3.jpg" /></div><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"/><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"><strong>3.添加Installer</strong></p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">这一步很关键，在处理完业务逻辑后需添加一个Installer才能使你的windows服务能够被安装。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在VS中添加Installer也很简单，操作如下：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">右键Service1.cs</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"/><div style="margin: 0px 0px 16px; padding: 0px; border: 0px;"><img hash="15bba7211567f96f3f53d7840640a1c2" style="cursor: default;" type="image/jpeg" src="VS创建windows服务其实很简单_files/15bba7211567f96f3f53d7840640a1c2.jpg" /></div><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"/><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">再到View Desiger视图中右键</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"><img hash="f588c430adc83098ac461ed1b42b8af4" style="cursor: default;" type="image/jpeg" src="VS创建windows服务其实很简单_files/f588c430adc83098ac461ed1b42b8af4.jpg" /></p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">Installer就添加好了。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"><strong>4.设置服务参数</strong></p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">可以在程序中先给定windows服务的参数</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在添加Installer时会自动生成一个ProjectInstaller.cs，在这个文件中有个InitializeComponent方法，如下：</p><div style="margin: 0px 0px 16px; padding: 0px; border: 0px;"><en-media hash="1c53668bcee393edac0d7b3b3daff1ae" style="cursor: default;" type="image/gif"/><en-media hash="405b18b4b6584ae338e0f6ecaf736533" style="cursor: default;" type="image/gif"/>View Code</div><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">this.serviceProcessInstaller1.Password = null;<br/>
this.serviceProcessInstaller1.Username = null;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">为设置服务的登陆账号密码，如果不想设置用户名密码也可以采用本地系统帐户运行服务，代码如下：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">&nbsp;this.serviceProcessInstaller1.Account = System.ServiceProcess.ServiceAccount.LocalSystem;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">其他设置也可在此完成。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"><strong>5.安装和卸载windows服务</strong></p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">制作完成的windows服务发布后为一个exe文件，要想到目标机器上安装使用这个服务，可以用微软提供的installutil工具，通过命令行的方式实现安装和卸载。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">installutil工具在目录：系统盘:\WINDOWS\Microsoft.NET\Framework\v4.0.30319下，运行cmd，输入</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\installutil xxxx.exe 回车，即可完成windows服务的安装。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">卸载则为输入 C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\installutil&nbsp;/u&nbsp;xxxx.exe 回车。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">ps：可以保存为bat文件执行则更为方便。可参考：<a href="http://www.cnblogs.com/nbwzy/archive/2007/05/30/764571.html" style="text-decoration: none; color: rgb(51, 51, 51);" target="_blank">http://www.cnblogs.com/nbwzy/archive/2007/05/30/764571.html</a></p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">一个简单的windows服务就制作完成了，开始打开你的VS自己动手试试吧。</p></div></div></div>