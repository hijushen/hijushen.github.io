<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>SQL Trainning 总结</title><?xml version="1.0" encoding="UTF-8"?>


<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
1，Oracle 使用索引更快的遍历表，如果SQL不合理，就会造成优化器删去索引而使用全表扫描，这种SQL就是劣质SQL。
<div>1.不要要Oracle 做的太多；</div><div>&nbsp; &nbsp; &nbsp;1)避免复杂的多表关联；</div><div>&nbsp; &nbsp; &nbsp;2)避免使用*；</div><div>&nbsp; &nbsp; &nbsp;3)避免使用好用资源的操作：Distinct、UNION、MINUS、INTERSET、ORDER BY 等。</div><div>&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用EXISTS 替换 DISTINCT</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 使用Union ALL 替代UNION（如果必要）</div><div>&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div><br/></div><div>2.给优化器以明确的命令；</div><div>&nbsp; &nbsp; &nbsp;自动选择索引</div><div>&nbsp; &nbsp; &nbsp;至少要包含组合索引的第一列</div><div>&nbsp; &nbsp; &nbsp;避免在索引上使用函数</div><div>&nbsp; &nbsp; &nbsp;避免使用前置通配符</div><div>&nbsp; &nbsp; &nbsp;避免在索引列上使用NOT</div><div>&nbsp; &nbsp; &nbsp;避免在索引上使用Is NULL 和 IS NOT NULL</div><div>&nbsp; &nbsp; &nbsp;避免出现索引列自动转换</div><div>&nbsp; &nbsp; &nbsp;在查询时尽量少用格式转换</div><div>&nbsp; &nbsp; &nbsp;</div><div>&nbsp; &nbsp; &nbsp;</div><div>3.减少访问次数；</div><div>&nbsp; &nbsp; &nbsp;使用DECODE 来减少处理时间</div><div>&nbsp; &nbsp; &nbsp;减少对表的查询</div><div>&nbsp; &nbsp; &nbsp;<span style="line-height: 80%; text-align: left; text-indent: -0.38in; font-size: 18pt; font-family: Arial; font-weight: bold;">&nbsp; &nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp; 低效</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SELECT TAB_NAME<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM TABLES<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHERE TAB_NAME = ( SELECT TAB_NAME<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM TAB_COLUMNS<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHERE VERSION = 604)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND DB_VER= ( SELECT DB_VER<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM TAB_COLUMNS<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHERE VERSION = 604)<br/>
&nbsp;&nbsp;&nbsp;&nbsp; 高效<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SELECT TAB_NAME<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM TABLES<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHERE&nbsp; (TAB_NAME,DB_VER)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = ( SELECT TAB_NAME,DB_VER)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM TAB_COLUMNS<br/><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WHERE VERSION = 604)&nbsp;<span style="color: rgb(235, 31, 34); font-family: Arial; font-size: 18pt; font-weight: bold; line-height: 80%; text-align: left; text-indent: -0.21in;">&nbsp;&nbsp;</span></div><div>4.细节上的影响。</div><div>&nbsp; &nbsp; &nbsp;WEHRE 字句应该将筛选、返回结果集小的放在最后；</div><div>&nbsp; &nbsp; &nbsp;WHERE字句使用合理的函数和表达式</div><div>&nbsp; &nbsp; &nbsp;ORDER BY 使用索引列，没有的要建立，</div><div>&nbsp; &nbsp; &nbsp;联结列不使用索引</div><div>&nbsp; &nbsp; &nbsp;通配符的like 语句，不应该出现在词首</div><div>&nbsp; &nbsp; &nbsp;WHERE 代替HAVING</div><div>&nbsp; &nbsp; &nbsp;NOT Exist 〉 NOT IN 的效率，都不使用索引</div><div>&nbsp; &nbsp; &nbsp;&gt;= 代替 &gt;</div><div>&nbsp; &nbsp; &nbsp;例子：</div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;">select * from employee where salary &lt;&gt; 3000;</blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><br/></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;">对这个查询，可以改写为不使用NOT：</blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;">select * from employee where salary&lt;3000 or salary&gt;3000;</blockquote></blockquote>
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<div>&nbsp; &nbsp; &nbsp;外部链接的用法：</div><div><br/></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>&nbsp; &nbsp; &nbsp;外部联接&quot;+&quot;按其在&quot;=&quot;的左边或右边分左联接和右联接。若不带&quot;+&quot;运算符的表中的一个行不直接匹配于带&quot;+&quot;预算符的表中的任何行，则前者的行与后者中的一个空行相匹配并被返回。利用外部联接&quot;+&quot;，可以替代效率十分低下的 not in 运算，大大提高运行速度。例如，下面这条命令执行起来很慢：</div></blockquote></blockquote><div><br/></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>select a.empno from emp a where a.empno not in</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><br/></div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>&nbsp;&nbsp;&nbsp;&nbsp; (select empno from emp1 where job=&#39;SALE&#39;);</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><br/></div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>利用外部联接，改写命令如下:</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><br/></div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>select a.empno from emp a ,emp1 b</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>where a.empno=b.empno(+)</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>and b.empno is null</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>and b.job=&#39;SALE&#39;;</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><br/></div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>&nbsp;&nbsp;&nbsp;&nbsp; 这样运行速度明显提高.</div></blockquote><div>&nbsp; &nbsp; &nbsp;</div></blockquote><div>&nbsp; &nbsp; &nbsp;多使用COMMIT，用TRUNCATE替代DELETE</div><div>&nbsp; &nbsp; &nbsp;</div><div>&nbsp; &nbsp; &nbsp;COUNT(*) &gt; COUNT(1)</div><div>&nbsp;</div><div><br/></div><div><br/></div></div>