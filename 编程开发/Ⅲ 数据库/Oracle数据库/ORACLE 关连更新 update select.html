<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--defaultCSS-->
<title>ORACLE 关连更新 update select</title>



<style type="text/css" id="wiz_custom_css">
body
{
    font-family: "Microsoft YaHei UI","Microsoft YaHei",SimSun,"Segoe UI",Tahoma,Helvetica,Sans-Serif,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>
<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style><link type="text/css" rel="stylesheet" id="wiz_code_highlight_link" href="ORACLE 关连更新 update select_files/wiz_code_highlight.css"></head>

<body style="" ><p><br></p><p>总结: &nbsp;<span style="font-size: 10.5pt; line-height: 1.5;">关键的地方是where 语句的加入. 在11G中, 如果不加11G , </span><font color="#ff0000" style="font-size: 10.5pt; line-height: 1.5;">或造成除匹配的行数更新为相应的值之后, 其余的会变成负数.&nbsp;</font></p><p><font face="Microsoft YaHei UI" color="#ff0000">&nbsp; &nbsp; 所以, 测试的办法就是: &nbsp;先查看需要更新的数量即连接的数量究竟有多少行, 然后update 之后多少行, 才能确定条件是否正确.</font><br></p><p><font face="Microsoft YaHei UI"><br></font></p><p><font face="Microsoft YaHei UI">--2015/3/30 使用更新:</font></p><p></p><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"><span class="pln">UPDATE SFISM4</span><span class="pun">.</span><span class="pln">R_MMS_STOCK_SMT_SA_DETAIL_T A</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"><span class="pln">   SET A</span><span class="pun">.</span><span class="pln">LOC_NO </span><span class="pun">=</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-sql"><span class="pln">       </span><span class="pun">(</span><span class="pln">SELECT T</span><span class="pun">.</span><span class="pln">LOC_NO</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-sql"><span class="pln">          FROM CIMC</span><span class="pun">.</span><span class="pln">C_MMS_STOCK_Z_LINK_T T</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-sql"><span class="pln">         WHERE T</span><span class="pun">.</span><span class="pln">PART_NO </span><span class="pun">=</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">PART_NO</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-sql"><span class="pln">           AND T</span><span class="pun">.</span><span class="pln">PLANT </span><span class="pun">=</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">PLANT</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-sql"><span class="pln">           AND T</span><span class="pun">.</span><span class="pln">LOC_NO </span><span class="pun">&lt;&gt;</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">LOC_NO</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-sql"><span class="pln"> WHERE EXISTS </span><span class="pun">(</span><span class="pln">SELECT </span><span class="lit">1</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-sql"><span class="pln">          FROM CIMC</span><span class="pun">.</span><span class="pln">C_MMS_STOCK_Z_LINK_T T --Exists子句中也可嵌套调用父语句内容.</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-sql"><span class="pln">         WHERE T</span><span class="pun">.</span><span class="pln">PART_NO </span><span class="pun">=</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">PART_NO </span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"><span class="pln">           AND T</span><span class="pun">.</span><span class="pln">PLANT </span><span class="pun">=</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">PLANT</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"><span class="pln">           AND T</span><span class="pun">.</span><span class="pln">LOC_NO </span><span class="pun">&lt;&gt;</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">LOC_NO</span><span class="pun">)</span></code></li></ol></pre></div><div>使用说明: 1) 不加Exists子句, 将会知道会将不符合记录部分亦捞取出来. &nbsp;产生异常NuLL数据.</div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp;&nbsp;</font><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; 2)Exist子句的使用: from语句中同set子句中一样, 对父语句出现中<font color="#ff0000">可以不再出现. 出现了反而错误.</font>!!</span><br></div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp;&nbsp;</font><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; --红字部分.4/8 Update实践更新：</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;"><br></span></div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp;&nbsp;</font><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">&nbsp; &nbsp; 如 Update <font color="#ff0000">表A</font> where EXISTS (SELECT 1 FROM 表B WHERE <font color="#ff0000">表A</font>. &nbsp; = 表B）.where 中继续使用，重写在写用于验证结果，但是最终update的时候会出现筛选失败。！！！ 二入坑！！，重要标志如下：</span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;"><br></span></div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp;&nbsp;</font><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;"><br></span></div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"><span class="pln">UPDATE CIMR</span><span class="pun">.</span><span class="pln">R_MMS_STOCK_SA_T <span style="background-color: rgb(255, 0, 255);">B</span></span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"><span class="pln">   SET </span><span class="pun">(</span><span class="pln">B</span><span class="pun">.</span><span class="pln">TOTAL_QTY</span><span class="pun">,</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">UPDATE_TIME</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-sql"><span class="pln">       </span><span class="pun">(</span><span class="pln">SELECT C</span><span class="pun">.</span><span class="pln">VQ</span><span class="pun">,</span><span class="pln"> C</span><span class="pun">.</span><span class="pln">VD</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-sql"><span class="pln">          FROM </span><span style="background-color: rgb(175, 238, 238);"><span class="pun">(</span><span class="pln">SELECT A</span><span class="pun">.</span><span class="pln">PLANT VP</span><span class="pun">,</span></span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-sql" style="background-color: rgb(175, 238, 238);"><span class="pln">                       A</span><span class="pun">.</span><span class="pln">PART_NO VN</span><span class="pun">,</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-sql" style="background-color: rgb(175, 238, 238);"><span class="pln">                       SUM</span><span class="pun">(</span><span class="pln">A</span><span class="pun">.</span><span class="pln">REEL_QTY</span><span class="pun">)</span><span class="pln"> VQ</span><span class="pun">,</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-sql"><span class="pln" style="background-color: rgb(175, 238, 238);">                       SYSDATE VD</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-sql" style="background-color: rgb(175, 238, 238);"><span class="pln">                  FROM SFISM4</span><span class="pun">.</span><span class="pln">R_MMS_STOCK_SMT_SA_DETAIL_T A</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-sql" style="background-color: rgb(175, 238, 238);"><span class="pln">                 GROUP BY A</span><span class="pun">.</span><span class="pln">PART_NO</span><span class="pun">,</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">PLANT</span><span class="pun">)</span><span class="pln"> C</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-sql"><span class="pln">         WHERE B</span><span class="pun">.</span><span class="pln">RAW_PN </span><span class="pun">=</span><span class="pln"> C</span><span class="pun">.</span><span class="pln">VN</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"><span class="pln">           AND B</span><span class="pun">.</span><span class="pln">PLANT </span><span class="pun">=</span><span class="pln"> C</span><span class="pun">.</span><span class="pln">VP</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"><span class="pln"> WHERE EXISTS </span><span class="pun">(</span><span class="pln">SELECT </span><span class="lit">1</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-sql"><span class="pln">          <span style="background-color: rgb(255, 0, 255);">FROM</span> </span><span style="background-color: rgb(175, 238, 238);"><span class="pun">(</span><span class="pln">SELECT A</span><span class="pun">.</span><span class="pln">PLANT VP</span><span class="pun">,</span></span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-sql" style="background-color: rgb(175, 238, 238);"><span class="pln">                       A</span><span class="pun">.</span><span class="pln">PART_NO VN</span><span class="pun">,</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-sql" style="background-color: rgb(175, 238, 238);"><span class="pln">                       SUM</span><span class="pun">(</span><span class="pln">A</span><span class="pun">.</span><span class="pln">REEL_QTY</span><span class="pun">)</span><span class="pln"> VQ</span><span class="pun">,</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-sql"><span class="pln" style="background-color: rgb(175, 238, 238);">                       SYSDATE VD</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-sql" style="background-color: rgb(175, 238, 238);"><span class="pln">                  FROM SFISM4</span><span class="pun">.</span><span class="pln">R_MMS_STOCK_SMT_SA_DETAIL_T A</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-sql" style="background-color: rgb(175, 238, 238);"><span class="pln">                 GROUP BY A</span><span class="pun">.</span><span class="pln">PART_NO</span><span class="pun">,</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">PLANT</span><span class="pun">)</span><span class="pln"> C</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-sql"><span class="pln">         WHERE C</span><span class="pun">.</span><span class="pln">VP </span><span class="pun">=</span><span class="pln"> <font color="#ff0000" style="background-color: rgb(255, 0, 255);">B</font></span><font color="#ff0000" style="background-color: rgb(255, 0, 255);"><span class="pun">.</span><span class="pln">PLANT</span></font></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-sql"><span class="pln">           AND C</span><span class="pun">.</span><span class="pln">VN </span><span class="pun">=</span><font color="#ff0000"><span class="pln"> <font color="#ff0000" style="background-color: rgb(255, 0, 255);">B</font></span><font color="#ff0000" style="background-color: rgb(255, 0, 255);"><span class="pun">.</span><span class="pln">RAW_PN</span></font></font><span class="pun">)</span></code></li></ol></pre></div><div><br></div><p></p><p><font face="Microsoft YaHei UI"><br></font></p><p><font face="Microsoft YaHei UI">引入知识比较全面的地址:&nbsp;</font></p><p></p><div><a href="http://www.blogjava.net/Jhonney/archive/2010/06/25/324503.html">http://www.blogjava.net/Jhonney/archive/2010/06/25/324503.html</a>. &nbsp;文章最后注明转载.<br></div><p></p><p>本人用到的2处SQL:</p><p>1 :&nbsp;<span style="font-size: 10.5pt; line-height: 1.5;">&nbsp;&nbsp;</span></p><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"><span class="pln">UPDATE SFISM4</span><span class="pun">.</span><span class="pln">R_DT_DIP_TRACEABILITY_T B</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-sql"><span class="pln">   SET </span><span class="pun">(</span><span class="pln">B</span><span class="pun">.</span><span class="pln">CURRENT_QTY</span><span class="pun">,</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">UPDATE_TIME</span><span class="pun">,</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">UPDATE_USER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-sql"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-sql"><span class="pln">       </span><span class="pun">(</span><span class="pln">SELECT DECODE</span><span class="pun">(</span><span class="pln">SIGN</span><span class="pun">(</span><span class="pln">B</span><span class="pun">.</span><span class="pln">CURRENT_QTY </span><span class="pun">-</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">KP_COUNT</span><span class="pun">),</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-sql"><span class="pln">                      </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-sql"><span class="pln">                      </span><span class="lit">0</span><span class="pun">,</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-sql"><span class="pln">                      B</span><span class="pun">.</span><span class="pln">CURRENT_QTY </span><span class="pun">-</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">KP_COUNT</span><span class="pun">),</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-sql"><span class="pln">               SYSDATE</span><span class="pun">,</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-sql"><span class="pln">               </span><span class="pun">:</span><span class="pln">VUSER</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"><span class="pln">          FROM SFIS1</span><span class="pun">.</span><span class="pln">C_DT_DIP_BOM_T A</span><span class="pun">,</span><span class="pln"> SFISM4</span><span class="pun">.</span><span class="pln">R_MO_BASE_T C</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"><span class="pln">         WHERE A</span><span class="pun">.</span><span class="pln">BOM_NO </span><span class="pun">=</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">BOM_NO</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-sql"><span class="pln">           AND B</span><span class="pun">.</span><span class="pln">BOM_NO </span><span class="pun">=</span><span class="pln"> C</span><span class="pun">.</span><span class="pln">KEY_PART_NO</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-sql"><span class="pln">           AND A</span><span class="pun">.</span><span class="pln">KEY_PART_NO </span><span class="pun">=</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">KEY_PART_NO</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-sql"><span class="pln">           AND C</span><span class="pun">.</span><span class="pln">MO_NUMBER </span><span class="pun">=</span><span class="pln"> </span><span class="pun">:</span><span class="pln">VBOM</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-sql"><span class="pln">           AND B</span><span class="pun">.</span><span class="pln">TRAC_LOT </span><span class="pun">=</span><span class="pln"> </span><span class="pun">:</span><span class="pln">VTRACELOT</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-sql"><span class="pln">WHERE B</span><span class="pun">.</span><span class="pln">TRAC_LOT </span><span class="pun">=</span><span class="pln"> </span><span class="pun">:</span><span class="pln">VTRACELOT</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-sql"><span class="pln">   AND EXISTS </span><span class="pun">(</span><span class="pln">SELECT </span><span class="lit">1</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-sql"><span class="pln">          FROM SFIS1</span><span class="pun">.</span><span class="pln">C_DT_DIP_BOM_T AA</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-sql"><span class="pln">         WHERE B</span><span class="pun">.</span><span class="pln">BOM_NO </span><span class="pun">=</span><span class="pln"> AA</span><span class="pun">.</span><span class="pln">BOM_NO</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"><span class="pln">           AND B</span><span class="pun">.</span><span class="pln">KEY_PART_NO </span><span class="pun">=</span><span class="pln"> AA</span><span class="pun">.</span><span class="pln">KEY_PART_NO</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"><span class="pln"> UPDATE SFISM4</span><span class="pun">.</span><span class="pln">R_REEL_TRACKING_T A</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-sql"><span class="pln">    SET A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">=</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-sql"><span class="pln">        </span><span class="pun">(</span><span class="pln">SELECT B</span><span class="pun">.</span><span class="pln">REEL_QTY</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-sql"><span class="pln">           FROM SFISM4</span><span class="pun">.</span><span class="pln">R_MMS_STOCK_SMT_SA_DETAIL_T B</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-sql"><span class="pln">          WHERE A</span><span class="pun">.</span><span class="pln">REEL_ID </span><span class="pun">=</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">REEL_ID</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-sql"><span class="pln">            AND A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-sql"><span class="pln">            AND A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">&lt;&gt;</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">REEL_QTY</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-sql"><span class="pln">  WHERE EXISTS </span><span class="pun">(</span><span class="pln">SELECT </span><span class="lit">1</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-sql"><span class="pln">           FROM SFISM4</span><span class="pun">.</span><span class="pln">R_MMS_STOCK_SMT_SA_DETAIL_T B</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"><span class="pln">          WHERE A</span><span class="pun">.</span><span class="pln">REEL_ID </span><span class="pun">=</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">REEL_ID</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"><span class="pln">            AND A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-sql"><span class="pln">            AND A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">&lt;&gt;</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">REEL_QTY</span><span class="pun">);</span></code></li></ol></pre></div><div><br></div><div>2:&nbsp;</div><div><div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="padding-left: 0px;"><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"><span class="pln"> UPDATE SFISM4</span><span class="pun">.</span><span class="pln">R_REEL_TRACKING_T A</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-sql"><span class="pln">    SET A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">=</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L3"><code class="language-sql"><span class="pln">        </span><span class="pun">(</span><span class="pln">SELECT B</span><span class="pun">.</span><span class="pln">REEL_QTY</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L4"><code class="language-sql"><span class="pln">           FROM SFISM4</span><span class="pun">.</span><span class="pln">R_MMS_STOCK_SMT_SA_DETAIL_T B</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L5"><code class="language-sql"><span class="pln">          WHERE A</span><span class="pun">.</span><span class="pln">REEL_ID </span><span class="pun">=</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">REEL_ID</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L6"><code class="language-sql"><span class="pln">            AND A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L7"><code class="language-sql"><span class="pln">            AND A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">&lt;&gt;</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">REEL_QTY</span><span class="pun">)</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L8"><code class="language-sql"><span class="pln">  WHERE EXISTS </span><span class="pun">(</span><span class="pln">SELECT </span><span class="lit">1</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L9"><code class="language-sql"><span class="pln">           FROM SFISM4</span><span class="pun">.</span><span class="pln">R_MMS_STOCK_SMT_SA_DETAIL_T B</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L0"><code class="language-sql"><span class="pln">          WHERE A</span><span class="pun">.</span><span class="pln">REEL_ID </span><span class="pun">=</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">REEL_ID</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L1"><code class="language-sql"><span class="pln">            AND A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span></code></li><li style="list-style-type: none; padding-left: 0px;" class="L2"><code class="language-sql"><span class="pln">            AND A</span><span class="pun">.</span><span class="pln">REMAIN_QTY </span><span class="pun">&lt;&gt;</span><span class="pln"> B</span><span class="pun">.</span><span class="pln">REEL_QTY</span><span class="pun">);</span><span class="pln">  </span></code></li></ol></pre></div><div><br></div></div><div>最后是引用比较好的说明如下, 进行标注: 原文网址:&nbsp;<a href="http://www.blogjava.net/Jhonney/archive/2010/06/25/324503.html" style="font-size: 10.5pt; line-height: 1.5;">http://www.blogjava.net/Jhonney/archive/2010/06/25/324503.html</a></div><div><br></div><div><p style="margin: 0px 0px 14px; font-family: Arial; background-color: rgb(255, 255, 255);">SQL&gt; select * from wwm2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --要更新的表 , <font color="#ff0000">多一点.&nbsp;</font></p><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>222&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222<br>111&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>ww'jj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>llll&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1111<br>dddd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2222<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>dsafdf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>3435&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>ljjjjj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222<br>dsafdf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>3435&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>ljjjjj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);"><br>SQL&gt; select * from wwm5;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --更新的条件表 , <font color="#ff0000">少一点</font></div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>test&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9984</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">SQL&gt; select wwm2.* from wwm2,wwm5 where wwm2.id=wwm5.id<br>&nbsp; 2&nbsp; /</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>111&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>ww'jj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>dsafdf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>3435&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>dsafdf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>3435&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">8 rows selected.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);"><font color="#ff0000">所以,每次需要更新8条数据就是正确的. 这一步是验证更新是不是对, 错的关键.!!!</font></div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">相信程序员是通过以下类似的SQL更新的,这是<font color="#ff0000">错误</font>的,因为没有加<font color="#ff0000">WHERE</font><br>SQL&gt;&nbsp; update wwm2 set wwm2.town=(select wwm5.town from wwm5 where wwm5.id=wwm2.id)<br>&nbsp; 2&nbsp; /</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">13 rows updated.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">SQL&gt; select * from wwm2;</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1111<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2222<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222<br>13 rows selected.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">可以看到13条记录被更新<font color="#ff0000">,符合条件的更新正确,不符合条件的也更新为NULL.以下是正确的方法</font></div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">方法一:<br>SQL&gt; update wwm2<br>&nbsp; 2&nbsp; set town=(select town from wwm5 where wwm5.id=wwm2.id)<br>&nbsp; 3&nbsp;<font color="#ff0000"> where id</font>=(select wwm5.id from wwm5 where wwm5.id=wwm2.id)<br>&nbsp; 4&nbsp; /</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">8 rows updated.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">方法二:&nbsp;&nbsp;&nbsp; 与方法一道理相同,这里需要掌握EXIST的相关用法.<br>SQL&gt; update <font color="#ff0000">wwm2</font><br>&nbsp;&nbsp; set town=(select town from wwm5 where <font color="#ff0000">wwm5.id=wwm2.id)</font><br>&nbsp;&nbsp; w<font color="#ff0000">here exists</font> (select 1 from wwm5 where<font color="#ff0000"> wwm5.id=wwm2.id)</font><br>8 rows updated.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">方法三:<br>SQL&gt; update (select a.town atown,a.id aid,b.town btown,b.id bid from wwm2 a,wwm5 b where a.id=b.id)<br>&nbsp; 2&nbsp; set atown=btown<br>&nbsp; 3&nbsp; /<br>set atown=btown<br>&nbsp;&nbsp;&nbsp; *<br>ERROR at line 2:<br>ORA-01779: <font color="#ff0000"><u>cannot modify a column which maps to a non key-preserved table</u></font></div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">&nbsp; 1* <font color="#ff0000">alter table wwm5 add primary key (id)</font><br>SQL&gt; /</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">Table altered.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">&nbsp; 1&nbsp; update (select <font color="#ff0000">a.town </font><font color="#ff00ff">atown</font><font color="#ff0000">,a.id</font><font color="#ff00ff"> aid</font><font color="#ff0000">,b.town </font><font color="#ff00ff">btown</font><font color="#ff0000">,b.id </font><font color="#ff00ff">bid</font> from<font color="#ff00ff"> wwm2 a,wwm5 b</font> where a.id=b.id) -- <font color="#ff0000">表连接之后, 更新视图的方式很好理解. 但是需要primary key.</font><br>&nbsp; 2*&nbsp; set atown=btown<br>SQL&gt; /</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">8 rows updated.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);"><font color="#ff0000">这种方法的局限性就是需要PRIMARY 的支持</font>.<font color="#ff0000">! 需要 更新被更新</font><font color="#ff00ff">表有主键, 连接栏位是不是需要呢&gt;?&nbsp;</font></div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">方法四: --<font color="#ff0000">万金油. 但是数据库顾问说效能没有使用表连接好.</font><br>&nbsp; 1&nbsp; declare<br>&nbsp; 2&nbsp; cursor<font color="#ff00ff"> cur_wwm</font> is select town,id from wwm5; -- 驱动 表<br>&nbsp; 3&nbsp; begin<br>&nbsp; 4&nbsp;&nbsp;&nbsp;&nbsp; for <font color="#ff00ff">my_wwm</font> in <font color="#ff00ff">cur_wwm</font> loop<br>&nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp; update wwm2 set town=my_wwm.town -- 被驱动表.<br>&nbsp; 6&nbsp;&nbsp;&nbsp;&nbsp; where id=my_wwm.id;<br>&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ff00ff">end loop;</font><br>&nbsp; 8* <font color="#ff00ff">end;</font><br>SQL&gt; /</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">PL/SQL procedure successfully completed.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">SQL&gt; select * from wwm2;</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>222&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>llll&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1111<br>dddd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2222<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>ljjjjj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>ljjjjj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">这个方法是最灵活的了.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">方法五:</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">注意<font color="#ff00ff">,方法五只能适用于WWM5是WWM2的子集的时候. (新特性 merge Into,哎呀! 不想学.....)</font><br>&nbsp; 1&nbsp;&nbsp; merge into wwm2<br>&nbsp; 2&nbsp;&nbsp; using (select town,id from wwm5) b<br>&nbsp; 3&nbsp;&nbsp; on (wwm2.id=b.id)<br>&nbsp; 4&nbsp;&nbsp; when matched then update set town=b.town<br>&nbsp; 5* when not matched then insert (town,id) values (null,null)<br>SQL&gt; /</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">9 rows merged.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">SQL&gt; select * from wwm2;</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ---注意这个地方,被插入了一个空值.因为WWM5的ID=9984在WWM2中不能匹配,根本原因是ORACLE9必须有WHEN NOT MATCHED子句,但是ORACLE10可以不许要,也就是ORACLE10可以不写WHEN NOT MATCHED ,就不必插入NULL值了,为解决这个问题,下一步会DELETE WWM5的ID=9984,这样一来就不会执行WHEN NOT MATCHED<br>222&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>llll&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1111<br>dddd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2222<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>ljjjjj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">TOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br>-------------------- ----------<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>lllldf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 111<br>ljjjjj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 222</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">14 rows selected.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">SQL&gt; delete from wwm5 where id=9984;</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">1 row deleted.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">SQL&gt;&nbsp; 1&nbsp;&nbsp; merge into wwm2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>SQL&gt;&nbsp;&nbsp; 2&nbsp;&nbsp; using (select town,id from wwm5) b<br>SQL&gt;&nbsp;&nbsp; 3&nbsp;&nbsp; on (wwm2.id=b.id)<br>SQL&gt;&nbsp;&nbsp; 4&nbsp;&nbsp; when matched then update set town=b.town<br>SQL&gt;&nbsp;&nbsp; 5* when not matched then insert (town,id) values (null,null)<br>SQL&gt; /</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">8 rows merged.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">&nbsp;</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以上就是5种关连更新的例子了,希望能给开发人员解惑.</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);">&nbsp;</div><div style="font-family: Arial; background-color: rgb(255, 255, 255);"><strong>说明：如果select 子句可以返回多行记录，但返回适合where条件的记录只能是唯一的，否则将会报返回单行的select子句返回多行的错误，因为update只能跟据此处的where子句（内层where)进行相应记录的匹配更新，一次只能是一条。</strong></div></div><div><font face="Microsoft YaHei UI">&nbsp; &nbsp;&nbsp;</font><br></div>
</body></html>