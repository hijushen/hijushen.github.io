<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>pl/sql编程</title><?xml version="1.0" encoding="UTF-8"?>


<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="margin: 0px 0px 10em; padding: 0px; border: 0px; font-family: 微软雅黑, Tahoma; font-size: 12px; background-color: rgb(243, 241, 240);"><h1 style="margin: 108px 0px 24px; padding: 0px; font-size: 30px; word-break: break-all; font-weight: normal;">pl/sql编程</h1><div style="margin: 0px; padding: 0px; border: 0px; font-size: 16px; line-height: 1.6em;"><div style="margin: 32px 0px 0px; padding: 0px; border: 0px;"><div style="margin: 0px 0px 10em; padding: 0px; border: 0px; font-size: 12px; line-height: normal;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: 16px; line-height: 1.6em;"><div style="margin: 32px 0px 0px; padding: 0px; border: 0px;"><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">一、什么是pl/sql</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pl/sql（procedural language/sql）是Oracle在标准的sql语言上的扩展，pl/sql不仅允许嵌入Sql语言，还可以定义变量和常量，允许使用条件语句和循环语句，允许使用例外处理各种错误，这样使得它的功能变得更加强大。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">二、pl/sql学习的必要性</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、提高应用程序的运行性能。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、模块化的设计思想。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、减少网络传输量。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">4、提高安全性。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">三、编写规范</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">单行注释--</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;select * from emp where empno=7788; --取得员工信息</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">/*....................*/</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、标识符号的命名规范</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）当定义变量时，建议用v_作为前缀 v_sal。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）当定义常量时，建议用c_作为前缀 c_rate。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）当定义游标时，建议用_cursor作为后缀emp_cursor。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（4）当定义例外时，建议用e_作为前缀 e_error。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">块（block）是pl/sql的基本程序单元，编写pl/sql程序实际上 就是编写pl/sql块。要完成相对简单的应用功能，可能只需要编写一个pl/sql快；但是如果想要实现复杂的功能，可能需要在一个pl/sql块中嵌套其他的pl/sql快。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、块结构示意图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pl/sql块由三个部分构成：定义部分、执行部分、例外处理部分。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declear：定义部分是从declare开始的，这部分是可选的。定义常量、变量、游标例外、复杂数据类型。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin：执行部分是从begin开始的，这部分是必须的。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception：例外处理部分是exception开始的，该部分可选的。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、包含定义部分和执行部分的pl/sql块</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(5); --定义字符串变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename int o v_ename from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;雇员名：&#39; || v_ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">相关说明：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">&amp; 表示要接收从控制台输入的变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、包含定义部分、执行部分和例外处理部分</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">为了避免pl/sql程序的运行错误，提高pl/sql的健壮性，应该对可能的错误今夕处理，这个很有必要。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(5); --定义字符串变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename int o v_ename from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;雇员名：&#39; || v_ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when no_data_found then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;输入有误&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">过程用于执行特定的操作，当建立过程时，即可以指定输入参数（in），也可以指定输出参数（out），通过在过程中使用输入参数，可以将数据传递到执行部分，通过使用输出参数，可以将执行部分的数据传递到应用环境。在sqlplus中可以使用create procedure命令来建立过程。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">请考虑编写一个过程，可以输入雇员们，新工资，可修改雇员的工资。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure Update_Sal(spName varchar2,new sal number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal = newSal where ename = spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">如何调用过程有两种方法：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、exec Update_Sa(&#39;Scott&#39;,4678);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、call Update_Sal&#39;Scott&#39;,4567);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">函数用于返回特定的数据，当建立函数时，在函数头部必须包含return子句，而在函数体内必须包含return语句返回的数据，我们可以使用create function 来建立函数。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create function annual_income(name varchar2)</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">return numeber is annual_salary number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal*12+nvl(comm,0)*12 into annual_salary from emp where ename=name;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">return annual_salary;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在sqlplus中调用函数</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;var income number</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;call annual_income(&#39;SCOTT&#39;) into: income;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;print income;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">包用于在逻辑上组合过程和函数，它由包规范和包体两部分组成</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、我们可以使用create package命令来创建包。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create package sp_package as</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">procedure update_sal(name varchar2,new sal number);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">function annual_income(name varchar2) return number;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">包的规范只包含了过程和函数的说明，但是没有过程和函数的实现代码。包体用于实现包规范中的过程和函数。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、建立包体可以使用create package body命令</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create package body sp_package as</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">procedure Update_Sal(spName varchar2,new sal number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal = newSal where ename = spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">function annual_income(name varchar2)</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">return numeber is annual_salary number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal*12+nvl(comm,0)*12 into annual_salary from emp where ename=name;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">return annual_salary;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、如何调用包的过程或是函数</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当调用包的过程或是函数时，在过程和函数前需要带有包名，如果要访问其他方案的包，还需要在包名前加方案名。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;call sp_package.update_sal(&#39;SCOTT&#39;,1500);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">八、定义并使用变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：在编写pl/sql程序时，可以定义变量和常量。在pl/sql程序中包括有标量类型（scalar）、复合类型（composite）、参照类型（references）、lob（large object）。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、标量（scalar）</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在编写pl/sql块时，如果要使用变量，需要在定义部分定义变量。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pl/sql中定义变量和常量的语法如下：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">identifier [constant] datatype [not null] [:=| default expr]</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">identifier：名称</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">constant：指定常量。需要指定它的初始值，其其值是不能改变的。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">datatype：数据类型</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">not null：指定变量值不能为NULL</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">:=：给变量或是常量指定初始值</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">default：用于指定初始值</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">expr：指定初始值pl/sql表达式，可是文本值、其他变量、函数等。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">标量定义的案例</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）定义一个变长字符串</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(10);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）定义一个小数，范围-9999.99～9999.99</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal number(6,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）定义一个小数并给一个初始值为5.4 :=是pl/sql的赋值号</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal2 number(6,2):=5.3;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（4）定义一个日期类型的数据</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_hiredate date;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（5）定义一个布尔变量，不能为空，初始值为false</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_valid boolean not null default false;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、使用标量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在定义好变量后，就可以使用这些变量。这里需要 说明的是pl/sql块为变量赋值不同于其他的编程语言，需要在等号前面加冒号（:=）。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">下面以输入员工号，显示雇员姓名、工资、个人所得税（税率为0.03）为例，说明变量的使用，看看如何编写。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">c_tax_rate number(3,2):=0.03;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(5);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_tax number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename,sal into v_ename,v_sal from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_tax:=v_sal*c_tax_rate;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;姓名是：&#39;||v_ename||&#39; 工资是：&#39;||v_sal||&#39; 所得税是：&#39;||v_tax);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、使用%type类型</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">对于上面的pl/sql块有一个问题：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">就是如果员工的姓名超过了5字符的话，就会有错误，为了降低pl/sql程序的维护工作量，可以使用%type属性定义变量，这样它会按照数据库列来确定你定义的变量的类型和长度。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">语法：标识符名 表名.列名%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declear</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">c_tax_rate number(3,2):=0.03;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename emp.ename%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_tax number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename,sal into v_ename,v_sal from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_tax:=v_sal*c_tax_rate;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;姓名是：&#39;||v_ename||&#39; 工资是：&#39;||v_sal||&#39; 所得税是：&#39;||v_tax);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、复合变量（composite）</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">用于存储多个值的变量。主要包括这几种pl/sql记录、pl/sql表、嵌套表、varray。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、pl/sql记录</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">类似于高级语言中的结构体，需要注意的是，当引用pl/sql记录成员时，必须要加记录变量作为前缀（记录变量.记录成员）。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">type emp_record_type is record(name emp.ename%type, salary emp.sal%type,title emp.job%type);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_record emp_record_type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename,sal,job into sp_record from emp where empno=7788;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;员工名：&#39;||sp_record.name);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、pl/sql表</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">相当于高级语言中的数组，但是需要注意的是在高级语言中数组的下标不能为负数，而pl/sql是可以为负数的，并且表元素的下标没有限制。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">type sp_table_type is table of emp.ename%type index by binary_integer;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_table sp_table_type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename into sp_table(0) from emp where empno=7788;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;员工名：&#39;||sp_table(0));</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_table_type：是pl/sql表类型</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">emp.ename%type：指定了表的元素的类型和长度</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_table：是pl/sql表变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_table(0)：表示下标为0的元素</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、参照变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：参照变量是指用于存放数值指针的变量，通过使用参照变量，可以使得应用程序共享相同对象，从而降低占用空间。在编写pl/sql程序时，可以使用游标变量(ref cursor)和对象类型变量（ref obj_type）两种参照变量类型。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、游标变量（ref cursor）</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">使用游标时，当定义游标时不需要指定相应的select语句，但是当使用游标时（open时）需要指定select语句，这样一个游标就与一个select 语句结合了。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">请使用pl/sql编写一个块，可以输入部门号，并显示该部门所有员工姓名和他的工资</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">type sp_emp_cursor is ref cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">test_cursor sp_emp_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename emp.ename%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">opent test_cursor for select ename,sal from emp where deptno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">fetch test_cursor into v_ename,v_sal;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exit when test_cursor%notfound</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.putline(&#39;姓名：&#39;||v_ename||&#39; 工资：&#39;||v_sal);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">endloop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">close test_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">九、控制结构</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：在任何计算机语言（C、Java、Pascal）都有各种控制语句（条件语句、循环结构、顺序控制结构），在pl/sql中也存在这样的控制结构。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、条件分支语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pl/sql中提供了三种条件分支语句。if-then、if-then-else、if-then-elsif-else。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）简单的条件判断if-then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程，可以输入一个雇员名，如果该雇员的工资低于2000，就给该雇员工资增加10%。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure IncreaseSal(spName varchar2) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal into v_sal from emp where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if v_sal&lt;2000 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp sal=sal+sal*10% where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）二重条件分支if-then-else</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程，可以输入一个雇员名，如果该雇员的补助不是0，就在原来的基础上增加100；如果补助为0就把补助设为200。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure IncreaseComm(spName varchar2) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_comm emp.comm%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select comm into v_comm from emp where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if v_comm&lt;&gt;0 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set comm=comm+100 where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set comm=200 where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）多重条件分支if-then-elsif-else</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程，可以输入一个雇员编号，如果该雇员的职位是PRESIDENT就给他的工资增加1000，如果该雇员的职位是MANAGER就给他的工资增加500，其他职位的雇员工资增加200。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure IncreaseSal(spNo number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_job emp.job%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select job into v_job from emp where empno=spNo;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if v_job=&#39;PRESIDENT&#39; then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+1000 where empno=spNo;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">elsif v_job=&#39;MANAGER&#39;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+500 where empno=spNo;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+200 where empno=spNo;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、循环语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）基本循环</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">loop是pl/sql中最简单的循环语句，这种循环语句以loop开头，以end loop结尾，这种循环至少会被执行一次。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程，可输入用户名，并循环添加10个用户到Users表中，用户编号从1开始增加。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure AddUser(spName varchar2) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_num number(2):=1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">insert into Users values(v_num,spName);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exit when v_num=10;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_num:=v_num+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">endloop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）While循环</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">基本循环至少要执行循环体一次，而对于while循环来说，只有条件为true时，才会执行循环体语句，while循环以while 条件 loop开始，以end loop结束。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">编写一个过程，可输入用户名，并循环添加10个用户到Users表中，用户编号从11开始增加</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure AddUser(spName varchar2) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_num number(3):=11;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">while v_num&lt;=20 loop</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">insert into Users values(v_num,spName);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_num:=v_num+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">endloop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）for循环</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">基本for循环的基本结构如下</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">for i in reverse 1..10 loop</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">insert into Users values(i,&#39;Kevin&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end loop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、顺序控制语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）goto语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">goto语句用于跳转到特定标号去执行有车，注意由于使用goto语句会增加程序的复杂度，并使得应用程序可读性变差，所以在一般应用开发时，建议大家不要使用goto语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">基本语法如下：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">goto label：其中label是已经定义好的标号名。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">i number(4):=1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&quot;输出i=&#39;||i&quot;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if i=10 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">goto end_loop</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">i:=i+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">endloop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">&lt;&lt;end_loop&gt;&gt;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&quot;循环结束&quot;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）null</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">null语句不会执行任何操作，并且会直接将控制传递到下一条语句。使用null语句的主要好处是可以提高pl/sql的可读性。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal into v_sal from emp where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if v_sal&lt;2000 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp sal=sal+sal*10% where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">null;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">十、编写分页过程</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：分页时任何一个网站（bbs、网上商城、Blog）都会使用到的技术，因此学习pl/sql编程开发就一定要掌握该技术。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程完成分页。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">--创建一个包，存放游标。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create package ListPackage as</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">type page_cursor is ref cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">--开始编写分页的过程</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure PagedList(</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">tableName in varchar2, --要查询的表名</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sortColumn in varchar2, --欲排序的列名</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pagesize in number, --每页显示的记录数</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">currentPage in number, --当前页号</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myRowCount out number, --表中总共的记录数</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myPageCount out number, --共有多少页</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">p_cursor out ListPackage.page_cursor --游标变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sql varchar2(1000);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_begin number:=(currentPage-1)*pagesize+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_end number:=currentPage*pagesize;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sql:=&#39;select * from(select *, rownum rn from (select * from &#39;||tableName||&#39; order by &#39;||sortColumn||&#39;) t1 where rownum&lt;=&#39;||v_end||&#39;) where rn&gt;=&#39;||v_begin;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">open p_cursor for v_sql;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">--计算myRowCount和myPageCount</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sql:=&#39;select count(*) from &#39;||tableName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">execute immediate v_sql into myRowCount;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if mod(myRowCount,pagesize)=0 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myPageCount:=myRowCount/pagesize;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myPageCount:=myRowCount/pagesize+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">close p_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">十一、例外处理</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、例外的分类</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">Oracle将例外分为预定义例外、非预定义例外和自定义例外三种。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">预定义例外：用于处理常见的Oracle错误。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">非预定义例外：用于处理预定义例外不能处理的例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">自定义例外：用于处理与Oracle错误无关的其他情况。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、处理预定义例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">预定义例外时由pl/sql所提供的系统例外。当pl/sql应用程序违反了Oracle规定的限制时，则会隐含的触发一个内部例外。pl/sql为开发人员提供了二十多个预定义例外。我们给大家介绍常用的例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）预定义例外case_not_found</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在开发pl/sql块中编写case语句时，如果在when子句中没有包含必须的条件分支，就会触发case_not_found的例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure sp_pro6(spno number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal into v_sal from emp where empno=spno;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when v_sal&lt;1000 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+100 where empno=spno;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when v_sal&lt;2000 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+200 where empno=spno;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end case;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when case_not_found then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;case语句没有与&#39;||v_sal||&#39;相匹配的条件&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）预定义例外cursor_already_open</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当从新打开已经打开的游标时，会隐含的触发例外cursor_already_open。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">cursor emp_cursor is select ename,sal from emp;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">open emp_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">for emp_record1 in emp_cursor loop</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(emp_record1.ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end loop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when cursor_already_open then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;游标已经打开&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）预定义例外dup_val_on_index</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在唯一索引所对应的列上插入重复的值时，会隐含的触发例外dup_val_on_index例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">insert into dept values(10.&#39;公关部&#39;,&#39;北京&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when dup_val_on_index then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;在deptno列上不能出现重复值&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（4）预定义例外invalid_cursor</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当试图在不合法的游标上执行操作时，会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">例如：视图从没有打开的游标提取数据，或是关闭没有打开的游标。则会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">cursor emp_cursor is select ename,sal from emp;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">emp_record emp_cursor%rowtype;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">fetch emp_cursor into emp_record;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(emp_record.ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">close emp_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when invalid_cursor then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;请检查游标是否打开&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（5）预定义例外invalid_number</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当输入的数据有误时，会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：数字100写成了1oo就会触发该例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+&#39;1oo&#39;;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when invalid_number then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;输入数字不正确&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（6）预定义例外no_data_found</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">下面是一个pl/sql块，当执行select into没有返回行，就会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal into v_sal from emp where ename=&#39;&amp;name&#39;;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when no_data_found then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;不存在该员工&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（7）预定义例外too_many_rows</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当执行select into语句时，如果返回超过了一行，则会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename emp.ename%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename into v_ename from emp;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when too_many_rows then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;返回了多行&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（8）预定义例外zero_divide</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当执行除0操作时，则会触发给例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（9）预定义例外value_error</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当在执行赋值操作时，如果变量的长度不足以容纳实际数据，则会触发该例外value_error。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(5);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename into v_ename from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(v_ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when value_error then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;变量尺寸不足&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（10）其它预定义例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、login_denide</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当用户非法登录时，会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、not_logged_on</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">如果用户没有登录就执行dml操作，就会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">C、storage_error</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">如果超出了内存空间或是内存被损坏，就触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">D、timeout_on_resourece</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">如果Oracle在等待资源时，出现超时就触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、非预定义例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">非预定义例外用于处理与预定义例外无关的Oracle错误，使用预定义例外只能处理21个Oracle错误，而当使用pl/sql开发应用程序时，可能会遇到其他的一些Oracle错误。比如在pl/sql快中执行dml语句时，违反了约束规定等等。在这样的情况下，也可以处理Oracle的各种例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">4、处理自定义例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">预定义例外和非预定义例外都是Oracle错误相关的，并且处在的Oracle错误会隐含的触发相应的例外。而自定义例外与Oracle错误没有任何关联，它是由开发人员为特定情况所定义的例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：请编写一个pl/sql块，接收一个雇员的编号，并给该雇员工资增加1000元，如果该雇员不存在请提示。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure IncreaseSal(spno number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myException exception;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+100 where empno=spno;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if sql%not_found then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">raise myException;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when myException then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;没有更新任何用户&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">十二、Oracle视图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：视图是一个虚拟表，其内容由查询定义，同真实表一样，视图包含一系列带有名称的列和行数据。但是，视图并不在数据库中以存储的数据值集形式存在，行和列数据来自有定义视图的查询所引用的表，并且在引用视图时动态生成。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、视图与表的区别</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、表需要占用磁盘空间，视图不需要。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、视图不能添加索引。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">C、使用视图可以简化复杂查询。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">D、视图有利于提高安全性。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、创建视图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create view 视图名 as select语句[with read only]</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、创建或修改视图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create or replace view 视图名 as select语句[with read only]</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">4、删除视图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">drop view 视图名</p></div></div></div><div style="margin: 0px auto; padding: 15px 0px 50px; border-top-width: 1px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: solid; border-top-color: rgb(221, 221, 221); font-family: Simsun, tahoma, &#39;Microsoft YaHei&#39;, &#39;Arial Unicode MS&#39;, Mingliu, Arial, Helvetica; color: rgb(148, 145, 143); font-size: 12px; line-height: normal;"><div style="margin: 0px; padding: 0px; border: 0px;">收藏于 2013-12-16</div><div style="margin: 10px 0px 0px; padding: 0px; border: 0px; clear: both;"><a href="http://www.cnblogs.com/BeautyOfCode/archive/2010/09/28/1837240.html" style="text-decoration: none; color: rgb(25, 142, 216);" target="_blank">http://www.cnblogs.com/BeautyOfCode/archive/2010/09/28/1837240.html</a></div></div><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;"><span style="color: rgb(148, 145, 143); font-family: Simsun, tahoma, &#39;Microsoft YaHei&#39;, &#39;Arial Unicode MS&#39;, Mingliu, Arial, Helvetica; font-size: 12px; line-height: normal;">文章优化有问题？</span><a href="http://qingting.baidu.com/index?pid=26" style="font-family: Simsun, tahoma, &#39;Microsoft YaHei&#39;, &#39;Arial Unicode MS&#39;, Mingliu, Arial, Helvetica; font-size: 12px; line-height: normal; text-decoration: none; color: rgb(25, 142, 216);" target="_blank">点击这里</a><span style="color: rgb(148, 145, 143); font-family: Simsun, tahoma, &#39;Microsoft YaHei&#39;, &#39;Arial Unicode MS&#39;, Mingliu, Arial, Helvetica; font-size: 12px; line-height: normal;">反馈URL给我们</span>么是pl/sql</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pl/sql（procedural language/sql）是Oracle在标准的sql语言上的扩展，pl/sql不仅允许嵌入Sql语言，还可以定义变量和常量，允许使用条件语句和循环语句，允许使用例外处理各种错误，这样使得它的功能变得更加强大。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">二、pl/sql学习的必要性</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、提高应用程序的运行性能。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、模块化的设计思想。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、减少网络传输量。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">4、提高安全性。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">三、编写规范</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">单行注释--</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;select * from emp where empno=7788; --取得员工信息</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">/*....................*/</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、标识符号的命名规范</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）当定义变量时，建议用v_作为前缀 v_sal。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）当定义常量时，建议用c_作为前缀 c_rate。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）当定义游标时，建议用_cursor作为后缀emp_cursor。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（4）当定义例外时，建议用e_作为前缀 e_error。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">块（block）是pl/sql的基本程序单元，编写pl/sql程序实际上 就是编写pl/sql块。要完成相对简单的应用功能，可能只需要编写一个pl/sql快；但是如果想要实现复杂的功能，可能需要在一个pl/sql块中嵌套其他的pl/sql快。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、块结构示意图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pl/sql块由三个部分构成：定义部分、执行部分、例外处理部分。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declear：定义部分是从declare开始的，这部分是可选的。定义常量、变量、游标例外、复杂数据类型。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin：执行部分是从begin开始的，这部分是必须的。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception：例外处理部分是exception开始的，该部分可选的。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、包含定义部分和执行部分的pl/sql块</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(5); --定义字符串变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename int o v_ename from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;雇员名：&#39; || v_ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">相关说明：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">&amp; 表示要接收从控制台输入的变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、包含定义部分、执行部分和例外处理部分</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">为了避免pl/sql程序的运行错误，提高pl/sql的健壮性，应该对可能的错误今夕处理，这个很有必要。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(5); --定义字符串变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename int o v_ename from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;雇员名：&#39; || v_ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when no_data_found then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;输入有误&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">过程用于执行特定的操作，当建立过程时，即可以指定输入参数（in），也可以指定输出参数（out），通过在过程中使用输入参数，可以将数据传递到执行部分，通过使用输出参数，可以将执行部分的数据传递到应用环境。在sqlplus中可以使用create procedure命令来建立过程。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">请考虑编写一个过程，可以输入雇员们，新工资，可修改雇员的工资。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure Update_Sal(spName varchar2,new sal number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal = newSal where ename = spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">如何调用过程有两种方法：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、exec Update_Sa(&#39;Scott&#39;,4678);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、call Update_Sal&#39;Scott&#39;,4567);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">函数用于返回特定的数据，当建立函数时，在函数头部必须包含return子句，而在函数体内必须包含return语句返回的数据，我们可以使用create function 来建立函数。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create function annual_income(name varchar2)</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">return numeber is annual_salary number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal*12+nvl(comm,0)*12 into annual_salary from emp where ename=name;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">return annual_salary;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在sqlplus中调用函数</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;var income number</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;call annual_income(&#39;SCOTT&#39;) into: income;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;print income;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">包用于在逻辑上组合过程和函数，它由包规范和包体两部分组成</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、我们可以使用create package命令来创建包。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create package sp_package as</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">procedure update_sal(name varchar2,new sal number);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">function annual_income(name varchar2) return number;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">包的规范只包含了过程和函数的说明，但是没有过程和函数的实现代码。包体用于实现包规范中的过程和函数。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、建立包体可以使用create package body命令</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create package body sp_package as</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">procedure Update_Sal(spName varchar2,new sal number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal = newSal where ename = spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">function annual_income(name varchar2)</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">return numeber is annual_salary number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal*12+nvl(comm,0)*12 into annual_salary from emp where ename=name;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">return annual_salary;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、如何调用包的过程或是函数</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当调用包的过程或是函数时，在过程和函数前需要带有包名，如果要访问其他方案的包，还需要在包名前加方案名。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sql&gt;call sp_package.update_sal(&#39;SCOTT&#39;,1500);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">八、定义并使用变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：在编写pl/sql程序时，可以定义变量和常量。在pl/sql程序中包括有标量类型（scalar）、复合类型（composite）、参照类型（references）、lob（large object）。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、标量（scalar）</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在编写pl/sql块时，如果要使用变量，需要在定义部分定义变量。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pl/sql中定义变量和常量的语法如下：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">identifier [constant] datatype [not null] [:=| default expr]</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">identifier：名称</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">constant：指定常量。需要指定它的初始值，其其值是不能改变的。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">datatype：数据类型</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">not null：指定变量值不能为NULL</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">:=：给变量或是常量指定初始值</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">default：用于指定初始值</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">expr：指定初始值pl/sql表达式，可是文本值、其他变量、函数等。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">标量定义的案例</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）定义一个变长字符串</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(10);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）定义一个小数，范围-9999.99～9999.99</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal number(6,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）定义一个小数并给一个初始值为5.4 :=是pl/sql的赋值号</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal2 number(6,2):=5.3;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（4）定义一个日期类型的数据</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_hiredate date;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（5）定义一个布尔变量，不能为空，初始值为false</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_valid boolean not null default false;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、使用标量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在定义好变量后，就可以使用这些变量。这里需要 说明的是pl/sql块为变量赋值不同于其他的编程语言，需要在等号前面加冒号（:=）。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">下面以输入员工号，显示雇员姓名、工资、个人所得税（税率为0.03）为例，说明变量的使用，看看如何编写。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">c_tax_rate number(3,2):=0.03;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(5);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_tax number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename,sal into v_ename,v_sal from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_tax:=v_sal*c_tax_rate;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;姓名是：&#39;||v_ename||&#39; 工资是：&#39;||v_sal||&#39; 所得税是：&#39;||v_tax);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、使用%type类型</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">对于上面的pl/sql块有一个问题：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">就是如果员工的姓名超过了5字符的话，就会有错误，为了降低pl/sql程序的维护工作量，可以使用%type属性定义变量，这样它会按照数据库列来确定你定义的变量的类型和长度。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">语法：标识符名 表名.列名%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declear</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">c_tax_rate number(3,2):=0.03;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename emp.ename%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_tax number(7,2);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename,sal into v_ename,v_sal from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_tax:=v_sal*c_tax_rate;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;姓名是：&#39;||v_ename||&#39; 工资是：&#39;||v_sal||&#39; 所得税是：&#39;||v_tax);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、复合变量（composite）</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">用于存储多个值的变量。主要包括这几种pl/sql记录、pl/sql表、嵌套表、varray。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、pl/sql记录</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">类似于高级语言中的结构体，需要注意的是，当引用pl/sql记录成员时，必须要加记录变量作为前缀（记录变量.记录成员）。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">type emp_record_type is record(name emp.ename%type, salary emp.sal%type,title emp.job%type);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_record emp_record_type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename,sal,job into sp_record from emp where empno=7788;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;员工名：&#39;||sp_record.name);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、pl/sql表</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">相当于高级语言中的数组，但是需要注意的是在高级语言中数组的下标不能为负数，而pl/sql是可以为负数的，并且表元素的下标没有限制。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">type sp_table_type is table of emp.ename%type index by binary_integer;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_table sp_table_type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename into sp_table(0) from emp where empno=7788;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;员工名：&#39;||sp_table(0));</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_table_type：是pl/sql表类型</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">emp.ename%type：指定了表的元素的类型和长度</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_table：是pl/sql表变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sp_table(0)：表示下标为0的元素</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、参照变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：参照变量是指用于存放数值指针的变量，通过使用参照变量，可以使得应用程序共享相同对象，从而降低占用空间。在编写pl/sql程序时，可以使用游标变量(ref cursor)和对象类型变量（ref obj_type）两种参照变量类型。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、游标变量（ref cursor）</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">使用游标时，当定义游标时不需要指定相应的select语句，但是当使用游标时（open时）需要指定select语句，这样一个游标就与一个select 语句结合了。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">请使用pl/sql编写一个块，可以输入部门号，并显示该部门所有员工姓名和他的工资</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">type sp_emp_cursor is ref cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">test_cursor sp_emp_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename emp.ename%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">opent test_cursor for select ename,sal from emp where deptno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">fetch test_cursor into v_ename,v_sal;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exit when test_cursor%notfound</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.putline(&#39;姓名：&#39;||v_ename||&#39; 工资：&#39;||v_sal);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">endloop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">close test_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">九、控制结构</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：在任何计算机语言（C、Java、Pascal）都有各种控制语句（条件语句、循环结构、顺序控制结构），在pl/sql中也存在这样的控制结构。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、条件分支语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pl/sql中提供了三种条件分支语句。if-then、if-then-else、if-then-elsif-else。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）简单的条件判断if-then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程，可以输入一个雇员名，如果该雇员的工资低于2000，就给该雇员工资增加10%。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure IncreaseSal(spName varchar2) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal into v_sal from emp where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if v_sal&lt;2000 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp sal=sal+sal*10% where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）二重条件分支if-then-else</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程，可以输入一个雇员名，如果该雇员的补助不是0，就在原来的基础上增加100；如果补助为0就把补助设为200。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure IncreaseComm(spName varchar2) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_comm emp.comm%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select comm into v_comm from emp where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if v_comm&lt;&gt;0 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set comm=comm+100 where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set comm=200 where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）多重条件分支if-then-elsif-else</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程，可以输入一个雇员编号，如果该雇员的职位是PRESIDENT就给他的工资增加1000，如果该雇员的职位是MANAGER就给他的工资增加500，其他职位的雇员工资增加200。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure IncreaseSal(spNo number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_job emp.job%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select job into v_job from emp where empno=spNo;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if v_job=&#39;PRESIDENT&#39; then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+1000 where empno=spNo;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">elsif v_job=&#39;MANAGER&#39;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+500 where empno=spNo;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+200 where empno=spNo;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、循环语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）基本循环</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">loop是pl/sql中最简单的循环语句，这种循环语句以loop开头，以end loop结尾，这种循环至少会被执行一次。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程，可输入用户名，并循环添加10个用户到Users表中，用户编号从1开始增加。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure AddUser(spName varchar2) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_num number(2):=1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">insert into Users values(v_num,spName);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exit when v_num=10;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_num:=v_num+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">endloop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）While循环</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">基本循环至少要执行循环体一次，而对于while循环来说，只有条件为true时，才会执行循环体语句，while循环以while 条件 loop开始，以end loop结束。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">编写一个过程，可输入用户名，并循环添加10个用户到Users表中，用户编号从11开始增加</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure AddUser(spName varchar2) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_num number(3):=11;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">while v_num&lt;=20 loop</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">insert into Users values(v_num,spName);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_num:=v_num+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">endloop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）for循环</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">基本for循环的基本结构如下</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">for i in reverse 1..10 loop</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">insert into Users values(i,&#39;Kevin&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end loop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、顺序控制语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）goto语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">goto语句用于跳转到特定标号去执行有车，注意由于使用goto语句会增加程序的复杂度，并使得应用程序可读性变差，所以在一般应用开发时，建议大家不要使用goto语句</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">基本语法如下：</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">goto label：其中label是已经定义好的标号名。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">i number(4):=1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&quot;输出i=&#39;||i&quot;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if i=10 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">goto end_loop</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">i:=i+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">endloop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">&lt;&lt;end_loop&gt;&gt;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&quot;循环结束&quot;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）null</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">null语句不会执行任何操作，并且会直接将控制传递到下一条语句。使用null语句的主要好处是可以提高pl/sql的可读性。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal into v_sal from emp where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if v_sal&lt;2000 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp sal=sal+sal*10% where ename=spName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">null;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">十、编写分页过程</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：分页时任何一个网站（bbs、网上商城、Blog）都会使用到的技术，因此学习pl/sql编程开发就一定要掌握该技术。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：编写一个过程完成分页。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">--创建一个包，存放游标。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create package ListPackage as</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">type page_cursor is ref cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">--开始编写分页的过程</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure PagedList(</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">tableName in varchar2, --要查询的表名</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">sortColumn in varchar2, --欲排序的列名</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">pagesize in number, --每页显示的记录数</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">currentPage in number, --当前页号</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myRowCount out number, --表中总共的记录数</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myPageCount out number, --共有多少页</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">p_cursor out ListPackage.page_cursor --游标变量</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sql varchar2(1000);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_begin number:=(currentPage-1)*pagesize+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_end number:=currentPage*pagesize;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sql:=&#39;select * from(select *, rownum rn from (select * from &#39;||tableName||&#39; order by &#39;||sortColumn||&#39;) t1 where rownum&lt;=&#39;||v_end||&#39;) where rn&gt;=&#39;||v_begin;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">open p_cursor for v_sql;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">--计算myRowCount和myPageCount</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sql:=&#39;select count(*) from &#39;||tableName;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">execute immediate v_sql into myRowCount;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if mod(myRowCount,pagesize)=0 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myPageCount:=myRowCount/pagesize;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myPageCount:=myRowCount/pagesize+1;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">close p_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">十一、例外处理</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、例外的分类</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">Oracle将例外分为预定义例外、非预定义例外和自定义例外三种。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">预定义例外：用于处理常见的Oracle错误。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">非预定义例外：用于处理预定义例外不能处理的例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">自定义例外：用于处理与Oracle错误无关的其他情况。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、处理预定义例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">预定义例外时由pl/sql所提供的系统例外。当pl/sql应用程序违反了Oracle规定的限制时，则会隐含的触发一个内部例外。pl/sql为开发人员提供了二十多个预定义例外。我们给大家介绍常用的例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（1）预定义例外case_not_found</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在开发pl/sql块中编写case语句时，如果在when子句中没有包含必须的条件分支，就会触发case_not_found的例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure sp_pro6(spno number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal into v_sal from emp where empno=spno;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when v_sal&lt;1000 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+100 where empno=spno;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when v_sal&lt;2000 then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+200 where empno=spno;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end case;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when case_not_found then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;case语句没有与&#39;||v_sal||&#39;相匹配的条件&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（2）预定义例外cursor_already_open</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当从新打开已经打开的游标时，会隐含的触发例外cursor_already_open。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">cursor emp_cursor is select ename,sal from emp;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">open emp_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">for emp_record1 in emp_cursor loop</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(emp_record1.ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end loop;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when cursor_already_open then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;游标已经打开&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（3）预定义例外dup_val_on_index</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">在唯一索引所对应的列上插入重复的值时，会隐含的触发例外dup_val_on_index例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">insert into dept values(10.&#39;公关部&#39;,&#39;北京&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when dup_val_on_index then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;在deptno列上不能出现重复值&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（4）预定义例外invalid_cursor</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当试图在不合法的游标上执行操作时，会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">例如：视图从没有打开的游标提取数据，或是关闭没有打开的游标。则会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">cursor emp_cursor is select ename,sal from emp;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">emp_record emp_cursor%rowtype;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">fetch emp_cursor into emp_record;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(emp_record.ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">close emp_cursor;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when invalid_cursor then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;请检查游标是否打开&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（5）预定义例外invalid_number</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当输入的数据有误时，会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：数字100写成了1oo就会触发该例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+&#39;1oo&#39;;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when invalid_number then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;输入数字不正确&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（6）预定义例外no_data_found</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">下面是一个pl/sql块，当执行select into没有返回行，就会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_sal emp.sal%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select sal into v_sal from emp where ename=&#39;&amp;name&#39;;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when no_data_found then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;不存在该员工&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（7）预定义例外too_many_rows</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当执行select into语句时，如果返回超过了一行，则会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename emp.ename%type;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename into v_ename from emp;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when too_many_rows then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;返回了多行&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（8）预定义例外zero_divide</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当执行除0操作时，则会触发给例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（9）预定义例外value_error</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当在执行赋值操作时，如果变量的长度不足以容纳实际数据，则会触发该例外value_error。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">declare</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">v_ename varchar2(5);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">select ename into v_ename from emp where empno=&amp;no;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(v_ename);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when value_error then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;变量尺寸不足&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">（10）其它预定义例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、login_denide</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">当用户非法登录时，会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、not_logged_on</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">如果用户没有登录就执行dml操作，就会触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">C、storage_error</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">如果超出了内存空间或是内存被损坏，就触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">D、timeout_on_resourece</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">如果Oracle在等待资源时，出现超时就触发该例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、非预定义例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">非预定义例外用于处理与预定义例外无关的Oracle错误，使用预定义例外只能处理21个Oracle错误，而当使用pl/sql开发应用程序时，可能会遇到其他的一些Oracle错误。比如在pl/sql快中执行dml语句时，违反了约束规定等等。在这样的情况下，也可以处理Oracle的各种例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">4、处理自定义例外</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">预定义例外和非预定义例外都是Oracle错误相关的，并且处在的Oracle错误会隐含的触发相应的例外。而自定义例外与Oracle错误没有任何关联，它是由开发人员为特定情况所定义的例外。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">案例：请编写一个pl/sql块，接收一个雇员的编号，并给该雇员工资增加1000元，如果该雇员不存在请提示。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create procedure IncreaseSal(spno number) is</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">myException exception;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">begin</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">update emp set sal=sal+100 where empno=spno;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">if sql%not_found then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">raise myException;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">end if;</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">exception</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">when myException then</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">dbms_output.put_line(&#39;没有更新任何用户&#39;);</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">十二、Oracle视图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">概述：视图是一个虚拟表，其内容由查询定义，同真实表一样，视图包含一系列带有名称的列和行数据。但是，视图并不在数据库中以存储的数据值集形式存在，行和列数据来自有定义视图的查询所引用的表，并且在引用视图时动态生成。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">1、视图与表的区别</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">A、表需要占用磁盘空间，视图不需要。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">B、视图不能添加索引。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">C、使用视图可以简化复杂查询。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">D、视图有利于提高安全性。</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">2、创建视图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create view 视图名 as select语句[with read only]</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">3、创建或修改视图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">create or replace view 视图名 as select语句[with read only]</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">4、删除视图</p><p style="margin: 0px 0px 16px; padding: 0px; font-size: 1em;">drop view 视图名</p></div></div></div><div style="margin: 0px auto; padding: 15px 0px 50px; border-top-width: 1px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-top-style: solid; border-top-color: rgb(221, 221, 221); font-family: Simsun, tahoma, &#39;Microsoft YaHei&#39;, &#39;Arial Unicode MS&#39;, Mingliu, Arial, Helvetica; color: rgb(148, 145, 143); font-size: 12px; background-color: rgb(243, 241, 240);"><div style="margin: 0px; padding: 0px; border: 0px;">收藏于 2013-12-16</div><div style="margin: 10px 0px 0px; padding: 0px; border: 0px; clear: both;"><a href="http://www.cnblogs.com/BeautyOfCode/archive/2010/09/28/1837240.html" style="text-decoration: none; color: rgb(25, 142, 216);" target="_blank">http://www.cnblogs.com/BeautyOfCode/archive/2010/09/28/1837240.html</a></div><div style="margin: 10px 0px 0px; padding: 0px; border: 0px; clear: both;">文章优化有问题？<a href="http://qingting.baidu.com/index?pid=26" style="text-decoration: none; color: rgb(25, 142, 216);" target="_blank">点击这里</a>反馈URL给我们</div></div></div>