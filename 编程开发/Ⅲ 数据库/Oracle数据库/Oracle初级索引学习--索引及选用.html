<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--defaultCSS-->
<title>Oracle初级索引学习--索引及选用</title>







<style type="text/css" id="wiz_custom_css">
body
{
    font-family: "Microsoft YaHei UI","Microsoft YaHei",SimSun,"Segoe UI",Tahoma,Helvetica,Sans-Serif,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>
<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style></head>

<body style="" ><div class="jz-title" id="jz-title" style="font-size: 24px; font-weight: bold; margin: 12px 0px 20px; text-align: center; color: rgb(51, 51, 51); font-family: 楷体_GB2312, 仿宋_GB2312, 宋体;"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">Oracle初级索引学习总结 - aehyok - 博客园</span></div><div class="jz-subtitle" id="jz-subtitle" style="text-align: right; font-size: 12px; margin-top: -20px; color: rgb(51, 51, 51); font-family: 楷体_GB2312, 仿宋_GB2312, 宋体; font-weight: bold;"></div><article class="jz-article loading" id="jz-article" style="padding-bottom: 30px; word-wrap: break-word; overflow: hidden; font-family: 楷体_GB2312, 仿宋_GB2312, 宋体; font-size: 18px; font-weight: bold; line-height: 27px;"><section class="jz-addcontent" style="margin-top: 20px;"><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">前言</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　&nbsp;索引是常见的数据库对象，建立索引的目的是为了提高记录的检索速度。它的设置好坏，使用是否得当，极大地影响数据库应用程序和Database的性能。虽然有许多资料讲索引的用法，DBA和Developer们也经常与它打交道，但还是有不少的人对它存在误解，比如我本人就不是很清楚这其中的道理。所以特此进行总结，也请大牛们来给检查检查，分享下你们的经验。</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">什么情况下会使用到索引</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　一般来说，对于单列索引，只要Select、Delete、Update语句的Where条件中有此列，就会使用此索引。</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　对于多列索引，假如一个表中的主键（ID,Name,Age三个字段联合索引），只有当Where条件中包含索引中的前一个或几个列时才会用到索引。</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　如ID条件，ID、Age组合条件，ID、Name、Age组合条件，而仅有Name、Age条件，没有ID条件是不会使用索引的。因为此索引是先根据ID排序，ID相同的再根据Name排序，ID、Name相同的再根据Age排序。</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">&nbsp;什么情况下应该为表建立索引</span></p><p><font color="#333333"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　</span></font><font color="#00ccff"><u><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">一般来说，满足下列条件的应该建立索引</span></u></font><font color="#333333"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">：</span></font></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　1、列经常被用在Where条件中或连接条件中</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　2、列的数据比较分散，即重复值不多</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　3、列包含大量的空值</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　4、几个列经常一起用在Where条件或连接条件中（联合索引）</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　5、大部分的检索只返回大表中的小部分记录（2%~5%）</span></p><p><font color="#00ccff"><u><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">什么情况下不应该为表建立索引</span></u></font></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　不应该建立索引的情况有：</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　1、表的数据量不大</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　2、列很少用在查询条件中</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　3、大部分的检索都返回大量的数据　　</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　4、表的Update操作很频繁</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">但索引并非总是最佳选择，如果发现Oracle在有索引的情况下，没有使用索引，这并不是优化器出错。在有些情况下，Oracle确实会选择全表扫描（Full Table Scan),而非索引扫描（Index Scan)。这些情况通常有：</span><br><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　1、表未做统计，或者统计陈旧，导致Oracle判断失误。</span><br><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　2、根据该表拥有的记录数和数据块数，实际上全表扫描要比索引扫描更快。</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">但是，Oracle是否真正使用索引，使用索引是否真正有效，还是必须进行实地的测验。合理的做法是，对缩写的复杂sql,在将它写入应用程序之前，先在产品数据库上做一次执行计划(explain)。explain会获得Oracle对该sql的解析（plan）,可以明确地看到Oracle是如何优化该sql的。</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">如果经常做explain，就会发现，喜爱写发扎的sql并不是好习惯，因为过分复杂的sql其解析计划往往不尽如人意。事实上，如果库表结构设计的合理，一般情况下我们很少需要写复杂的sql。将复杂的Sql拆开，有时候会极大地提高效率，因为能获得很好的优化。</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">用索引提高效率</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">&nbsp;　　通常情况下，通过索引查询数据比全表扫描要快。同样在联结多个表时使用索引也可以提高效率。另一个使用索引的好处是，它提供了主键（primary key）的唯一性验证。不过使用索引时也必须注意到它的代价。索引需要空间来存储，也需要定期维护，每当有记录在表中增减或索引列被修改时，索引本身也会被修改。这意味着每条记录的Insert、Delete、Update将为此多付出4、5此的磁盘I/O。因为索引需要额外的存储空间和处理，那些不必要的索引反而会使查询反应时间变慢。</span></p><p><font color="#333333"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　</span></font><span style="background-color: rgb(255, 255, 255);"><font color="#333333"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　</span></font><font color="#00ccff"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">Oracle对索引有两种访问模式：</span></font></span></p><p><span style="background-color: rgb(255, 255, 255);"><font color="#00ccff"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　索引唯一扫描（Index Unique Scan）</span></font></span></p><p><span style="background-color: rgb(255, 255, 255);"><font color="#00ccff"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　索引范围查询（Index Range Scan)</span></font></span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　适用于两种情况：1、基于一个范围的检索　　2、基于非唯一性索引的检索</span></p><p><span style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　</span></span><font color="#00ccff"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">当where子句中有多个索引列，且包含非“=”号时，Oracle会放弃使用非“=”号的索引</span></font></p><p><font color="#00ccff"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">　　当where子句中有多个索引列，且都为非“=”号时，Oracle将只使用一个索引，至于使用那个索引，这个还要看情况而定。</span></font></p><p><font color="#00ccff"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">强制索引失效</span></font></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">&nbsp;　　如果两个或以上具有相同的等级，而我们只想使用其中的一个（通过它，检索出的记录数量少），我们可以使用下面的方法：</span></p><div class="cnblogs_code" style="color: rgb(51, 51, 51);"><pre class="prettyprint" style="padding: 2px; border: 1px solid rgb(136, 136, 136); background-color: rgb(239, 239, 239);"><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">select</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="typ" style="color: rgb(102, 0, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">Ename</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">from</span></span><span class="pln" style="color: rgb(0, 0, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;"> EMP
</span></span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">where</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="typ" style="color: rgb(102, 0, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">ENo</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">=</span></span><span class="lit" style="color: rgb(0, 102, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">7935</span></span><span class="pln" style="color: rgb(0, 0, 0);">
</span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">and</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="typ" style="color: rgb(102, 0, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">DNo</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">=</span></span><span class="lit" style="color: rgb(0, 102, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">10</span></span><span class="pln" style="color: rgb(0, 0, 0);">
</span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">and</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="typ" style="color: rgb(102, 0, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">EType</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">=</span></span><span class="str" style="color: rgb(0, 136, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">'</span></span><span class="str" style="color: rgb(0, 136, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">A</span></span><span class="str" style="color: rgb(0, 136, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">'</span></span></pre></div><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">如果我们只想用到ENo上的索引（相对另外两个条件记录数量很少，做合并不划算）则可改编为：</span></p><div class="cnblogs_code" style="color: rgb(51, 51, 51);"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="" title="复制代码" target="_blank" style="color: rgb(0, 102, 204); text-decoration: none;"><img src="Oracle初级索引学习--索引及选用_files/copycode[1].gif" alt="复制代码" style="display: block;"></a></span></div><pre class="prettyprint" style="padding: 2px; border: 1px solid rgb(136, 136, 136); background-color: rgb(239, 239, 239);"><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">select</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="typ" style="color: rgb(102, 0, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">EName</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">from</span></span><span class="pln" style="color: rgb(0, 0, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;"> EMP

</span></span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">where</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="typ" style="color: rgb(102, 0, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">ENo</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">=</span></span><span class="lit" style="color: rgb(0, 102, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">7935</span></span><span class="pln" style="color: rgb(0, 0, 0);">

</span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">and</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="typ" style="color: rgb(102, 0, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">DNo</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">+</span></span><span class="lit" style="color: rgb(0, 102, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">0</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">=</span></span><span class="lit" style="color: rgb(0, 102, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">10</span></span><span class="pln" style="color: rgb(0, 0, 0);">   </span><span class="com" style="color: rgb(136, 0, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">/*</span></span><span class="com" style="color: rgb(136, 0, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">DNo上的索引将不会使用/*

and EType|| ''='A'  /*EType上的索引将不会使用/*</span></span></pre><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="" title="复制代码" target="_blank" style="color: rgb(0, 102, 204); text-decoration: none;"><img src="Oracle初级索引学习--索引及选用_files/copycode[1].gif" alt="复制代码" style="display: block;"></a></span></div></div><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">&nbsp;</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">同样，如果我们想使用某个列上的索引，则不能对此列做运算。</span></p><div class="cnblogs_code" style="color: rgb(51, 51, 51);"><pre class="prettyprint" style="padding: 2px; border: 1px solid rgb(136, 136, 136); background-color: rgb(239, 239, 239);"><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">select</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">*</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">from</span></span><span class="pln" style="color: rgb(0, 0, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;"> DEPT

</span></span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">where</span></span><span class="pln" style="color: rgb(0, 0, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;"> SAL</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">*</span></span><span class="lit" style="color: rgb(0, 102, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">12</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">&gt;</span></span><span class="lit" style="color: rgb(0, 102, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">25000</span></span></pre></div><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">不能使用SAL列上的索引，可改编为：</span></p><div class="cnblogs_code" style="color: rgb(51, 51, 51);"><pre class="prettyprint" style="padding: 2px; border: 1px solid rgb(136, 136, 136); background-color: rgb(239, 239, 239);"><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">select</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">*</span></span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">from</span></span><span class="pln" style="color: rgb(0, 0, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;"> DEPT

</span></span><span class="kwd" style="color: rgb(0, 0, 136);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">where</span></span><span class="pln" style="color: rgb(0, 0, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;"> SAL</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">&gt;</span></span><span class="lit" style="color: rgb(0, 102, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">25000</span></span><span class="pun" style="color: rgb(102, 102, 0);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">/</span></span><span class="lit" style="color: rgb(0, 102, 102);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">12</span></span></pre></div><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">总结</span></p><p style="color: rgb(51, 51, 51);"><span data-wiz-span="data-wiz-span" style="font-size: 10.5pt;">&nbsp;　　对Oracle的索引了解还不是很深入，只是浮于表面的认识，日后要多加使用研究。</span></p></section></article>



</body></html>