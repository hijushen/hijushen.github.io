<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>Python 的尾递归尝试（可惜Python未优化）</title>
    <!--mark |wiz_custom_css| for wizeditor replace it-->


<style id="wiz_custom_css">        html, body {            font-size: 15px;        }        body {            font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;            line-height: 1.6;            margin: 0;            padding: 20px 36px;            padding: 1.33rem 2.4rem;        }        h1, h2, h3, h4, h5, h6 {            margin: 20px 0 10px;            margin: 1.33rem 0 0.667rem;            padding: 0;            font-weight: bold;        }        h1 {            font-size: 21px;            font-size: 1.4rem;        }        h2 {            font-size: 20px;            font-size: 1.33rem;        }        h3 {            font-size: 18px;            font-size: 1.2rem;        }        h4 {            font-size: 17px;            font-size: 1.13rem;        }        h5 {            font-size: 15px;            font-size: 1rem;        }        h6 {            font-size: 15px;            font-size: 1rem;            color: #777777;            margin: 1rem 0;        }        div, p, ul, ol, dl, li {            margin: 0;        }        blockquote, table, pre, code{            margin: 8px 0;        }        ul, ol {            padding-left: 32px;            padding-left: 2.13rem;        }        blockquote {            border-left: 4px solid #dddddd;            padding: 0 12px;            padding: 0 0.8rem;            color: #aaa;        }        blockquote > :first-child {            margin-top: 0;        }        blockquote > :last-child {            margin-bottom: 0;        }        img {            border: 0;            max-width: 100%;            height: auto !important;            margin: 2px 0;        }        table {            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        td {            padding:4px 8px;            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        @media screen and (max-width: 660px) {            body {                padding: 20px 18px;                padding: 1.33rem 1.2rem;            }        }        @media only screen and (-webkit-max-device-width: 1024px), only screen and (-o-max-device-width: 1024px), only screen and (max-device-width: 1024px), only screen and (-webkit-min-device-pixel-ratio: 3), only screen and (-o-min-device-pixel-ratio: 3), only screen and (min-device-pixel-ratio: 3) {            html, body {                font-size: 17px;            }            body {                line-height: 1.7;                padding: 0.75rem 0.9375rem;                color: #353c47;            }            h1 {                font-size: 2.125rem;            }            h2 {                font-size: 1.875rem;            }            h3 {                font-size: 1.625rem;            }            h4 {                font-size: 1.375rem;            }            h5 {                font-size: 1.125rem;            }            h6 {                color: inherit;            }            ul, ol {                padding-left: 2.5rem;            }            blockquote {                border-left: 4px solid #c8d4e8;                padding: 0 0.9375rem;                color: #b3c2dd;            }        }</style><style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style></head>

<body  style=""><p style="margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">在函数内部，可以调用其他函数。如果一个函数在内部调用自身本身，这个函数就是递归函数。</p><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">举个例子，我们来计算阶乘<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">n! = 1 x 2 x 3 x ... x n</code>，用函数<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">fact(n)</code>表示，可以看出：</p><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">fact(n) = n! = 1 x 2 x 3 x ... x (n-1) x n = (n-1)! x n = fact(n-1) x n</p><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">所以，<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">fact(n)</code>可以表示为<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">n x fact(n-1)</code>，只有n=1时需要特殊处理。</p><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">于是，<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">fact(n)</code>用递归的方式写出来就是：</p><pre style="margin-top: 15px; margin-bottom: 15px; padding: 10px; font-size: 13px; line-height: 18px; font-family: ubutu; color: rgb(68, 68, 68); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; widows: 1; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;"><code class="python" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;"><span class="function" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;"><span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">def</span> <span class="title" style="font-weight: bold; color: rgb(153, 0, 0); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">fact</span><span class="params" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">(n)</span>:</span><span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">if</span> n==<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>:
        <span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">return</span> <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span><span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">return</span> n * fact(n - <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>)
</code></pre><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">上面就是一个递归函数。可以试试：</p><pre style="margin-top: 15px; margin-bottom: 15px; padding: 10px; font-size: 13px; line-height: 18px; font-family: ubutu; color: rgb(68, 68, 68); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; widows: 1; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;"><code class="python" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;"><span class="prompt" style="color: rgb(153, 0, 115); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">&gt;&gt;&gt; </span>fact(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>)
<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span><span class="prompt" style="color: rgb(153, 0, 115); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">&gt;&gt;&gt; </span>fact(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span>)
<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">120</span><span class="prompt" style="color: rgb(153, 0, 115); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">&gt;&gt;&gt; </span>fact(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">100</span>)
<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000</span>L
</code></pre><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">如果我们计算<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">fact(5)</code>，可以根据函数定义看到计算过程如下：</p><pre style="margin-top: 15px; margin-bottom: 15px; padding: 10px; font-size: 13px; line-height: 18px; font-family: ubutu; color: rgb(68, 68, 68); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; widows: 1; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;"><code class="php" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">===&gt; fact(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span>)
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span> * fact(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">4</span>)
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">4</span> * fact(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">3</span>))
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">4</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">3</span> * fact(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">2</span>)))
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">4</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">3</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">2</span> * fact(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>))))
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">4</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">3</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">2</span> * <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>)))
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">4</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">3</span> * <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">2</span>))
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span> * (<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">4</span> * <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">6</span>)
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span> * <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">24</span>
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">120</span></code></pre><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">递归函数的优点是定义简单，逻辑清晰。理论上，所有的递归函数都可以写成循环的方式，但循环的逻辑不如递归清晰。</p><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">使用递归函数需要注意防止栈溢出。在计算机中，函数调用是通过栈（stack）这种数据结构实现的，每当进入一个函数调用，栈就会加一层栈帧，每当函数返回，栈就会减一层栈帧。由于栈的大小不是无限的，所以，递归调用的次数过多，会导致栈溢出。可以试试<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">fact(1000)</code>：</p><pre style="margin-top: 15px; margin-bottom: 15px; padding: 10px; font-size: 13px; line-height: 18px; font-family: ubutu; color: rgb(68, 68, 68); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; widows: 1; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;"><code class="xml" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">&gt;&gt;&gt; fact(1000)
Traceback (most recent call last):
  File "<span class="tag" style="color: rgb(0, 0, 128); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">&lt;<span class="title" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">stdin</span>&gt;</span>", line 1, in <span class="tag" style="color: rgb(0, 0, 128); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">&lt;<span class="title" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">module</span>&gt;</span>
  File "<span class="tag" style="color: rgb(0, 0, 128); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">&lt;<span class="title" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">stdin</span>&gt;</span>", line 4, in fact
  ...
  File "<span class="tag" style="color: rgb(0, 0, 128); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">&lt;<span class="title" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">stdin</span>&gt;</span>", line 4, in fact
RuntimeError: maximum recursion depth exceeded
</code></pre><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">解决递归调用栈溢出的方法是通过<strong style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">尾递归</strong>优化，事实上尾递归和循环的效果是一样的，所以，把循环看成是一种特殊的尾递归函数也是可以的。</p><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">尾递归是指，在函数返回的时候，调用自身本身，并且，return语句不能包含表达式。这样，编译器或者解释器就可以把尾递归做优化，使递归本身无论调用多少次，都只占用一个栈帧，不会出现栈溢出的情况。</p><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">上面的<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">fact(n)</code>函数由于<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">return n * fact(n - 1)</code>引入了乘法表达式，所以就不是尾递归了。要改成尾递归方式，需要多一点代码，主要是要把每一步的乘积传入到递归函数中：</p><pre style="margin-top: 15px; margin-bottom: 15px; padding: 10px; font-size: 13px; line-height: 18px; font-family: ubutu; color: rgb(68, 68, 68); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; widows: 1; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;"><code class="python" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;"><span class="function" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;"><span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">def</span> <span class="title" style="font-weight: bold; color: rgb(153, 0, 0); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">fact</span><span class="params" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">(n)</span>:</span><span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">return</span> fact_iter(n, <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>)

<span class="function" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;"><span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">def</span> <span class="title" style="font-weight: bold; color: rgb(153, 0, 0); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">fact_iter</span><span class="params" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">(num, product)</span>:</span><span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">if</span> num == <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>:
        <span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">return</span> product
    <span class="keyword" style="font-weight: bold; color: rgb(51, 51, 51); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">return</span> fact_iter(num - <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>, num * product)
</code></pre><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">可以看到，<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">return fact_iter(num - 1, num * product)</code>仅返回递归函数本身，<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">num - 1</code>和<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">num * product</code>在函数调用前就会被计算，不影响函数调用。</p><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;"><code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">fact(5)</code>对应的<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">fact_iter(5, 1)</code>的调用如下：</p><pre style="margin-top: 15px; margin-bottom: 15px; padding: 10px; font-size: 13px; line-height: 18px; font-family: ubutu; color: rgb(68, 68, 68); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; widows: 1; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;"><code class="php" style="text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">===&gt; fact_iter(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span>, <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>)
===&gt; fact_iter(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">4</span>, <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">5</span>)
===&gt; fact_iter(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">3</span>, <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">20</span>)
===&gt; fact_iter(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">2</span>, <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">60</span>)
===&gt; fact_iter(<span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">1</span>, <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">120</span>)
===&gt; <span class="number" style="color: rgb(0, 153, 153); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">120</span></code></pre><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">尾递归调用时，如果做了优化，栈不会增长，因此，无论多少次调用也不会导致栈溢出。</p><p style="margin-top: 15px; margin-bottom: 15px; word-wrap: break-word; white-space: pre-wrap; color: rgb(102, 102, 102); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; widows: 1; background-color: rgb(204, 232, 204); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important;">遗憾的是，大多数编程语言没有针对尾递归做优化，Python解释器也没有做优化，所以，即使把上面的<code style="font-size: 12px; font-family: Consolas, monospace, serif; color: rgb(221, 0, 85); white-space: nowrap; padding: 0px 4px; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(250, 250, 250); text-shadow: rgb(153, 153, 153) 0.01em 0.01em 0.01em !important; background-position: initial initial; background-repeat: initial initial;">fact(n)</code>函数改成尾递归方式，也会导致栈溢出</p><br><div style="color:gray"><small>来源：&nbsp;<a href="http://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/00137473836826348026db722d9435483fa38c137b7e685000">http://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/00137473836826348026db722d9435483fa38c137b7e685000</a></small></div></body></html>