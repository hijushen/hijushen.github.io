<!DOCTYPE html>
<html>
    <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        
         


        
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />

<link rel="dns-prefetch" href="http://res.wx.qq.com/">
<link rel="dns-prefetch" href="http://mmbiz.qpic.cn/">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">


        <title>Java中整型的缓存机制</title>
        
<link rel="stylesheet" type="text/css" href="Java中整型的缓存机制_files/page_mp_article_improve2a7a3f.css">
<style>
     
    </style>
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_pc2a7a3f.css">
<![endif]-->


    </head>
    <body id="activity-detail" class="zh_CN mm_appmsg" ontouchstart="">
        
    
    
    <div id="js_cmt_mine" class="discuss_container editing access" style="display:none;">
        <div class="discuss_container_inner">
            <h2 class="rich_media_title">Java中整型的缓存机制</h2>
            <span id="log"></span>
            <div class="frm_textarea_box_wrp">
                <span class="frm_textarea_box">
                    <textarea id="js_cmt_input" class="frm_textarea" placeholder="留言将由公众号筛选后显示，对所有人可见。"></textarea>
                    <div class="emotion_tool">
                        <span class="emotion_switch" style="display:none;"></span>
                        <span id="js_emotion_switch" class="pic_emotion_switch_wrp">
                            <img class="pic_default" src="Java中整型的缓存机制_files/icon_emotion_switch.2x278965.png" alt="">
                            <img class="pic_active" src="Java中整型的缓存机制_files/icon_emotion_switch_active.2x278965.png" alt="">
                        </span>
                        <div class="emotion_panel" id="js_emotion_panel">
                            <span class="emotion_panel_arrow_wrp" id="js_emotion_panel_arrow_wrp">
                                <i class="emotion_panel_arrow arrow_out"></i>
                                <i class="emotion_panel_arrow arrow_in"></i>
                            </span>
                            <div class="emotion_list_wrp" id="js_slide_wrapper">
                                
                                
                            </div>
                            <ul class="emotion_navs" id="js_navbar">
                                
                            </ul>
                        </div>
                    </div>
                </span>
            </div>
            <div class="discuss_btn_wrp"><a id="js_cmt_submit" class="btn btn_primary btn_discuss btn_disabled" href="">提交</a></div>
            <div class="discuss_list_wrp" style="display:none">
                <div class="rich_tips with_line title_tips discuss_title_line">
                    <span class="tips">我的留言</span>
                </div>
                <ul class="discuss_list" id="js_cmt_mylist"></ul>
            </div>
            <div class="rich_tips tips_global loading_tips" id="js_mycmt_loading">
                <img src="Java中整型的缓存机制_files/icon_loading_white2805ea.gif" class="rich_icon icon_loading_white" alt="">
                <span class="tips">加载中</span>
            </div>
            <div class="wx_poptips" id="js_cmt_toast" style="display:none;">
                <img alt="" class="icon_toast" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAABqCAYAAABUIcSXAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3NpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyMTUxMzkxZS1jYWVhLTRmZTMtYTY2NS0xNTRkNDJiOGQyMWIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTA3QzM2RTg3N0UwMTFFNEIzQURGMTQzNzQzMDAxQTUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTA3QzM2RTc3N0UwMTFFNEIzQURGMTQzNzQzMDAxQTUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NWMyOGVjZTMtNzllZS00ODlhLWIxZTYtYzNmM2RjNzg2YjI2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjIxNTEzOTFlLWNhZWEtNGZlMy1hNjY1LTE1NGQ0MmI4ZDIxYiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pmvxj1gAAAVrSURBVHja7J15rF1TFMbXk74q1ZKHGlMkJVIhIgg1FH+YEpEQJCKmGBpThRoSs5jVVNrSQUvEEENIhGiiNf9BiERICCFIRbUiDa2qvudbOetF3Tzv7XWGffa55/uS7593977n3vO7e5+199p7v56BgQGh0tcmvAUERREUQVEERREUQVEERREUQVEERREUQVEERREUQVEERREUQVEERVAUQVEERVAUQbVYk+HdvZVG8b5F0xj4RvhouB+eCy8KrdzDJc1RtAX8ILxvx98V1GyCSkN98Cx4z/95/Wn4fj6j6tUEeN4wkFSnw1MJqj5NhBfAuwaUHREUg4lqNMmePVsHll/HFhVfe1t3FwpJI8DXCCquDrCWNN4B6Tb4M3Z98aTPmTvh0YHl18PXw29yZiKejoPvcUD6E74yFBJbVDk6Bb7K8aP/Hb4c/tRzEYIqprPhSxzlf4Uvhb/0Xoig8qnHAJ3lqPMzfDH8XZ4LEpRf2sVdA5/sqPO9Qfop70UJyn+/boaPddT5yrq7VUUvTIVJI7q74MMddXR8NB1eXcYvhBpZm0s2w72/o86HFoKvLau/pYaXzjLMdUJ6y0LwtWV9CIIaXtvA8+G9HHV03u5q+K+yH47U0NoRngPv7KjzHDwTLj0bS1BDazfJJlcnOOostC6ysnCT+q80G/sIvFVgeW09D8FPVT0uoP7VfvAD8NjA8pqmuAN+OcYAjso0RbIZ8DGB5TVNcRO8JMaHY9SXSdfa3eeANJimWBLrA7JFiZwIXye+NMUV8CcxP2SRFjXefok7NRjSGZJlWUPvw2/wtNiQirSoXWyMsR28wR7AzzYM0oXw+Y7yK+CLJGeaoqjyrJSdZJD6Ov4+z5y6NJc0Az7NUecHydIUy+v60KNyQHoM3nKI1y7YCFiq0i7uBvgER52vDdKqWn9djhY1Dn4G3n6Ecqm2rF74dvgoR53S0hQxW9RJAZAGW5bSn58QJA27dQ7uIEedjywEX5NKVxCqsY6y+qA+LxFI4+yZ6oH0trWkNan80jygtIUsc5SflgAsDXgehfdx1KkkTRE76tN+Xue2jnTU0Ru1oIbvpt30bBtKhOp5yaaRkts0lic8V1i6dPcIRx2d/l8Y8XtNNEg7OOo8bl1kmmOKnDsO88CaYzejau0hWZqiL7C83oCH4SeTHvwV2BqqsHRVztSEYOmWF80NeXZT6Hd4KflResE9vCnBOlCyGfDNAstHTVPUDWoQ1t3iW+9WNizvlhfd4aerXd+ThqiMfNR6+9LvOOro5OY5JX2H4+F7HZD+kGzlamMgldWiirQsjcwWFbjmqZJteekJLK9pisvgL6RhKvuciZiwzrWWGapfrPy30kBVcSBIrw0aD3PU0XB6cehntq7rTMf7/2iQlktDVdXJLXlg6VjmiYBn6rWSTRCH6hvJ0hQrpcGq8oidsmHpTP8t8DGO9/vcWt9qabiqPgup1yKyQwvC2tSefZ73SSpNkUJ4PlLorlHZ+446nc8f3fIyywlJhwrTuwVSjBa1ccvSxN0hjjoK5xVrYZMd9V6XbFfgBukixTwGLg8sDam3dZR/wZ6L/dJlin1en8LS+bgpFbz3Ygvzu1J1HKxYNqxGpCmaCEo12rrBorD6LRp8UbpcdR5VWhTW35KlKd6QFqjuM2XzwlpnMxTvSkuUwuG/Xlg6NtPjbT6WFimF/VG6LEvXgn8QGDjMbBukVECFwhpoS+CQatfX2Q1q6H7wENHdrfCr0lKleEB9JyxNneus+VJpsVL9TwI6W65LovWIGl3KtVJaLv7LBwYTFEERFEVQFEERFEVQFEERFEVQFEERFEVQFEERFEVQFEERFFWq/hFgADUMN4RzT6/OAAAAAElFTkSuQmCC">
                <p class="toast_content">已留言</p>
            </div>
        </div>
    </div>

    <div id="js_article" class="rich_media">
        
        <div id="js_top_ad_area" class="top_banner">
 
        </div>
                

        <div class="rich_media_inner">
            <div id="page-content">
                <div id="img-content" class="rich_media_area_primary">
                    <h2 class="rich_media_title" id="activity-name">
                        Java中整型的缓存机制 
                    </h2>
                    <div class="rich_media_meta_list">
                        						                        <em id="post-date" class="rich_media_meta rich_media_meta_text">2016-02-25</em>

                                                <a class="rich_media_meta rich_media_meta_link rich_media_meta_nickname" href="" id="post-user">ImportNew</a>
                        <span class="rich_media_meta rich_media_meta_text rich_media_meta_nickname">ImportNew</span>

                        <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                            <div class="profile_inner">
                                <strong class="profile_nickname">ImportNew</strong>
                                <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                                <p class="profile_meta">
                                <label class="profile_meta_label">微信号</label>
                                <span class="profile_meta_value">importnew</span>
                                </p>

                                <p class="profile_meta">
                                <label class="profile_meta_label">功能介绍</label>
                                <span class="profile_meta_value">专注&nbsp;Java&nbsp;和&nbsp;Android&nbsp;技术分享。ImportNew&nbsp;由两个&nbsp;Java&nbsp;关键字&nbsp;import&nbsp;和&nbsp;new&nbsp;组成。意指：Java&nbsp;&amp;&nbsp;Android&nbsp;程序员学习新知识的网站。</span>
                                </p>
                                
                            </div>
                            <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                                <i class="profile_arrow arrow_out"></i>
                                <i class="profile_arrow arrow_in"></i>
                            </span>
                        </div>
                    </div>
                    
                    
                    
                    
                                                            
                                                            
                    
                    <div class="rich_media_content " id="js_content">
                        
                        <h6 style="line-height: 25.6000003814697px; white-space: normal; text-align: center;">&nbsp;<strong><span style="font-size: 14px; color: rgb(255, 41, 65);">(点击<span style="color: rgb(0, 82, 255);">上方公众号</span>，可快速关注)</span></strong></h6><p style="font-size: 16.1904773712158px; line-height: 25.6px; white-space: normal; text-align: center;"><strong style="max-width: 100%; box-sizing: border-box !important;"><span style="color: rgb(255, 0, 0); font-size: 14px; max-width: 100%; box-sizing: border-box !important;"><br  /></span></strong></p><blockquote style="line-height: 25.6px; white-space: normal; max-width: 100%; box-sizing: border-box !important; background-color: rgb(255, 255, 255);"><p style="color: rgb(62, 62, 62); font-size: 16.1904773712158px; white-space: pre-wrap; min-height: 1em; max-width: 100%; box-sizing: border-box !important;"><span style="color: rgb(0, 176, 80); font-size: 14px; max-width: 100%; box-sizing: border-box !important;">来源：Java Papers</span></p><p style="white-space: pre-wrap; min-height: 1em; max-width: 100%; box-sizing: border-box !important;"><span style="color: rgb(0, 176, 80); font-size: 14px; max-width: 100%; box-sizing: border-box !important;">译文：张洪亮</span></p><p style="color: rgb(62, 62, 62); font-size: 16.1904773712158px; white-space: pre-wrap; min-height: 1em; max-width: 100%; box-sizing: border-box !important;"><span style="color: rgb(0, 176, 80); font-size: 14px; max-width: 100%; box-sizing: border-box !important;">链接：http://www.hollischuang.com/archives/1174</span></p></blockquote><p><br  /></p><p>本文将介绍Java中Integer的缓存相关知识。这是在Java 5中引入的一个有助于节省内存、提高性能的功能。首先看一个使用Integer的示例代码，从中学习其缓存行为。接着我们将为什么这么实现以及他到底是如何实现的。你能猜出下面的Java程序的输出结果吗。如果你的结果和真正结果不一样，那么你就要好好看看本文了。</p><p><br  /></p><blockquote><p><span style="font-size: 12px; color: rgb(136, 136, 136);">package&nbsp;com.javapapers.java;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">public&nbsp;class&nbsp;JavaIntegerCache {</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;main(String... strings) {</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer integer1 =&nbsp;3;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer integer2 =&nbsp;3;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(integer1 == integer2)</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;integer1 == integer2&quot;);</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;integer1 != integer2&quot;);</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer integer3 =&nbsp;300;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer integer4 =&nbsp;300;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(integer3 == integer4)</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;integer3 == integer4&quot;);</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;integer3 != integer4&quot;);</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">}</span></p></blockquote><p><br  /></p><p>我们普遍认为上面的两个判断的结果都是false。虽然比较的值是相等的，但是由于比较的是对象，而对象的引用不一样，所以会认为两个if判断都是false的。在Java中，==比较的是对象应用，而equals比较的是值。所以，在这个例子中，不同的对象有不同的引用，所以在进行比较的时候都将返回false。奇怪的是，这里两个类似的if条件判断返回不同的布尔值。<br  /></p><p><br  /></p><p>上面这段代码真正的输出结果：</p><p><br  /></p><blockquote><p><span style="font-size: 12px; color: rgb(136, 136, 136);">integer1 == integer2</span></p><p><span style="font-size: 12px; color: rgb(136, 136, 136);">integer3 != integer4</span></p></blockquote><p><br  /></p><p><span style="color: rgb(214, 168, 65);"><strong>Java中Integer的缓存实现</strong></span><br  /></p><p><br  /></p><p>在Java 5中，在Integer的操作上引入了一个新功能来节省内存和提高性能。整型对象通过使用相同的对象引用实现了缓存和重用。</p><p><br  /></p><blockquote><p>适用于整数值区间-128 至 +127。</p><p>只适用于自动装箱。使用构造函数创建对象不适用。</p></blockquote><p><br  /></p><p>Java的编译器把基本数据类型自动转换成封装类对象的过程叫做自动装箱，相当于使用valueOf方法：</p><p><br  /></p><blockquote><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">Integer a = 10; //this is autoboxing</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">Integer b = Integer.valueOf(10); //under the hood</span></p></blockquote><p><br  /></p><p>现在我们知道了这种机制在源码中哪里使用了，那么接下来我们就看看JDK中的valueOf方法。下面是JDK 1.8.0 build 25的实现：</p><p><br  /></p><blockquote><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">/**</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Returns an {@code Integer} instance representing the specified</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* {@code int} value.&nbsp; If a new {@code Integer} instance is not</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* required, this method should generally be used in preference to</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* the constructor {@link #Integer(int)}, as this method is likely</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* to yield significantly better space and time performance by</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* caching frequently requested values.</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* This method will always cache values in the range -128 to 127,</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* inclusive, and may cache other values outside of this range.</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* @param&nbsp; i an {@code int} value.</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* @return an {@code Integer} instance representing {@code i}.</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* @since&nbsp; 1.5</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;public static Integer valueOf(int i) {</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return IntegerCache.cache[i + (-IntegerCache.low)];</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Integer(i);</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p></blockquote><p><br  /></p><p>在创建对象之前先从IntegerCache.cache中寻找。如果没找到才使用new新建对<span style="line-height: 1.6;">象。</span></p><p><span style="line-height: 1.6;"><br  /></span></p><h2><span style="color: rgb(214, 168, 65);"><strong>IntegerCache Class</strong></span></h2><p><br  /></p><p>IntegerCache是Integer类中定义的一个private static的内部类。接下来看看他的定义。</p><p><br  /></p><blockquote><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">/**</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;* Cache to support the object identity semantics of autoboxing for values between</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;* -128 and 127 (inclusive) as required by JLS.</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;*</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;* The cache is initialized on first usage.&nbsp; The size of the cache</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;* may be controlled by the {@code -XX:AutoBoxCacheMax=} option.</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;* During VM initialization, java.lang.Integer.IntegerCache.high property</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;* may be set and saved in the private system properties in the</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;* sun.misc.VM class.</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;*/</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;private static class IntegerCache {</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static final int low = -128;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static final int high;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static final Integer cache[];</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static {</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// high value may be configured by property</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int h = 127;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String integerCacheHighPropValue =</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sun.misc.VM.getSavedProperty(&quot;java.lang.Integer.IntegerCache.high&quot;);</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (integerCacheHighPropValue != null) {</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int i = parseInt(integerCacheHighPropValue);</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i = Math.max(i, 127);</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Maximum array size is Integer.MAX_VALUE</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h = Math.min(i, Integer.MAX_VALUE - (-low) -1);</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch( NumberFormatException nfe) {</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// If the property cannot be parsed into an int, ignore it.</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;high = h;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache = new Integer[(high - low) + 1];</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int j = low;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(int k = 0; k &lt; cache.length; k++)</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache[k] = new Integer(j++);</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// range [-128, 127] must be interned (JLS7 5.1.7)</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert IntegerCache.high &gt;= 127;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private IntegerCache() {}</span></p><p style="line-height: 17.6000003814697px; white-space: normal;"><span style="font-size: 12px; color: rgb(136, 136, 136);">&nbsp;&nbsp;}</span></p></blockquote><p><br  /></p><p>其中的javadoc详细的说明了缓存支持-128到127之间的自动装箱过程。最大值127可以通过-XX:AutoBoxCacheMax=size修改。 缓存通过一个for循环实现。从低到高并创建尽可能多的整数并存储在一个整数数组中。这个缓存会在Integer类第一次被使用的时候被初始化出来。以后，就可以使用缓存中包含的实例对象，而不是创建一个新的实例(在自动装箱的情况下)。<br  /></p><p><br  /></p><p>实际上这个功能在Java 5中引入的时候,范围是固定的-128 至 +127。后来在Java 6中，可以通过java.lang.Integer.IntegerCache.high设置最大值。这使我们可以根据应用程序的实际情况灵活地调整来提高性能。到底是什么原因选择这个-128到127范围呢？因为这个范围的数字是最被广泛使用的。 在程序中，第一次使用Integer的时候也需要一定的额外时间来初始化这个缓存。</p><p><br  /></p><h2><span style="color: rgb(214, 168, 65);"><strong>Java语言规范中的缓存行为</strong></span></h2><p><br  /></p><p>在Boxing Conversion部分的Java语言规范(JLS)规定如下：</p><p><br  /></p><blockquote><p>如果一个变量p的值是：</p><p>-128至127之间的整数(§3.10.1)</p><p>true 和 false的布尔值 (§3.10.3)</p><p>‘\u0000’至 ‘\u007f’之间的字符(§3.10.4)</p><p>中时，将p包装成a和b两个对象时，可以直接使用a==b判断a和b的值是否相等。</p></blockquote><h2><br  /></h2><h2><span style="color: rgb(214, 168, 65);"><strong>其他缓存的对象</strong></span></h2><p><br  /></p><p>这种缓存行为不仅适用于Integer对象。我们针对所有的整数类型的类都有类似的缓存机制。</p><p><br  /></p><blockquote><p>有ByteCache用于缓存Byte对象</p><p>有ShortCache用于缓存Short对象</p><p>有LongCache用于缓存Long对象</p><p>有CharacterCache用于缓存Character对象</p></blockquote><p><br  /></p><p>Byte,&nbsp;Short,&nbsp;Long有固定范围: -128 到 127。对于Character, 范围是 0 到 127。除了Integer以外，这个范围都不能改变。</p><p><br  /></p><p style="font-size: 16.1904773712158px; white-space: normal; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); line-height: 28.4444px; text-align: center; box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><span style="max-width: 100%; color: rgb(136, 136, 136); font-size: 20px; box-sizing: border-box !important; word-wrap: break-word !important;">【今日微信公号推荐↓】</span></p><p style="font-size: 16.1904773712158px; white-space: normal; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); line-height: 28.4444px; text-align: center; box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><span style="max-width: 100%; line-height: 1.6; box-sizing: border-box !important; word-wrap: break-word !important;"></span><img data-s="300,640" data-type="png" data-ratio="0.6258992805755396" data-w=""  style="color: rgb(62, 62, 62); line-height: 25.6000003814697px; white-space: pre-wrap; box-sizing: border-box !important; word-wrap: break-word !important; width: auto !important; visibility: visible !important; background-color: rgb(255, 255, 255);"   SRC="Java中整型的缓存机制_files/640.jpg" /></p><p style="font-size: 16.1904773712158px; line-height: 25.6px; white-space: normal; text-align: center;"><span style="font-size: 14px;">更多推荐请看</span><strong><span style="font-size: 14px;">《</span></strong><a href="http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&mid=402729167&idx=1&sn=5a02d08e2dd393f7b1cd08409a4a5000&scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=402729167&amp;idx=1&amp;sn=5a02d08e2dd393f7b1cd08409a4a5000&amp;scene=21#wechat_redirect"><span style="color: rgb(255, 169, 0);">值得关注的技术和设计公众号</span></a><span style="font-size: 14px;"><strong><span style="font-size: 16px;">》</span></strong></span></p><p style="font-size: 16.1904773712158px; line-height: 25.6px; white-space: normal;"><span style="font-size: 14px; color: rgb(136, 136, 136);"><br  /></span></p><p style="font-size: 16.1904773712158px; white-space: normal; line-height: 1.75em;"><span style="font-size: 14px; color: rgb(136, 136, 136);">其中推荐了包括<strong>技术</strong>、<strong>设计</strong>、<strong>极客</strong>和<strong>IT相亲</strong>相关的热门公众号。技术涵盖：Python、Web前端、Java、安卓、iOS、PHP、C/C++、.NET、Linux、数据库、运维、大数据、算法、IT职场等。点击《</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&mid=402729167&idx=1&sn=5a02d08e2dd393f7b1cd08409a4a5000&scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=402729167&amp;idx=1&amp;sn=5a02d08e2dd393f7b1cd08409a4a5000&amp;scene=21#wechat_redirect"><span style="font-size: 14px; color: rgb(255, 169, 0);">值得关注的技术和设计公众号</span></a><span style="font-size: 14px; color: rgb(136, 136, 136);">》，发现精彩！</span></p><p style="font-size: 16.1904773712158px; white-space: normal; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); line-height: 28.4444px; text-align: center; box-sizing: border-box !important; word-wrap: break-word !important; background-color: rgb(255, 255, 255);"><img  data-ratio="0.9172661870503597" data-s="300,640" data-type="png" data-w="" style="line-height: 28.44px;"   SRC="Java中整型的缓存机制_files/0.jpg" /></p>
                    </div>
                    
                    <link rel="stylesheet" type="text/css" href="Java中整型的缓存机制_files/page_mp_article_improve_combo2a7a3f.css">
                    
                    
                                        
                                        
                                        <div class="rich_media_tool" id="js_toobar3">
                                                                    <div id="js_read_area3" class="media_tool_meta tips_global meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                        <span style="display:none;" class="media_tool_meta meta_primary tips_global meta_praise" id="like3">
                            <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                        </span>

                        <a id="js_report_article3" style="display:none;" class="media_tool_meta tips_global meta_extra" href="">投诉</a>

                    </div>
                </div>

                <div class="rich_media_area_extra">

                    
                                        <div class="mpda_bottom_container" id="js_bottom_ad_area">
                        
                    </div>
                                        
                    <div id="js_iframetest" style="display:none;"></div>

                    
                                        <div class="rich_media_extra" id="js_cmt_area" style="display:none">

                        <div class="discuss_container" id="js_cmt_main" style="display:none">
                            <div class="rich_tips with_line title_tips discuss_title_line">
                                <span class="tips">精选留言</span>
                            </div>
                            <p class="tips_global tc title_bottom_tips" id="js_cmt_nofans1" style="display:none;">关注该公众号可参与留言</p>
                            <p class="discuss_icon_tips title_bottom_tips tr" id="js_cmt_addbtn1" style="display:none">
                                
                                                                <a href="#comment">写留言<img class="icon_edit" src="Java中整型的缓存机制_files/icon_edit25ded2.png" alt=""></a>
                                                            </p>
                            <ul class="discuss_list" id="js_cmt_list"></ul>
                        </div>


                        <div class="tips_global rich_split_tips tc" id="js_cmt_nofans2" style="display:none;">
                            关注该公众号可参与留言
                        </div>

                        <p class="discuss_icon_tips rich_split_tips tr" id="js_cmt_addbtn2" style="display:none">
                            
                                                        <a href="#comment">写留言<img class="icon_edit" src="Java中整型的缓存机制_files/icon_edit25ded2.png" alt=""></a>
                                                    </p>

                        <p class="rich_split_tips tc tips_global" id="js_cmt_tips" style="display:none;"></p>


                        <div class="rich_tips tips_global loading_tips" id="js_cmt_loading">
                            <img src="Java中整型的缓存机制_files/icon_loading_white2805ea.gif" class="rich_icon icon_loading_white" alt="">
                            <span class="tips">加载中</span>
                        </div>

                        <div class="rich_tips with_line tips_global" id="js_cmt_statement" style="display:none">
                            <span class="tips">以上留言由公众号筛选后显示</span>
                        </div>

                        <p class="rich_split_tips tc" id="js_cmt_qa" style="display:none;">
                            <a href="http://kf.qq.com/touch/sappfaq/150211YfyMVj150313qmMbyi.html?scene_id=kf264">
                                了解留言功能详情
                            </a>
                        </p>

                    </div>
                                    </div>
               
            </div>
            <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
                <div class="qr_code_pc_inner">
                    <div class="qr_code_pc">
                        <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                        <p>微信扫一扫<br>关注该公众号</p>
                    </div>
                </div>
            </div>

        </div>
    </div>


        
        
        
    

    
  

  


    </body>
</html>

 
